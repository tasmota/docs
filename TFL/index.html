<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Documentation (Wiki) for Tasmota"><link href=https://tasmota.github.io/docs/TFL/ rel=canonical><link href=../Tasmota-Application/ rel=prev><link href=../TouchPin/ rel=next><link rel=icon href=../_media/favicon.ico><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.6.23"><title>TensorFlow Lite - Tasmota</title><link rel=stylesheet href=../assets/stylesheets/main.84d31ad4.min.css><link rel=stylesheet href=../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Barlow:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Barlow";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../assets/css/anchor-fix.css><script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-8J08F8X90S"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-8J08F8X90S",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-8J08F8X90S",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script><script>"undefined"!=typeof __md_analytics&&__md_analytics()</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=blue data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#tensorflow-lite class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=.. title=Tasmota class="md-header__button md-logo" aria-label=Tasmota data-md-component=logo> <img src=../_media/logo.svg alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Tasmota </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> TensorFlow Lite </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=blue data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=blue data-md-color-accent=deep-purple aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/arendst/tasmota title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg> </div> <div class=md-source__repository> arendst/tasmota </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../Features/ class=md-tabs__link> Features </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../ESP32/ class=md-tabs__link> ESP32 </a> </li> <li class=md-tabs__item> <a href=../Integrations/ class=md-tabs__link> Smart Home Integrations </a> </li> <li class=md-tabs__item> <a href=../Supported-Peripherals/ class=md-tabs__link> Peripherals </a> </li> <li class=md-tabs__item> <a href=../Configuration-Procedure-for-New-Devices/ class=md-tabs__link> Supported Devices </a> </li> <li class=md-tabs__item> <a href=../FAQ/ class=md-tabs__link> Help </a> </li> <li class=md-tabs__item> <a href=http://tasmota.github.io/install class=md-tabs__link> Web Installer </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=.. title=Tasmota class="md-nav__button md-logo" aria-label=Tasmota data-md-component=logo> <img src=../_media/logo.svg alt=logo> </a> Tasmota </label> <div class=md-nav__source> <a href=https://github.com/arendst/tasmota title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg> </div> <div class=md-source__repository> arendst/tasmota </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_1> <label class=md-nav__link for=__nav_1 id=__nav_1_label tabindex=0> <span class=md-ellipsis> Home </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_1_label aria-expanded=false> <label class=md-nav__title for=__nav_1> <span class="md-nav__icon md-icon"></span> Home </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=.. class=md-nav__link> <span class=md-ellipsis> News </span> </a> </li> <li class=md-nav__item> <a href=../About/ class=md-nav__link> <span class=md-ellipsis> About </span> </a> </li> <li class=md-nav__item> <a href=../Getting-Started/ class=md-nav__link> <span class=md-ellipsis> Getting Started </span> </a> </li> <li class=md-nav__item> <a href=../Upgrading/ class=md-nav__link> <span class=md-ellipsis> Upgrading </span> </a> </li> <li class=md-nav__item> <a href=../MQTT/ class=md-nav__link> <span class=md-ellipsis> MQTT </span> </a> </li> <li class=md-nav__item> <a href=../Commands/ class=md-nav__link> <span class=md-ellipsis> Commands </span> </a> </li> <li class=md-nav__item> <a href=../Templates/ class=md-nav__link> <span class=md-ellipsis> Templates </span> </a> </li> <li class=md-nav__item> <a href=../Components/ class=md-nav__link> <span class=md-ellipsis> Components </span> </a> </li> <li class=md-nav__item> <a href=../Modules/ class=md-nav__link> <span class=md-ellipsis> Modules </span> </a> </li> <li class=md-nav__item> <a href=../Peripherals/ class=md-nav__link> <span class=md-ellipsis> Peripherals </span> </a> </li> <li class=md-nav__item> <a href=../WebUI/ class=md-nav__link> <span class=md-ellipsis> WebUI </span> </a> </li> <li class=md-nav__item> <a href=../Firmware-Builds/ class=md-nav__link> <span class=md-ellipsis> Firmware Builds </span> </a> </li> <li class=md-nav__item> <a href=../Compile-your-build/ class=md-nav__link> <span class=md-ellipsis> Compiling </span> </a> </li> <li class=md-nav__item> <a href=../Contributing/ class=md-nav__link> <span class=md-ellipsis> Contributing </span> </a> </li> <li class=md-nav__item> <a href=../Download/ class=md-nav__link> <span class=md-ellipsis> Download </span> </a> </li> <li class=md-nav__item> <a href=https://github.com/arendst/Tasmota/discussions/categories/show-and-tell class=md-nav__link> <span class=md-ellipsis> Project Showcase </span> </a> </li> <li class=md-nav__item> <a href=../For-Developers/ class=md-nav__link> <span class=md-ellipsis> For Developers </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex=0> <span class=md-ellipsis> Features </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Features </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Features/ class=md-nav__link> <span class=md-ellipsis> Introduction </span> </a> </li> <li class=md-nav__item> <a href=../ADC/ class=md-nav__link> <span class=md-ellipsis> Analog Pin </span> </a> </li> <li class=md-nav__item> <a href=../ArtNet/ class=md-nav__link> <span class=md-ellipsis> ArtNet DMX </span> </a> </li> <li class=md-nav__item> <a href=../Buttons-and-Switches/ class=md-nav__link> <span class=md-ellipsis> Buttons and Switches </span> </a> </li> <li class=md-nav__item> <a href=../DeepSleep/ class=md-nav__link> <span class=md-ellipsis> DeepSleep </span> </a> </li> <li class=md-nav__item> <a href=../Device-Groups/ class=md-nav__link> <span class=md-ellipsis> Device Groups </span> </a> </li> <li class=md-nav__item> <a href=../Universal-Display-Driver/ class=md-nav__link> <span class=md-ellipsis> Universal Display and Universal Touch drivers (uDisplay/uTouch) </span> </a> </li> <li class=md-nav__item> <a href=../Displays/ class=md-nav__link> <span class=md-ellipsis> Displays </span> </a> </li> <li class=md-nav__item> <a href=../Dynamic-Sleep/ class=md-nav__link> <span class=md-ellipsis> Dynamic Sleep </span> </a> </li> <li class=md-nav__item> <a href=../I2CDEVICES/ class=md-nav__link> <span class=md-ellipsis> I2C Devices </span> </a> </li> <li class=md-nav__item> <a href=../I2S-Audio/ class=md-nav__link> <span class=md-ellipsis> I2S Audio </span> </a> </li> <li class=md-nav__item> <a href=../IPv6/ class=md-nav__link> <span class=md-ellipsis> IPv6 </span> </a> </li> <li class=md-nav__item> <a href=../Lights/ class=md-nav__link> <span class=md-ellipsis> Lights </span> </a> </li> <li class=md-nav__item> <a href=../Matter/ class=md-nav__link> <span class=md-ellipsis> Matter </span> </a> </li> <li class=md-nav__item> <a href=../PIR-Motion-Sensors/ class=md-nav__link> <span class=md-ellipsis> PIR Motion Sensors </span> </a> </li> <li class=md-nav__item> <a href=../Power-Monitoring-Calibration/ class=md-nav__link> <span class=md-ellipsis> Power Monitoring Calibration </span> </a> </li> <li class=md-nav__item> <a href=../PWM-dimmer-switch/ class=md-nav__link> <span class=md-ellipsis> PWM Dimmer </span> </a> </li> <li class=md-nav__item> <a href=../Rules/ class=md-nav__link> <span class=md-ellipsis> Rules </span> </a> </li> <li class=md-nav__item> <a href=../Scripting-Language/ class=md-nav__link> <span class=md-ellipsis> Scripting Language </span> </a> </li> <li class=md-nav__item> <a href=../Blinds-and-Shutters/ class=md-nav__link> <span class=md-ellipsis> Shutters and Blinds </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_21> <label class=md-nav__link for=__nav_2_21 id=__nav_2_21_label tabindex=0> <span class=md-ellipsis> Protocol Bridging </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_21_label aria-expanded=false> <label class=md-nav__title for=__nav_2_21> <span class="md-nav__icon md-icon"></span> Protocol Bridging </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../TasmotaClient/ class=md-nav__link> <span class=md-ellipsis> Arduino MCU </span> </a> </li> <li class=md-nav__item> <a href=../Bluetooth/ class=md-nav__link> <span class=md-ellipsis> BLE Gateway </span> </a> </li> <li class=md-nav__item> <a href=../DALI/ class=md-nav__link> <span class=md-ellipsis> DALI </span> </a> </li> <li class=md-nav__item> <a href=../HDMI_CEC/ class=md-nav__link> <span class=md-ellipsis> HDMI CEC </span> </a> </li> <li class=md-nav__item> <a href=../Tasmota-IR/ class=md-nav__link> <span class=md-ellipsis> IR Communication </span> </a> </li> <li class=md-nav__item> <a href=../Projector/ class=md-nav__link> <span class=md-ellipsis> LCD/DLP Projector Control </span> </a> </li> <li class=md-nav__item> <a href=../LoRa-and-LoRaWan-Bridge/ class=md-nav__link> <span class=md-ellipsis> LoRa and LoRaWan Bridge </span> </a> </li> <li class=md-nav__item> <a href=../Modbus-Bridge/ class=md-nav__link> <span class=md-ellipsis> Modbus Bridge </span> </a> </li> <li class=md-nav__item> <a href=../OpenTherm/ class=md-nav__link> <span class=md-ellipsis> OpenTherm </span> </a> </li> <li class=md-nav__item> <a href=../RF-Protocol/ class=md-nav__link> <span class=md-ellipsis> RF Communication </span> </a> </li> <li class=md-nav__item> <a href=../Serial-to-TCP-Bridge/ class=md-nav__link> <span class=md-ellipsis> Serial to TCP Bridge </span> </a> </li> <li class=md-nav__item> <a href=../TWAI/ class=md-nav__link> <span class=md-ellipsis> TWAI </span> </a> </li> <li class=md-nav__item> <a href=../Telegram/ class=md-nav__link> <span class=md-ellipsis> Telegram </span> </a> </li> <li class=md-nav__item> <a href=../Zigbee/ class=md-nav__link> <span class=md-ellipsis> Zigbee </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../Smart-Meter-Interface/ class=md-nav__link> <span class=md-ellipsis> Smart Meter Interface </span> </a> </li> <li class=md-nav__item> <a href=../Thermostat/ class=md-nav__link> <span class=md-ellipsis> Thermostat </span> </a> </li> <li class=md-nav__item> <a href=../Timers/ class=md-nav__link> <span class=md-ellipsis> Timers </span> </a> </li> <li class=md-nav__item> <a href=../TLS/ class=md-nav__link> <span class=md-ellipsis> TLS Secured MQTT </span> </a> </li> <li class=md-nav__item> <a href=../TuyaMCU/ class=md-nav__link> <span class=md-ellipsis> TuyaMCU </span> </a> </li> <li class=md-nav__item> <a href=../UFS/ class=md-nav__link> <span class=md-ellipsis> Universal File System </span> </a> </li> <li class=md-nav__item> <a href=../Range-Extender/ class=md-nav__link> <span class=md-ellipsis> Wi-Fi Range Extender </span> </a> </li> <li class=md-nav__item> <a href=../Wireguard/ class=md-nav__link> <span class=md-ellipsis> Wireguard VPN </span> </a> </li> <li class=md-nav__item> <a href=../Tutorials/ class=md-nav__link> <span class=md-ellipsis> Projects and Tutorials </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3 checked> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex> <span class=md-ellipsis> ESP32 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=true> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> ESP32 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../ESP32/ class=md-nav__link> <span class=md-ellipsis> Tasmota32 Features </span> </a> </li> <li class=md-nav__item> <a href=../Berry/ class=md-nav__link> <span class=md-ellipsis> Berry </span> </a> </li> <li class=md-nav__item> <a href=../Bluetooth_ESP32/ class=md-nav__link> <span class=md-ellipsis> Bluetooth Low Energy </span> </a> </li> <li class=md-nav__item> <a href=../LVGL/ class=md-nav__link> <span class=md-ellipsis> LVGL </span> </a> </li> <li class=md-nav__item> <a href=../HASPmota/ class=md-nav__link> <span class=md-ellipsis> HASPmota </span> </a> </li> <li class=md-nav__item> <a href=../Matter/ class=md-nav__link> <span class=md-ellipsis> Matter </span> </a> </li> <li class=md-nav__item> <a href=../Tasmota-Extension/ class=md-nav__link> <span class=md-ellipsis> Tasmota Extension </span> </a> </li> <li class=md-nav__item> <a href=../Tasmota-Application/ class=md-nav__link> <span class=md-ellipsis> Tasmota Application Files </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> TensorFlow Lite </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> TensorFlow Lite </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#different-levels-of-tensorflow class=md-nav__link> <span class=md-ellipsis> Different Levels of TensorFlow </span> </a> </li> <li class=md-nav__item> <a href=#machine-learning-is-what-exactly-again class=md-nav__link> <span class=md-ellipsis> Machine Learning ... is what exactly again? </span> </a> </li> <li class=md-nav__item> <a href=#design-considerations-for-tasmota class=md-nav__link> <span class=md-ellipsis> Design Considerations for Tasmota </span> </a> <nav class=md-nav aria-label="Design Considerations for Tasmota"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#speech-recognition class=md-nav__link> <span class=md-ellipsis> Speech Recognition </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#usage class=md-nav__link> <span class=md-ellipsis> Usage </span> </a> <nav class=md-nav aria-label=Usage> <ul class=md-nav__list> <li class=md-nav__item> <a href=#hello-world-sort-of class=md-nav__link> <span class=md-ellipsis> "Hello World" Sort Of... </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#speech-recognition-keyword-spotting class=md-nav__link> <span class=md-ellipsis> Speech Recognition / Keyword Spotting </span> </a> <nav class=md-nav aria-label="Speech Recognition / Keyword Spotting"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#create-training-data class=md-nav__link> <span class=md-ellipsis> Create Training Data </span> </a> </li> <li class=md-nav__item> <a href=#general-strategies class=md-nav__link> <span class=md-ellipsis> General strategies </span> </a> </li> <li class=md-nav__item> <a href=#edge-impulse class=md-nav__link> <span class=md-ellipsis> Edge Impulse </span> </a> </li> <li class=md-nav__item> <a href=#tasmota-side class=md-nav__link> <span class=md-ellipsis> Tasmota Side </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#image-classification class=md-nav__link> <span class=md-ellipsis> Image classification </span> </a> <nav class=md-nav aria-label="Image classification"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#ml-learning-by-doing class=md-nav__link> <span class=md-ellipsis> ML-learning by doing </span> </a> </li> <li class=md-nav__item> <a href=#camera-setup class=md-nav__link> <span class=md-ellipsis> Camera setup </span> </a> </li> <li class=md-nav__item> <a href=#roi-creation class=md-nav__link> <span class=md-ellipsis> ROI creation </span> </a> </li> <li class=md-nav__item> <a href=#model-training class=md-nav__link> <span class=md-ellipsis> Model training </span> </a> </li> <li class=md-nav__item> <a href=#berry-implementation class=md-nav__link> <span class=md-ellipsis> Berry implementation </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../TouchPin/ class=md-nav__link> <span class=md-ellipsis> Touch GPIOs </span> </a> </li> <li class=md-nav__item> <a href=../Safeboot/ class=md-nav__link> <span class=md-ellipsis> Safeboot Partition Layout </span> </a> </li> <li class=md-nav__item> <a href=https://templates.blakadder.com/esp32 class=md-nav__link> <span class=md-ellipsis> Supported Devices </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex=0> <span class=md-ellipsis> Smart Home Integrations </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Smart Home Integrations </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Integrations/ class=md-nav__link> <span class=md-ellipsis> Introduction </span> </a> </li> <li class=md-nav__item> <a href=../Alexa/ class=md-nav__link> <span class=md-ellipsis> Alexa </span> </a> </li> <li class=md-nav__item> <a href=../AWS-IoT/ class=md-nav__link> <span class=md-ellipsis> AWS IoT </span> </a> </li> <li class=md-nav__item> <a href=../Domoticz/ class=md-nav__link> <span class=md-ellipsis> Domoticz </span> </a> </li> <li class=md-nav__item> <a href=../Home-Assistant/ class=md-nav__link> <span class=md-ellipsis> Home Assistant </span> </a> </li> <li class=md-nav__item> <a href=../Homebridge/ class=md-nav__link> <span class=md-ellipsis> Homebridge </span> </a> </li> <li class=md-nav__item> <a href=https://homey.app/en-us/app/com.paveld.tasmota/Tasmota-MQTT/ class=md-nav__link> <span class=md-ellipsis> Homey </span> </a> </li> <li class=md-nav__item> <a href=../HomeSeer/ class=md-nav__link> <span class=md-ellipsis> HomeSeer </span> </a> </li> <li class=md-nav__item> <a href=../IP-Symcon/ class=md-nav__link> <span class=md-ellipsis> IP Symcon </span> </a> </li> <li class=md-nav__item> <a href=../KNX/ class=md-nav__link> <span class=md-ellipsis> KNX </span> </a> </li> <li class=md-nav__item> <a href=../NodeRed/ class=md-nav__link> <span class=md-ellipsis> NodeRed </span> </a> </li> <li class=md-nav__item> <a href=../nymea/ class=md-nav__link> <span class=md-ellipsis> nymea </span> </a> </li> <li class=md-nav__item> <a href=../Octoprint/ class=md-nav__link> <span class=md-ellipsis> OctoPrint </span> </a> </li> <li class=md-nav__item> <a href=../openHAB/ class=md-nav__link> <span class=md-ellipsis> openHAB </span> </a> </li> <li class=md-nav__item> <a href=../otto/ class=md-nav__link> <span class=md-ellipsis> Otto </span> </a> </li> <li class=md-nav__item> <a href=https://github.com/arendst/Tasmota/issues/3769 class=md-nav__link> <span class=md-ellipsis> IOBroker </span> </a> </li> <li class=md-nav__item> <a href=https://github.com/tim-hellhake/tasmota-adapter class=md-nav__link> <span class=md-ellipsis> Mozilla WebThings Adapter </span> </a> </li> <li class=md-nav__item> <a href=https://github.com/hongtat/tasmota-connect class=md-nav__link> <span class=md-ellipsis> SmartThings </span> </a> </li> <li class=md-nav__item> <a href=https://github.com/Gifford47/tasmohab/blob/master/README.md class=md-nav__link> <span class=md-ellipsis> Tasmohab </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../Supported-Peripherals/ class=md-nav__link> <span class=md-ellipsis> Peripherals </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6 id=__nav_6_label tabindex=0> <span class=md-ellipsis> Supported Devices </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=false> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Supported Devices </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Configuration-Procedure-for-New-Devices/ class=md-nav__link> <span class=md-ellipsis> Configure Unknown Device </span> </a> </li> <li class=md-nav__item> <a href="https://templates.blakadder.com/ " target='_blank""' class=md-nav__link> <span class=md-ellipsis> All Supported Devices </span> </a> </li> <li class=md-nav__item> <a href=../Pinouts/ class=md-nav__link> <span class=md-ellipsis> Wi-Fi Module Pinouts </span> </a> </li> <li class=md-nav__item> <a href=../Supported-Modules/ class=md-nav__link> <span class=md-ellipsis> Supported Modules </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7> <label class=md-nav__link for=__nav_7 id=__nav_7_label tabindex=0> <span class=md-ellipsis> Help </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_7_label aria-expanded=false> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> Help </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../FAQ/ class=md-nav__link> <span class=md-ellipsis> FAQ </span> </a> </li> <li class=md-nav__item> <a href=../Troubleshooting/ class=md-nav__link> <span class=md-ellipsis> Troubleshooting </span> </a> </li> <li class=md-nav__item> <a href=../Device-Recovery/ class=md-nav__link> <span class=md-ellipsis> Device Recovery </span> </a> </li> <li class=md-nav__item> <a href="https://discord.gg/Ks2Kzd4 " target='_blank""' class=md-nav__link> <span class=md-ellipsis> Discord Support </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=http://tasmota.github.io/install class=md-nav__link> <span class=md-ellipsis> Web Installer </span> </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#different-levels-of-tensorflow class=md-nav__link> <span class=md-ellipsis> Different Levels of TensorFlow </span> </a> </li> <li class=md-nav__item> <a href=#machine-learning-is-what-exactly-again class=md-nav__link> <span class=md-ellipsis> Machine Learning ... is what exactly again? </span> </a> </li> <li class=md-nav__item> <a href=#design-considerations-for-tasmota class=md-nav__link> <span class=md-ellipsis> Design Considerations for Tasmota </span> </a> <nav class=md-nav aria-label="Design Considerations for Tasmota"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#speech-recognition class=md-nav__link> <span class=md-ellipsis> Speech Recognition </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#usage class=md-nav__link> <span class=md-ellipsis> Usage </span> </a> <nav class=md-nav aria-label=Usage> <ul class=md-nav__list> <li class=md-nav__item> <a href=#hello-world-sort-of class=md-nav__link> <span class=md-ellipsis> "Hello World" Sort Of... </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#speech-recognition-keyword-spotting class=md-nav__link> <span class=md-ellipsis> Speech Recognition / Keyword Spotting </span> </a> <nav class=md-nav aria-label="Speech Recognition / Keyword Spotting"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#create-training-data class=md-nav__link> <span class=md-ellipsis> Create Training Data </span> </a> </li> <li class=md-nav__item> <a href=#general-strategies class=md-nav__link> <span class=md-ellipsis> General strategies </span> </a> </li> <li class=md-nav__item> <a href=#edge-impulse class=md-nav__link> <span class=md-ellipsis> Edge Impulse </span> </a> </li> <li class=md-nav__item> <a href=#tasmota-side class=md-nav__link> <span class=md-ellipsis> Tasmota Side </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#image-classification class=md-nav__link> <span class=md-ellipsis> Image classification </span> </a> <nav class=md-nav aria-label="Image classification"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#ml-learning-by-doing class=md-nav__link> <span class=md-ellipsis> ML-learning by doing </span> </a> </li> <li class=md-nav__item> <a href=#camera-setup class=md-nav__link> <span class=md-ellipsis> Camera setup </span> </a> </li> <li class=md-nav__item> <a href=#roi-creation class=md-nav__link> <span class=md-ellipsis> ROI creation </span> </a> </li> <li class=md-nav__item> <a href=#model-training class=md-nav__link> <span class=md-ellipsis> Model training </span> </a> </li> <li class=md-nav__item> <a href=#berry-implementation class=md-nav__link> <span class=md-ellipsis> Berry implementation </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/tasmota/docs/blob/master/docs/TFL.md title="Edit this page" class="md-content__button md-icon" rel=edit> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg> </a> <h1 id=tensorflow-lite>TensorFlow Lite <span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9 3v2H7a2 2 0 0 0-2 2v2H3v2h2v2H3v2h2v2a2 2 0 0 0 2 2h2v2h2v-2h2v2h2v-2h2a2 2 0 0 0 2-2v-2h2v-2h-2v-2h2V9h-2V7a2 2 0 0 0-2-2h-2V3h-2v2h-2V3M7 9h3.5a1 1 0 0 1 1 1v4a1 1 0 0 1-1 1H7v-1.5h3v-.75H8.5v-1.5H10v-.75H7M12.5 9H16a1 1 0 0 1 1 1v1.75a1 1 0 0 1-1 1h-2v.75h3V15h-4.5v-2.75a1 1 0 0 1 1-1h2v-.75h-3"/></svg></span><a class=headerlink href=#tensorflow-lite title="Permanent link">~</a></h1> <details class=failure> <summary>This feature is not included in precompiled binaries</summary> <p>add as a build flag to your build environment in <code>platformio_tasmota_cenv.ini</code>:<br> <div class=highlight><pre><span></span><code>build_flags             = ${env:tasmota32_base.build_flags}
                        -DUSE_BERRY_TF_LITE
                        -DESP_NN ; use optimized kernels for ESP32/ESP32-S3
                        -DUSE_I2S_ALL ; add only for speech/microphone use
lib_extra_dirs          = lib/libesp32, lib/libesp32_div, lib/lib_basic, lib/lib_i2c, lib/lib_div, lib/lib_ssl, lib/libesp32_ml
; lib/libesp32_ml is important to include 
</code></pre></div></p> </details> <p>Currently supported targets: ESP32 and ESP32-S3. </p> <h2 id=different-levels-of-tensorflow>Different Levels of TensorFlow<a class=headerlink href=#different-levels-of-tensorflow title="Permanent link">~</a></h2> <p><a href=https://www.tensorflow.org>TensorFlow</a> is an open-source machine-learning platform that is widely adopted and thus is a whole ecosystem with tools, libraries and a huge community. It is not application specific and can be used for all kind of tasks.<br> Initially it was only usable on fully fledged computers but over time technical advances in software and hardware made it possible to step down the stairs and make it usable on weaker devices.<br> So the next smaller thing is called <a href=https://www.tensorflow.org/lite>TensorFlow Lite</a> that was targeted for smaller devices like the famous ARM-based 'RaspberryPi'. </p> <p>But - you guessed it - this was not the end of the line and the whole armada of microcontrollers reached out to be part of the machine learning world. The name of this stripped down platform is <a href=https://www.tensorflow.org/lite/microcontrollers>TensorFlow Lite for Microcontrollers</a>.<br> Tasmota uses a <a href=https://github.com/espressif/esp-nn>fork</a> from Espressif with optimized functions for maximal performance. </p> <h2 id=machine-learning-is-what-exactly-again>Machine Learning ... is what exactly again?<a class=headerlink href=#machine-learning-is-what-exactly-again title="Permanent link">~</a></h2> <p>Machine learning, deep learning, KI, AI, ... - these are very blurry defined words, that mean more or less the same and scale from pretty complex up to extremely complex software constructs. Let's try to have a very simplified look at it.</p> <p>In ancient times (like 20 years ago) problems where solved on computers by finding an algorithm to compute input data and thus getting output data.<br> With machine learning the process is still to have input data, but to use known good output data to let a piece of software find the algorithm to get from the known input data to the known output data - and hope that this still works with unknown input data.<br> The mixture of algorithms and found parameters will be put into a structure which is called a <em>model</em> and the process of building it is usually named <em>training</em>.<br> The model is created programmatically, although this process can be hidden behind a GUI and at this stage the number of inputs and outputs will be defined.<br> Although it would be technically possible to feed raw sensor data into the model, this is not how it is done in most cases. The very common step in between is called <em>feature extraction</em>, which reduces the amount of data and often the dimensionality to make the whole process more efficient and thus even possible for some applications. A good feature extraction will help to later run a successful <em>inference</em> and there are tools to show, how different input entities form clusters of feature data.<br> After feeding the model with sensible data it is time to press a virtual "go button" and invoke an <em>inference</em>, that does the magic computations inside the <em>model</em>.<br> After that the <em>outputs</em> will get populated with some values, that have to be interpreted as probabilities. It can be required to add some complex logic in order interpret this data or do some averaging of real-time data. </p> <p>The processed data is historically typically in the floating point format, but for weak devices like MCU's it is a very common thing to shrink the 4 bytes of a <em>float32</em> to 1 byte of an <em>int8</em> by quantization. This happens on various places and will lead to a loss of precision, but is very often nearly on par in the final result. </p> <h2 id=design-considerations-for-tasmota>Design Considerations for Tasmota<a class=headerlink href=#design-considerations-for-tasmota title="Permanent link">~</a></h2> <p>The understandable way to optimize machine learning applications for MCU's is to build and later flash one monolithic firmware, where everything has to be done at/before compile time. This makes sense and is fundamentally the only way to quench out every little bit of performance and memory optimization. </p> <p>Nonetheless for Tasmota we do not really want to build one-trick-pony firmwares and the idea is to be able to run all kinds of TensorFlow applications with one firmware, that has enough generic capabilities to dynamically load models and extra code at runtime. On the other hand we can optimize the program flow for the ESP chips and Free-RTOS.<br> The API shall be quite slim with as few boilerplate code as possible, but can be extended as needed and use Berry to add additional logic in the first place. </p> <div class="admonition tip"> <p class=admonition-title>Accelerate your development workflow for machine learning</p> <p>Usually developing machine learning applications on MCU's means that every small change to the model and/or application code will need a firmware compilation and flashing.<br> With Tasmota this is now independent to each other. You can retrain and reupload the model to the file system as often as needed at runtime. The same is valid for refining the Berry code.</p> </div> <p>In order to get things done like speech recognition, where especially realtime feature extraction is not possible to achieve with Berry (with the knowledge of today), additional specialized functionality is included. </p> <div class="admonition failure"> <p class=admonition-title>Before you proceed, check you expectations!!</p> <p>The most important prerequisite for speech recognition on MCU's is to have the right mindset. It is totally impossible to reach the level of recognition of a commercial product (Alexa, Siri, Cortana, ... you name it) on much stronger hardware. The usual cheap I2S MEMS microphone alone is a severe problem and the tuning of the various variables of the model is trial and error in many cases. It will make the final application fail with wrong but similar sounding words or mumbling. <br> Be happy if it works and just don't do it, if you can not handle frustration! You will have to invest some time to fine tune every specific application!</p> </div> <p>This sums up to these steps: </p> <ol> <li> <p>Create a TensorFlow lite model (including collecting data, finding good parameters, final training). Use Edgeimpulse to make this easy or create your own training pipeline.</p> </li> <li> <p>Create a Berry application (loading the model, running inference, interpret the result, acting on the result). Use building blocks from this page to get started.</p> </li> </ol> <h3 id=speech-recognition>Speech Recognition<a class=headerlink href=#speech-recognition title="Permanent link">~</a></h3> <p>For the specific task of speech recognition a big hurdle lies in the way in the form of "How to create a model"?. Although there are numerous ways published on various places, that sound quite similar to each other, this is a very non-trivial task.<br> While the same principles apply to all examples that you may find, the implementation differences under the hood are quite substantial.<br> The hardest part here is to do the <em>feature extraction</em> of the audio data in a compatible(!!!) way for training and inference on the device. Usually the raw audio data is processed using mel frequency conversion, FFT and some kind of logarithm. You may find words like power spectrum, mel frequency energies and mel frequency cepstral coefficients, which sadly are very implementation specific and not interchangeable.<br> So it is utterly important to use the same (= compatible) implementations for the whole pipeline of <code>Training-&gt;Deployment-&gt;Usage</code>. </p> <p>For convenience reasons and after extended testing it was decided to be compatible with <a href=https://github.com/astorfi/speechpy>Speechpy</a> (with small differences). Thus it is possible to use <a href=https://www.edgeimpulse.com>Edge Impulse</a> as the training platform for model creation, which uses <em>Speechpy</em> too and is a development platform for machine learning on small devices, that shares some similarities to GitHub with regards to costs. Everything that we need for Tasmota is free, the enterprise solution they offer for money is not needed.<br> Technically it is definitely possible to build a complete offline training pipeline as basically everything on Edgeimpulse is open source and can be recreated by a motivated user for local usage. </p> <p>If you use <a href=https://www.edgeimpulse.com>Edge Impulse</a> for online training, you do not have to create a new firmware image for your Tasmota device. Instead of choosing one of the deployment options from Edge Impulse, you only have to download the binary TensorFlow Lite model (usually the <code>int8 quantized</code> version) from the <code>Dashboard</code>, give it a suitable name and upload it to Tasmotas filesystem in order to use it with Berry afterwards. </p> <figcaption>Example - speech recognition using MFCC:</figcaption> <p><img alt="Feature parameters" src=../_media/ml/download.png width=500></p> <h2 id=usage>Usage<a class=headerlink href=#usage title="Permanent link">~</a></h2> <p>Functionality is provided by the module <code>TFL</code>, so always start with <code>import TFL</code>.</p> <table> <thead> <tr> <th style="text-align: left;">TFL Function</th> <th style="text-align: left;">Parameters and details</th> </tr> </thead> <tbody> <tr> <td style="text-align: left;">begin<a class=cmnd id=tfl_begin></td> <td style="text-align: left;"><code>(type:string, descriptor:bytes)</code><br>First step creates an internal context of type<br>"BUF" - generic session with arbitrary byte buffers for input and output<br>"MIC" - for voice recognition and capturing training data<br>"CAM" - not implemented yet<br>"" - stops a running session, can be used to init the internal log buffer<br><code>`descriptor</code>a byte array with specific meaning for every type</td> </tr> <tr> <td style="text-align: left;">load<a class=cmnd id=tfl_begin></td> <td style="text-align: left;"><code>(model:bytes, output:bytes, memory:int)</code><br>Will load and run the model<br><code>model</code> a bytes buffer that holds the model data for the entire lifecycle<br><code>output</code> a byte buffer that matches the output size of the model<br><code>memory</code> optional (default: 2000), a model specific memory size in bytes that will be allocated, find by trial-end-error</td> </tr> <tr> <td style="text-align: left;">input<a class=cmnd id=tfl_input></td> <td style="text-align: left;"><code>(input:bytes)</code><br>Feed the input of the model with values, must match the size of the model input. Will invoke an inference.</td> </tr> <tr> <td style="text-align: left;">output<a class=cmnd id=tfl_output></td> <td style="text-align: left;"><code>(output:bytes) -&gt; bool</code><br>Returns true if function was not called yet on actual output data.</td> </tr> <tr> <td style="text-align: left;">stats<a class=cmnd id=tfl_stats></td> <td style="text-align: left;"><code>() -&gt; string</code><br>Returns a JSON string with some metrics of the current session.</td> </tr> <tr> <td style="text-align: left;">log<a class=cmnd id=tfl_log></td> <td style="text-align: left;"><code>() -&gt; string</code><br>Returns a log message, typically for debugging.</td> </tr> </tbody> </table> <div class="admonition tip"> <p class=admonition-title>Use Netron to check your model</p> <p><a href=https://netron.app>https://netron.app</a> shows the inner structure of a tensorflow model including format and size of the inputs and outputs. Online and offline versions of the application available for every major platform.</p> </div> <h3 id=hello-world-sort-of>"Hello World" Sort Of...<a class=headerlink href=#hello-world-sort-of title="Permanent link">~</a></h3> <p>Perhaps THE starter project is the in itself pretty useless "sinewave example", which is nicely explained <a href="https://www.youtube.com/watch?v=BzzqYNYOcWc&t=2s">in these videos</a>.</p> <p>Of course we can run this model perfectly fine inside Tasmota, with a Berry code snippet:</p> <div class=highlight><pre><span></span><code><span class=kr>import</span><span class=w> </span><span class=n>TFL</span>
<span class=n>TFL</span><span class=p>.</span><span class=nf>begin</span><span class=p>(</span><span class=s2>&quot;BUF&quot;</span><span class=p>)</span><span class=w>  </span><span class=c1># generic TFL session </span>
<span class=kd>var</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>bytes</span><span class=p>(</span><span class=mi>-4</span><span class=p>)</span><span class=w> </span><span class=c1># holds one float, size must match the model</span>
<span class=kd>var</span><span class=w> </span><span class=n>o</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>bytes</span><span class=p>(</span><span class=mi>-4</span><span class=p>)</span><span class=w> </span><span class=c1># dito</span>

<span class=kd>var</span><span class=w> </span><span class=n>model</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>open</span><span class=p>(</span><span class=s2>&quot;sine_model.tflite&quot;</span><span class=p>).</span><span class=nf>readbytes</span><span class=p>()</span><span class=w> </span><span class=c1># this binary file must have been saved in the FS before</span>
<span class=n>TFL</span><span class=p>.</span><span class=nf>load</span><span class=p>(</span><span class=n>model</span><span class=p>,</span><span class=n>o</span><span class=p>,</span><span class=mi>3000</span><span class=p>)</span><span class=w> </span><span class=c1># load and run</span>

<span class=kd>var</span><span class=w> </span><span class=n>count</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=mf>.0</span>
<span class=kd>def</span><span class=w> </span><span class=nf>cb</span><span class=p>()</span><span class=w> </span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=n>TFL</span><span class=p>.</span><span class=nf>output</span><span class=p>(</span><span class=n>o</span><span class=p>)</span>
<span class=w>        </span><span class=c1># &quot;draw&quot; a bar</span>
<span class=w>        </span><span class=kd>var</span><span class=w> </span><span class=n>v</span><span class=w> </span><span class=o>=</span><span class=w>  </span><span class=nb>int</span><span class=p>((</span><span class=n>o</span><span class=p>.</span><span class=nf>getfloat</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mi>1</span><span class=p>)</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=mi>15</span><span class=p>)</span>
<span class=w>        </span><span class=kd>var</span><span class=w> </span><span class=n>bar_el</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;=&quot;</span>
<span class=w>        </span><span class=kd>var</span><span class=w> </span><span class=n>bar</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;&quot;</span>
<span class=w>        </span><span class=k>for</span><span class=w> </span><span class=n>i</span><span class=o>:</span><span class=mi>0</span><span class=o>..</span><span class=na>v</span><span class=w> </span><span class=n>bar</span><span class=o>+=</span><span class=n>bar_el</span><span class=w> </span><span class=k>end</span>
<span class=w>        </span><span class=nb>print</span><span class=p>(</span><span class=n>bar</span><span class=p>)</span>

<span class=w>        </span><span class=c1># or print the value</span>
<span class=w>        </span><span class=c1># print(o.getfloat(0))</span>

<span class=w>        </span><span class=c1># prepare new input in the range of 0..6</span>
<span class=w>        </span><span class=n>count</span><span class=o>+=</span><span class=w> </span><span class=mi>0</span><span class=mf>.1</span><span class=w> </span>
<span class=w>        </span><span class=k>if</span><span class=w> </span><span class=n>count</span><span class=o>&gt;</span><span class=mi>6</span><span class=w> </span><span class=n>count</span><span class=o>=</span><span class=mi>0</span><span class=w> </span><span class=k>end</span>
<span class=w>        </span><span class=n>i</span><span class=p>.</span><span class=nf>setfloat</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=n>count</span><span class=p>)</span><span class=w> </span>
<span class=w>        </span><span class=n>TFL</span><span class=p>.</span><span class=nb>input</span><span class=p>(</span><span class=n>i</span><span class=p>)</span><span class=w> </span><span class=c1># and feed it into the model</span>
<span class=w>    </span><span class=k>end</span>
<span class=w>    </span><span class=kd>var</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>TFL</span><span class=p>.</span><span class=nf>log</span><span class=p>()</span><span class=w> </span><span class=c1># receive log messages from the TF lite tasks</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=nb>print</span><span class=p>(</span><span class=n>s</span><span class=p>)</span><span class=w> </span><span class=k>end</span><span class=w> </span>
<span class=w>    </span><span class=n>tasmota</span><span class=p>.</span><span class=nf>set_timer</span><span class=p>(</span><span class=mi>50</span><span class=p>,</span><span class=w> </span><span class=n>cb</span><span class=p>)</span><span class=w> </span>
<span class=k>end</span>
<span class=nf>cb</span><span class=p>()</span>

<span class=c1># initiate loop </span>
<span class=n>TFL</span><span class=p>.</span><span class=nb>input</span><span class=p>(</span><span class=n>i</span><span class=p>)</span>
</code></pre></div> <p>This will pollute your Tasmota console with a moving bar resembling a sine wave.</p> <p>In fact this shows a very generic application, where the format and size as well as the meaning of the in- and outputs must be known, but the model itself can remain a "black box". We do not need to know, which kernels or parameters are used. </p> <div class="admonition tip"> <p class=admonition-title>Use 'TFL.stats()' to find memory size</p> <p>The metrics will show the used bytes of the model. So start with a large value and tune down, but leave a margin above the number in the output of the command.</p> </div> <h2 id=speech-recognition-keyword-spotting>Speech Recognition / Keyword Spotting<a class=headerlink href=#speech-recognition-keyword-spotting title="Permanent link">~</a></h2> <p>Training can be done entirely with Edgeimpulse. See their documentation for <a href=https://docs.edgeimpulse.com/docs/tutorials/responding-to-your-voice>Responding to your voice</a>. </p> <p>It is important to have a basic understanding of the process of speech recognition in order to set and tune the configuration:<br> An audio stream is processed in small slices, which have a duration and a stride. They can overlap or run one after the other. </p> <p>Tasmota will process every audio slice and immediately extract the features with support for the modes: <a href="https://docs.edgeimpulse.com/docs/edge-impulse-studio/processing-blocks/audio-mfe?q=mfe">MFE</a> and <a href="https://docs.edgeimpulse.com/docs/edge-impulse-studio/processing-blocks/audio-mfcc?q=mfe">MFCC</a>.<br> For performance reasons, we do not support every setting Edgeimpulse provides. Do not use <code>Window size</code> for MFCC mode by setting it to 0. More on this later.</p> <p>We use the following fixed audio settings: </p> <table> <thead> <tr> <th style="text-align: left;">Setting</th> <th style="text-align: left;">Value</th> </tr> </thead> <tbody> <tr> <td style="text-align: left;">Sample length</td> <td style="text-align: left;">1 second - means the word to train should be shorter (you might get away with training a shorter part of a longer word)</td> </tr> <tr> <td style="text-align: left;">Sample frequency</td> <td style="text-align: left;">16kHz - a proven compromise of sound quality, that is just enough for voice recognition, but can be handled by the ESP32</td> </tr> <tr> <td style="text-align: left;">Sample format</td> <td style="text-align: left;">16 bit, mono</td> </tr> <tr> <td style="text-align: left;">Low frequency</td> <td style="text-align: left;">300 Hz - default in Edgeimpulse</td> </tr> <tr> <td style="text-align: left;">High frequency</td> <td style="text-align: left;">8000 Hz - Sample frequency/2 and default too. Higher values would not make sense because of the NYQUIST theorem.</td> </tr> </tbody> </table> <h3 id=create-training-data>Create Training Data<a class=headerlink href=#create-training-data title="Permanent link">~</a></h3> <p>A working microphone setup for recording training data and later audio recognition is needed. We reuse the setup of the I2S driver of Tasmota, that must be configured according to <a href=../I2S-Audio_ESP32/ >I2S-Audio for ESP32</a>. </p> <p>Currently supported are 16 bits per sample at a rate of 16000 Hz. This can be set with:<br> <div class=highlight><pre><span></span><code>i2sconfig {&quot;Rx&quot;:{&quot;SampleRate&quot;:16000}}
</code></pre></div> The required preamplification factor is usually quite high (often around 16 - 32) and can be set with:<br> <div class=highlight><pre><span></span><code>i2sconfig {&quot;Rx&quot;:{&quot;Gain&quot;:30}}
</code></pre></div> Too high values will lead to clipping. The audio output of most I2S microphone is very low. Check your setup by recording a WAV file and analyze in Edgeimpulse or use an audio tool like <em>Audacity</em>.</p> <p>Although you can use the microphone of your computer or smartphone, it is highly recommended to use your ESP32 microphone at least for a large amount of samples in order to train the model with the same pure sound quality, that it later has to run inference on. A working SD card config is the best way to capture training data.</p> <p>You can use a simple Berry driver from Tasmotas example collection to get this done:<br> <a href=https://github.com/arendst/Tasmota/blob/development/tasmota/berry/audio/wavrec.be>wavrec.be</a> </p> <p>Usage:<br> <code>waverec5 /test</code> - &gt; record 5 seconds to /test.wav</p> <p>Then you can talk into the microphone with around 1 word per second and later upload this file to your <a href=https://www.edgeimpulse.com/ >Edge Impulse</a> project via your computer.</p> <h3 id=general-strategies>General strategies<a class=headerlink href=#general-strategies title="Permanent link">~</a></h3> <ol> <li>Mix input samples from different microphones. Using the computer or phone for audio recording is way more user friendly, so add some samples the easy way. But without enough samples from your ESP32 microphone the final performance will be mediocre at best.</li> <li>Input samples from different speakers will very likely lead to a more robust model. So ask family and friends for help.</li> <li>More is more. Almost always adding more samples will result in a better performing model. Don't give up, if testing performance degrades in the early stages of audio harvesting. Just make sure to only add valid audio data with correct labels and the final result will improve with more audio data.</li> </ol> <h3 id=edge-impulse>Edge Impulse<a class=headerlink href=#edge-impulse title="Permanent link">~</a></h3> <p>For training on <a href=https://www.edgeimpulse.com/ >Edge Impulse</a> some post processing is usually necessary. </p> <p>If you have uploaded a sample containing many repetitions of one word, there is a convenient split function, that slices the long mega-sample into one-second samples. For very short words this works automatically pretty well, for longer words close to one second it is recommended to check and fix possible errors immediately.<br> You can check the resulting simple sample including the correct label: </p> <figcaption>16-bit-sample with label "computer":</figcaption> <p><img alt="Final sample" src=../_media/ml/audio_file.jpg></p> <p>The feature extraction step needs some parameters and will happen in the same way before training and later on-device. </p> <figcaption>MFCC parameters:</figcaption> <p><img alt="Feature parameters" src=../_media/ml/feature_parameters.png width=500></p> <p>This will create a feature array, which will stack the features of every slice on each other. This will be visualized as a heat map, where a slice is a column (oldest left) and the lines represent the frequency banks. Thus this "picture" holds the data of one second of audio, that the ML model will later "see" to do inference. </p> <figcaption>MFCC features for 1 second of audio:</figcaption> <p><img alt="Feature map" src=../_media/ml/features.png></p> <p>Configuring the neural network architecture can be done in a GUI. Following the rule to go deep (more layers) and not too wide (less neurons) results in smaller models. </p> <figcaption>"Deep" model for 7 keywords (plus unknown and noise) with size of only 14 kB:</figcaption> <p><img alt="Neural network architecture" src=../_media/ml/nn_arch.png width=500></p> <p>After training and configuring the model on Edgeimpulse we can simply download the TensorFlow Lite model from the dashboard (the int8 version) and upload it to the ESP32 filesystem. </p> <h3 id=tasmota-side>Tasmota Side<a class=headerlink href=#tasmota-side title="Permanent link">~</a></h3> <p>On the Tasmota side the feature settings have to be translated in Berry with a descriptor. The descriptor settings may change in the future! </p> <table> <thead> <tr> <th>number</th> <th style="text-align: left;">property</th> <th style="text-align: left;">value</th> </tr> </thead> <tbody> <tr> <td>0</td> <td style="text-align: left;">i2s_channel_fmt_t</td> <td style="text-align: left;">this is an old setting and ignored now, maybe used differently in the future</td> </tr> <tr> <td>1</td> <td style="text-align: left;">amplification factor</td> <td style="text-align: left;">this is an old setting and ignored now, maybe used differently in the future</td> </tr> <tr> <td>2</td> <td style="text-align: left;">slice duration<br><em>or</em> Frame length</td> <td style="text-align: left;">A slice of audio data in milliseconds. With the fixed audio settings 32 milliseconds translate to 512 samples, which as a power of 2 is a good fit for FFT.</td> </tr> <tr> <td>3</td> <td style="text-align: left;">slice stride<br><em>or</em> Frame stride</td> <td style="text-align: left;">Time in milliseconds between the starts of 2 adjacent slices. No overlap happens if duration and stride are equal. Lower values create more stress for the system. Values around and below 20 milliseconds may leads to problems. Bad Wifi will worsen things earlier!!</td> </tr> <tr> <td>4</td> <td style="text-align: left;">Filter number</td> <td style="text-align: left;">Number of captured mel energies. For MFE mode these are the feature values for one slice.</td> </tr> <tr> <td>5</td> <td style="text-align: left;">MFCC coefficients<br><em>or</em> Number of coefficients</td> <td style="text-align: left;">If not 0, this means we use MFCC mode and these are the feature values for one slice.</td> </tr> <tr> <td>6</td> <td style="text-align: left;">FFT size<br><em>or</em> FFT length</td> <td style="text-align: left;">In powers of 2. For now must be equal or greater than sample size, means slice duration of 32 ms -&gt; sample size 512 -&gt; 2^9 -&gt; 9</td> </tr> <tr> <td>7</td> <td style="text-align: left;">Inferences per second</td> <td style="text-align: left;">Typical values 4-10. More values need more averaging in post-processing, but will likely show less missed words.</td> </tr> <tr> <td>8</td> <td style="text-align: left;">Noisefloor</td> <td style="text-align: left;">In dB for MFE mode. Sound data with level below that threshold will be discarded.</td> </tr> <tr> <td>9</td> <td style="text-align: left;">preemphassis</td> <td style="text-align: left;">Factor will be divided by 100, so 98 -&gt; 0.98. It is recommended to not use this, as Edgeimpulse and Speechpy compute this over the whole sample, while Tasmota does this per slice, which is way more efficient but creates a difference. There is a way to overcome this. More later ...</td> </tr> </tbody> </table> <p>The Berry driver for the speech recognition must be adapted for every <em>model</em> and use case. A plain old ESP32 without extra PS-RAM is enough to "hear" with about 10 inferences per per second.</p> <p>Demo example:<br> <div class=highlight><pre><span></span><code><span class=c1># globals</span>
<span class=kd>var</span><span class=w> </span><span class=n>key_words</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;down&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;left&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;noise&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;right&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;up&quot;</span><span class=p>]</span><span class=w> </span><span class=c1># must match your trained model!! Edgeimpulse sorts them alphabetically</span>
<span class=kd>var</span><span class=w> </span><span class=n>thresholds</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>[</span><span class=mi>700</span><span class=p>,</span><span class=mi>710</span><span class=p>,</span><span class=mi>680</span><span class=p>,</span><span class=mi>680</span><span class=p>,</span><span class=mi>720</span><span class=p>]</span><span class=w> </span><span class=c1># same indices as key_words, increase against false positives, decrease against misses, </span>
<span class=w>                                       </span><span class=c1># max. theoretical value = 256 * number of averages for int8_t output tensor</span>

<span class=kd>class</span><span class=w> </span><span class=nc>PREDICTOR</span>
<span class=w>    </span><span class=kd>var</span><span class=w> </span><span class=n>avgs</span><span class=p>,</span><span class=w> </span><span class=n>sz</span><span class=p>,</span><span class=w> </span><span class=n>time_out</span>
<span class=w>    </span><span class=kd>var</span><span class=w> </span><span class=n>out_buf</span><span class=p>,</span><span class=w> </span><span class=n>out_buf_idx</span>

<span class=w>    </span><span class=kd>def</span><span class=w> </span><span class=nf>init</span><span class=p>(</span><span class=n>sz</span><span class=p>,</span><span class=w> </span><span class=n>averages</span><span class=p>)</span>
<span class=w>        </span><span class=kr>self</span><span class=p>.</span><span class=na>out_buf</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>bytes</span><span class=p>(</span><span class=o>-</span><span class=p>(</span><span class=n>averages</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>sz</span><span class=p>))</span><span class=w> </span><span class=c1># creates circular buffer for averaging</span>
<span class=w>        </span><span class=kr>self</span><span class=p>.</span><span class=na>out_buf_idx</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=w> </span>
<span class=w>        </span><span class=kr>self</span><span class=p>.</span><span class=na>time_out</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=w> </span><span class=c1># after successful word finding, make a break to avoid &quot;noise findings&quot;</span>
<span class=w>        </span><span class=kr>self</span><span class=p>.</span><span class=na>sz</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>sz</span><span class=w> </span><span class=c1># size of word list/output tensor</span>
<span class=w>        </span><span class=kr>self</span><span class=p>.</span><span class=na>avgs</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>averages</span><span class=w> </span><span class=c1># number of averaging/oversampling steps</span>
<span class=w>    </span><span class=k>end</span>

<span class=w>    </span><span class=kd>def</span><span class=w> </span><span class=nf>clear</span><span class=p>()</span><span class=w> </span><span class=c1># clear oversampling buffer after word was found</span>
<span class=w>        </span><span class=k>for</span><span class=w> </span><span class=n>i</span><span class=o>:</span><span class=mi>0</span><span class=o>..</span><span class=nb>size</span><span class=p>(</span><span class=kr>self</span><span class=p>.</span><span class=na>out_buf</span><span class=p>)</span><span class=mi>-1</span>
<span class=w>            </span><span class=kr>self</span><span class=p>.</span><span class=na>out_buf</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span>
<span class=w>        </span><span class=k>end</span>
<span class=w>    </span><span class=k>end</span>

<span class=w>    </span><span class=kd>def</span><span class=w> </span><span class=nf>run</span><span class=p>(</span><span class=n>data</span><span class=p>)</span>
<span class=w>        </span><span class=k>if</span><span class=w> </span><span class=kr>self</span><span class=p>.</span><span class=na>time_out</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>0</span>
<span class=w>            </span><span class=kr>self</span><span class=p>.</span><span class=na>time_out</span><span class=w> </span><span class=o>-=</span><span class=w> </span><span class=mi>1</span>
<span class=w>            </span><span class=k>return</span><span class=w> </span><span class=mi>255</span><span class=w> </span><span class=c1># return some error code = no result</span>
<span class=w>        </span><span class=k>end</span>

<span class=w>        </span><span class=k>for</span><span class=w> </span><span class=n>i</span><span class=o>:</span><span class=mi>0</span><span class=o>..</span><span class=p>(</span><span class=kr>self</span><span class=p>.</span><span class=na>sz</span><span class=mi>-1</span><span class=p>)</span>
<span class=w>            </span><span class=kr>self</span><span class=p>.</span><span class=na>out_buf</span><span class=p>[</span><span class=kr>self</span><span class=p>.</span><span class=na>out_buf_idx</span><span class=o>+</span><span class=n>i</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>data</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>
<span class=w>        </span><span class=k>end</span>
<span class=w>        </span><span class=kr>self</span><span class=p>.</span><span class=na>out_buf_idx</span><span class=w> </span><span class=o>+=</span><span class=w> </span><span class=kr>self</span><span class=p>.</span><span class=na>sz</span>
<span class=w>        </span><span class=k>if</span><span class=w> </span><span class=kr>self</span><span class=p>.</span><span class=na>out_buf_idx</span><span class=o>&gt;</span><span class=p>(</span><span class=kr>self</span><span class=p>.</span><span class=na>avgs</span><span class=mi>-1</span><span class=p>)</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=kr>self</span><span class=p>.</span><span class=na>sz</span>
<span class=w>            </span><span class=kr>self</span><span class=p>.</span><span class=na>out_buf_idx</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=w> </span>
<span class=w>        </span><span class=k>end</span>

<span class=w>        </span><span class=kd>var</span><span class=w> </span><span class=n>average</span>
<span class=w>        </span><span class=k>for</span><span class=w> </span><span class=n>i</span><span class=o>:</span><span class=mi>0</span><span class=o>..</span><span class=p>(</span><span class=kr>self</span><span class=p>.</span><span class=na>sz</span><span class=mi>-1</span><span class=p>)</span>
<span class=w>            </span><span class=n>average</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span>
<span class=w>            </span><span class=k>for</span><span class=w> </span><span class=n>j</span><span class=o>:</span><span class=mi>0</span><span class=o>..</span><span class=kr>self</span><span class=p>.</span><span class=na>avgs</span><span class=mi>-1</span>
<span class=w>                </span><span class=n>average</span><span class=w> </span><span class=o>+=</span><span class=w>  </span><span class=kr>self</span><span class=p>.</span><span class=na>out_buf</span><span class=p>[</span><span class=n>i</span><span class=o>+</span><span class=p>(</span><span class=n>j</span><span class=o>*</span><span class=kr>self</span><span class=p>.</span><span class=na>sz</span><span class=p>)]</span>
<span class=w>            </span><span class=k>end</span>
<span class=w>            </span><span class=c1># if i == 4</span>
<span class=w>            </span><span class=c1>#     print(average) # test the threshold for single words while developing, needed in the next step</span>
<span class=w>            </span><span class=c1># end</span>
<span class=w>            </span><span class=k>if</span><span class=w> </span><span class=n>average</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=n>thresholds</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=w> </span><span class=c1># find the threshold stored in the global list by trial and error</span>
<span class=w>                </span><span class=k>if</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=mi>2</span><span class=w> </span><span class=c1># this is the non-noise/unknown output - you must infer this from your model</span>
<span class=w>                    </span><span class=kr>self</span><span class=p>.</span><span class=nf>clear</span><span class=p>()</span><span class=w> </span><span class=c1># only clear the buffer after finding a keyword, not for noise/unknown</span>
<span class=w>                    </span><span class=kr>self</span><span class=p>.</span><span class=na>time_out</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>10</span><span class=w> </span><span class=c1># find the value by trial and error - good starting point is one second</span>
<span class=w>                                       </span><span class=c1># lower number allows faster speech, but might increase false positives</span>
<span class=w>                    </span><span class=nb>print</span><span class=p>(</span><span class=n>average</span><span class=p>)</span>
<span class=w>                </span><span class=k>end</span>
<span class=w>                </span><span class=k>return</span><span class=w> </span><span class=n>i</span>
<span class=w>            </span><span class=k>end</span>
<span class=w>        </span><span class=k>end</span>
<span class=w>        </span><span class=k>return</span><span class=w> </span><span class=mi>255</span><span class=w> </span><span class=c1># return some error code = no result</span>
<span class=w>    </span><span class=k>end</span>
<span class=k>end</span>

<span class=kd>class</span><span class=w> </span><span class=nc>MICROSPEECH</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>Driver</span>
<span class=w>    </span><span class=kd>var</span><span class=w> </span><span class=n>o</span><span class=p>,</span><span class=w> </span><span class=n>o_sz</span><span class=w>  </span><span class=c1># output tensor, size of output tensor</span>
<span class=w>    </span><span class=kd>var</span><span class=w> </span><span class=n>p</span><span class=w>        </span><span class=c1># predictor instance</span>
<span class=w>    </span><span class=kd>var</span><span class=w> </span><span class=n>model</span><span class=w>    </span><span class=c1># this var really holds the model data for the entire session</span>
<span class=w>    </span><span class=kd>var</span><span class=w> </span><span class=n>new_out</span><span class=w>  </span><span class=c1># current output sensor converted to uint8_t</span>

<span class=w>    </span><span class=kd>def</span><span class=w> </span><span class=nf>init</span><span class=p>()</span>
<span class=w>        </span><span class=kr>import</span><span class=w> </span><span class=n>TFL</span>
<span class=w>        </span><span class=kr>self</span><span class=p>.</span><span class=na>o_sz</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>size</span><span class=p>(</span><span class=n>key_words</span><span class=p>)</span><span class=w> </span><span class=c1># this value must be correctly taken from the model/training pipeline</span>
<span class=w>        </span><span class=kr>self</span><span class=p>.</span><span class=na>new_out</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>[]</span>
<span class=w>        </span><span class=kr>self</span><span class=p>.</span><span class=na>new_out</span><span class=p>.</span><span class=nf>resize</span><span class=p>(</span><span class=kr>self</span><span class=p>.</span><span class=na>o_sz</span><span class=p>)</span>
<span class=w>        </span><span class=kr>self</span><span class=p>.</span><span class=na>o</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>bytes</span><span class=p>(</span><span class=o>-</span><span class=kr>self</span><span class=p>.</span><span class=na>o_sz</span><span class=p>)</span><span class=w> </span><span class=c1># size must match the model</span>
<span class=w>        </span><span class=kr>self</span><span class=p>.</span><span class=na>p</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>PREDICTOR</span><span class=p>(</span><span class=kr>self</span><span class=p>.</span><span class=na>o_sz</span><span class=p>,</span><span class=mi>4</span><span class=p>)</span><span class=w> </span><span class=c1># second arg is number of averages for prediction</span>

<span class=w>        </span><span class=kd>var</span><span class=w> </span><span class=n>descriptor</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>bytes</span><span class=p>(</span><span class=mi>-10</span><span class=p>)</span>
<span class=w>        </span><span class=n>descriptor</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>4</span><span class=w>  </span><span class=c1># ignored</span>
<span class=w>        </span><span class=n>descriptor</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>16</span><span class=w> </span><span class=c1># ignored</span>
<span class=w>        </span><span class=n>descriptor</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>32</span><span class=w> </span><span class=c1># slice_dur in ms </span>
<span class=w>        </span><span class=n>descriptor</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>32</span><span class=w> </span><span class=c1># slice_stride in ms</span>
<span class=w>        </span><span class=n>descriptor</span><span class=p>[</span><span class=mi>4</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>26</span><span class=w> </span><span class=c1># mfe filter (= features if MFE mode)</span>
<span class=w>        </span><span class=n>descriptor</span><span class=p>[</span><span class=mi>5</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>13</span><span class=w> </span><span class=c1># mfcc coefficients, if 0 -&gt; compute MFE only</span>
<span class=w>        </span><span class=n>descriptor</span><span class=p>[</span><span class=mi>6</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>9</span><span class=w>  </span><span class=c1># 2^9 = 512 fft_bins</span>
<span class=w>        </span><span class=n>descriptor</span><span class=p>[</span><span class=mi>7</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>10</span><span class=w> </span><span class=c1># max. invocations per second - find best value by testing on device</span>
<span class=w>        </span><span class=n>descriptor</span><span class=p>[</span><span class=mi>8</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>52</span><span class=w> </span><span class=c1># db noisefloor -&gt; negative value</span>
<span class=w>        </span><span class=n>descriptor</span><span class=p>[</span><span class=mi>9</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=w> </span><span class=c1># preemphasis</span>
<span class=w>        </span><span class=n>TFL</span><span class=p>.</span><span class=nf>begin</span><span class=p>(</span><span class=s2>&quot;MIC&quot;</span><span class=p>,</span><span class=n>descriptor</span><span class=p>)</span>
<span class=w>        </span><span class=kr>self</span><span class=p>.</span><span class=na>model</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>open</span><span class=p>(</span><span class=s2>&quot;mfcc.lite&quot;</span><span class=p>).</span><span class=nf>readbytes</span><span class=p>()</span><span class=w> </span><span class=c1># file must be present on the ESP</span>
<span class=w>        </span><span class=k>if</span><span class=w> </span><span class=kr>self</span><span class=p>.</span><span class=na>model</span>
<span class=w>            </span><span class=n>TFL</span><span class=p>.</span><span class=nf>load</span><span class=p>(</span><span class=kr>self</span><span class=p>.</span><span class=na>model</span><span class=p>,</span><span class=kr>self</span><span class=p>.</span><span class=na>o</span><span class=p>,</span><span class=mi>28000</span><span class=p>)</span>
<span class=w>        </span><span class=k>end</span>
<span class=w>    </span><span class=k>end</span>

<span class=w>    </span><span class=kd>def</span><span class=w> </span><span class=nf>every_50ms</span><span class=p>()</span>
<span class=w>        </span><span class=kr>import</span><span class=w> </span><span class=n>TFL</span>
<span class=w>        </span><span class=k>if</span><span class=w> </span><span class=n>TFL</span><span class=p>.</span><span class=nf>output</span><span class=p>(</span><span class=kr>self</span><span class=p>.</span><span class=na>o</span><span class=p>)</span>
<span class=w>            </span><span class=k>for</span><span class=w> </span><span class=n>i</span><span class=o>:</span><span class=mi>0</span><span class=o>..</span><span class=p>(</span><span class=kr>self</span><span class=p>.</span><span class=na>o_sz</span><span class=mi>-1</span><span class=p>)</span>
<span class=w>                </span><span class=kr>self</span><span class=p>.</span><span class=na>new_out</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kr>self</span><span class=p>.</span><span class=na>o</span><span class=p>.</span><span class=nf>geti</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=mi>1</span><span class=p>)</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mi>128</span>
<span class=w>            </span><span class=k>end</span>
<span class=w>            </span><span class=c1>#print(self.new_out)</span>
<span class=w>            </span><span class=kd>var</span><span class=w> </span><span class=n>r</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kr>self</span><span class=p>.</span><span class=na>p</span><span class=p>.</span><span class=nf>run</span><span class=p>(</span><span class=kr>self</span><span class=p>.</span><span class=na>new_out</span><span class=p>)</span>
<span class=w>            </span><span class=k>if</span><span class=w> </span><span class=n>r</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=mi>2</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=n>r</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=mi>255</span><span class=w> </span><span class=c1># in this example not noise/unknown/error code - can be more complex</span>
<span class=w>                </span><span class=nb>print</span><span class=p>(</span><span class=n>key_words</span><span class=p>[</span><span class=n>r</span><span class=p>])</span>
<span class=w>                </span><span class=c1># do something useful</span>
<span class=w>            </span><span class=k>end</span>
<span class=w>        </span><span class=k>end</span>
<span class=w>        </span><span class=kd>var</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>TFL</span><span class=p>.</span><span class=nf>log</span><span class=p>()</span>
<span class=w>        </span><span class=k>if</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=nb>print</span><span class=p>(</span><span class=n>s</span><span class=p>)</span><span class=w> </span><span class=k>end</span>
<span class=w>    </span><span class=k>end</span>
<span class=k>end</span>

<span class=kd>var</span><span class=w> </span><span class=n>mic</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>MICROSPEECH</span><span class=p>()</span>

<span class=n>tasmota</span><span class=p>.</span><span class=nf>add_driver</span><span class=p>(</span><span class=n>mic</span><span class=p>)</span>
</code></pre></div></p> <h2 id=image-classification>Image classification<a class=headerlink href=#image-classification title="Permanent link">~</a></h2> <p>This is really a huge task for any ESP32 and needs some "treatment" to make life as easy as possible for this tiny and weak platform. Do not expect easy success.<br> As other projects have shown before it is important to create an optimal photo capture setup, which typically involves 3D printed housing.<br> Excellent and extensive information can be found here: <a href=https://jomjol.github.io/AI-on-the-edge-device-docs/ >AI-on-the-edge-device</a></p> <p>In Tasmota we use a generic and flexible approach, which does not use a special mode of the TFL module.<br> The biggest chunk of work goes into model creation and the hardware setup. Once this is solved, running inference on the ESP with a Berry script should not be a showstopper. </p> <h3 id=ml-learning-by-doing>ML-learning by doing<a class=headerlink href=#ml-learning-by-doing title="Permanent link">~</a></h3> <p>Let's walk through a simple example step by step.<br> The object to observe has a very common 7-segment display, which could show any type of data, but here it is just a clock. </p> <h3 id=camera-setup>Camera setup<a class=headerlink href=#camera-setup title="Permanent link">~</a></h3> <p>First step is to create the capture setup. If we would change this later, most of the next step will need to be done again. As the main problem of any ESP is the lack of memory, it is important to use the lowest camera resolution, that get's the job done. Orthographic projection wil produce the least artifacts, so we try to come as close to this as possible. </p> <h3 id=roi-creation>ROI creation<a class=headerlink href=#roi-creation title="Permanent link">~</a></h3> <p>Now we must create definitions of regions of interest for every digit, that will be used later in the Berry script. This can be done with the help of a web tool right here in the docs: <a href=../ROI-editor/ >ROI editor</a></p> <figcaption>ROI editor - create 2D affine matrix:</figcaption> <p><img alt="ROI editor" src=../_media/ml/roi_editor.png width=700></p> <p>You can select-copy-paste the matrix definition for later use as it is already valid Berry code. The ROI pictures can be saved (with chrome based browser) to be used in the training process later. </p> <p>After we have a feasible construction, we can think about the model. </p> <h3 id=model-training>Model training<a class=headerlink href=#model-training title="Permanent link">~</a></h3> <p>A ready made model "from somewhere" is the fastest option, but here we create one from scratch. </p> <p>To train it, we typically need thousands of photos. This would be a pretty insane task to shoot by hand. That's why the demo model was created with the help of synthetic image creation, which includes a so called "image augmentation". This means the creation of multiple slight abbreviations of one source image, which typically involves scaling, shearing, blurring, noise addition, contrast variation and in this case image inversion. Very likely we must add some original pictures from the observed display, which we can get from the ROI editor. </p> <p>Again we use Edgeimpulse to finally create the model. The demo project can be found here:<br> <a href=https://studio.edgeimpulse.com/public/436849/live>7-segment</a><br> Here we can see the uploaded images and model design - similar to the speech recognition example from above.</p> <p>From the dashboard we can download the final model file with the type <code>TensorFlow Lite (int8 quantized)</code> which is about 17 KB in size. </p> <h3 id=berry-implementation>Berry implementation<a class=headerlink href=#berry-implementation title="Permanent link">~</a></h3> <p>Finally we must put it all together. We need the model binary file and write the Berry script to use it.<br> For demo purposes the following script can run inference on the demo image from the docs: <a href=../_media/ml/dt.jpg>dt.jpg</a>, which must be uploaded to the ESP.<br> Download the <a href=https://studio.edgeimpulse.com/v1/api/436849/learn-data/14/model/tflite-int8>model</a>, name it <code>7d.lite</code> and upload it too.</p> <p>Now save the Berry script as <code>digits.be</code> and start with <code>br load("digits")</code> from the normal console or with <code>load("digits")</code> from the Berry console. </p> <div class=highlight><pre><span></span><code><span class=kd>class</span><span class=w> </span><span class=nc>ROI_DSC</span>
<span class=w>    </span><span class=kd>var</span><span class=w> </span><span class=n>_dsc</span>

<span class=w>    </span><span class=kd>def</span><span class=w> </span><span class=nf>init</span><span class=p>()</span>
<span class=w>        </span><span class=kr>self</span><span class=p>.</span><span class=na>_dsc</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>[]</span>
<span class=w>        </span><span class=kd>var</span><span class=w> </span><span class=n>d1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=s2>&quot;width&quot;</span><span class=o>:</span><span class=w> </span><span class=mi>32</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;height&quot;</span><span class=o>:</span><span class=w> </span><span class=mi>32</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;scaleX&quot;</span><span class=o>:</span><span class=w> </span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;shearY&quot;</span><span class=o>:</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;transX&quot;</span><span class=o>:</span><span class=w> </span><span class=mi>189</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;scaleY&quot;</span><span class=o>:</span><span class=w> </span><span class=mi>2</span><span class=mf>.5161290322580645</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;shearX&quot;</span><span class=o>:</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;transY&quot;</span><span class=o>:</span><span class=w> </span><span class=mi>213</span><span class=w> </span><span class=p>}</span>
<span class=w>        </span><span class=kr>self</span><span class=p>.</span><span class=na>_dsc</span><span class=p>.</span><span class=nf>push</span><span class=p>(</span><span class=kr>self</span><span class=p>.</span><span class=nf>roi_dsc</span><span class=p>(</span><span class=n>d1</span><span class=p>))</span>
<span class=w>        </span><span class=kd>var</span><span class=w> </span><span class=n>d2</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=s2>&quot;width&quot;</span><span class=o>:</span><span class=w> </span><span class=mi>32</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;height&quot;</span><span class=o>:</span><span class=w> </span><span class=mi>32</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;scaleX&quot;</span><span class=o>:</span><span class=w> </span><span class=mi>1</span><span class=mf>.4193548387096775</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;shearY&quot;</span><span class=o>:</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;transX&quot;</span><span class=o>:</span><span class=w> </span><span class=mi>215</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;scaleY&quot;</span><span class=o>:</span><span class=w> </span><span class=mi>2</span><span class=mf>.5161290322580645</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;shearX&quot;</span><span class=o>:</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;transY&quot;</span><span class=o>:</span><span class=w> </span><span class=mi>210</span><span class=w> </span><span class=p>}</span>
<span class=w>        </span><span class=kr>self</span><span class=p>.</span><span class=na>_dsc</span><span class=p>.</span><span class=nf>push</span><span class=p>(</span><span class=kr>self</span><span class=p>.</span><span class=nf>roi_dsc</span><span class=p>(</span><span class=n>d2</span><span class=p>))</span>
<span class=w>        </span><span class=kd>var</span><span class=w> </span><span class=n>d3</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=s2>&quot;width&quot;</span><span class=o>:</span><span class=w> </span><span class=mi>32</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;height&quot;</span><span class=o>:</span><span class=w> </span><span class=mi>32</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;scaleX&quot;</span><span class=o>:</span><span class=w> </span><span class=mi>1</span><span class=mf>.4193548387096775</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;shearY&quot;</span><span class=o>:</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;transX&quot;</span><span class=o>:</span><span class=w> </span><span class=mi>269</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;scaleY&quot;</span><span class=o>:</span><span class=w> </span><span class=mi>2</span><span class=mf>.5161290322580645</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;shearX&quot;</span><span class=o>:</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;transY&quot;</span><span class=o>:</span><span class=w> </span><span class=mi>205</span><span class=w> </span><span class=p>}</span>
<span class=w>        </span><span class=kr>self</span><span class=p>.</span><span class=na>_dsc</span><span class=p>.</span><span class=nf>push</span><span class=p>(</span><span class=kr>self</span><span class=p>.</span><span class=nf>roi_dsc</span><span class=p>(</span><span class=n>d3</span><span class=p>))</span>
<span class=w>        </span><span class=kd>var</span><span class=w> </span><span class=n>d4</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=s2>&quot;width&quot;</span><span class=o>:</span><span class=w> </span><span class=mi>32</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;height&quot;</span><span class=o>:</span><span class=w> </span><span class=mi>32</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;scaleX&quot;</span><span class=o>:</span><span class=w> </span><span class=mi>1</span><span class=mf>.4193548387096775</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;shearY&quot;</span><span class=o>:</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;transX&quot;</span><span class=o>:</span><span class=w> </span><span class=mi>315</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;scaleY&quot;</span><span class=o>:</span><span class=w> </span><span class=mi>2</span><span class=mf>.5161290322580645</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;shearX&quot;</span><span class=o>:</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;transY&quot;</span><span class=o>:</span><span class=w> </span><span class=mi>200</span><span class=w> </span><span class=p>}</span>
<span class=w>        </span><span class=kr>self</span><span class=p>.</span><span class=na>_dsc</span><span class=p>.</span><span class=nf>push</span><span class=p>(</span><span class=kr>self</span><span class=p>.</span><span class=nf>roi_dsc</span><span class=p>(</span><span class=n>d4</span><span class=p>))</span>
<span class=w>    </span><span class=k>end</span>

<span class=w>    </span><span class=kd>def</span><span class=w> </span><span class=nf>get</span><span class=p>(</span><span class=n>idx</span><span class=p>)</span>
<span class=w>        </span><span class=k>if</span><span class=w> </span><span class=n>idx</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=p>(</span><span class=nb>size</span><span class=p>(</span><span class=kr>self</span><span class=p>.</span><span class=na>_dsc</span><span class=p>)</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=mi>1</span><span class=p>)</span>
<span class=w>            </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span>
<span class=w>        </span><span class=k>end</span>
<span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kr>self</span><span class=p>.</span><span class=na>_dsc</span><span class=p>[</span><span class=n>idx</span><span class=p>]</span>
<span class=w>    </span><span class=k>end</span>

<span class=w>    </span><span class=kd>def</span><span class=w> </span><span class=nf>roi_dsc</span><span class=p>(</span><span class=n>m</span><span class=p>)</span>
<span class=w>        </span><span class=kd>var</span><span class=w> </span><span class=n>d</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>bytes</span><span class=p>(</span><span class=mi>-24</span><span class=p>)</span>
<span class=w>        </span><span class=n>d</span><span class=p>.</span><span class=nf>setfloat</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=n>m</span><span class=p>[</span><span class=s2>&quot;scaleX&quot;</span><span class=p>])</span>
<span class=w>        </span><span class=n>d</span><span class=p>.</span><span class=nf>setfloat</span><span class=p>(</span><span class=mi>4</span><span class=p>,</span><span class=n>m</span><span class=p>[</span><span class=s2>&quot;shearX&quot;</span><span class=p>])</span>
<span class=w>        </span><span class=n>d</span><span class=p>.</span><span class=nf>setfloat</span><span class=p>(</span><span class=mi>8</span><span class=p>,</span><span class=n>m</span><span class=p>[</span><span class=s2>&quot;shearY&quot;</span><span class=p>])</span>
<span class=w>        </span><span class=n>d</span><span class=p>.</span><span class=nf>setfloat</span><span class=p>(</span><span class=mi>12</span><span class=p>,</span><span class=n>m</span><span class=p>[</span><span class=s2>&quot;scaleY&quot;</span><span class=p>])</span>
<span class=w>        </span><span class=n>d</span><span class=p>.</span><span class=nf>seti</span><span class=p>(</span><span class=mi>16</span><span class=p>,</span><span class=n>m</span><span class=p>[</span><span class=s2>&quot;transX&quot;</span><span class=p>],</span><span class=mi>2</span><span class=p>)</span>
<span class=w>        </span><span class=n>d</span><span class=p>.</span><span class=nf>seti</span><span class=p>(</span><span class=mi>18</span><span class=p>,</span><span class=n>m</span><span class=p>[</span><span class=s2>&quot;transY&quot;</span><span class=p>],</span><span class=mi>2</span><span class=p>)</span>
<span class=w>        </span><span class=n>d</span><span class=p>.</span><span class=nf>seti</span><span class=p>(</span><span class=mi>20</span><span class=p>,</span><span class=n>m</span><span class=p>[</span><span class=s2>&quot;width&quot;</span><span class=p>],</span><span class=mi>2</span><span class=p>)</span>
<span class=w>        </span><span class=n>d</span><span class=p>.</span><span class=nf>seti</span><span class=p>(</span><span class=mi>22</span><span class=p>,</span><span class=n>m</span><span class=p>[</span><span class=s2>&quot;height&quot;</span><span class=p>],</span><span class=mi>2</span><span class=p>)</span>
<span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>d</span>
<span class=w>    </span><span class=k>end</span>
<span class=k>end</span>

<span class=kd>class</span><span class=w> </span><span class=nc>DIGITS</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>Driver</span>
<span class=w>    </span><span class=kd>var</span><span class=w> </span><span class=n>out</span><span class=p>,</span><span class=w> </span><span class=n>model</span>
<span class=w>    </span><span class=kd>var</span><span class=w> </span><span class=n>cam_img</span>
<span class=w>    </span><span class=kd>var</span><span class=w> </span><span class=n>dsc</span>
<span class=w>    </span><span class=kd>var</span><span class=w> </span><span class=n>result</span><span class=p>,</span><span class=w> </span><span class=n>idx</span><span class=p>,</span><span class=w> </span><span class=n>idx_step</span><span class=p>,</span><span class=w> </span><span class=n>need_input</span>


<span class=w>    </span><span class=kd>def</span><span class=w> </span><span class=nf>init</span><span class=p>()</span>
<span class=w>        </span><span class=kr>self</span><span class=p>.</span><span class=nf>initTFL</span><span class=p>()</span>
<span class=w>        </span><span class=kr>self</span><span class=p>.</span><span class=na>cam_img</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>img</span><span class=p>()</span>
<span class=w>        </span><span class=kr>self</span><span class=p>.</span><span class=na>dsc</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>ROI_DSC</span><span class=p>()</span>
<span class=w>        </span><span class=kr>self</span><span class=p>.</span><span class=na>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>[</span><span class=mi>-1</span><span class=p>,</span><span class=mi>-1</span><span class=p>,</span><span class=mi>-1</span><span class=p>,</span><span class=mi>-1</span><span class=p>]</span>
<span class=w>        </span><span class=kr>self</span><span class=p>.</span><span class=na>idx</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span>
<span class=w>        </span><span class=kr>self</span><span class=p>.</span><span class=na>idx_step</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span>
<span class=w>        </span><span class=kr>self</span><span class=p>.</span><span class=na>need_input</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>true</span>

<span class=w>        </span><span class=kr>self</span><span class=p>.</span><span class=nf>initCam</span><span class=p>()</span><span class=w> </span>
<span class=w>        </span><span class=kr>self</span><span class=p>.</span><span class=nf>initFromFile</span><span class=p>()</span><span class=w> </span><span class=c1># for the demo</span>
<span class=w>        </span><span class=c1># self.updateImg() # really take picture from cam</span>
<span class=w>        </span><span class=n>tasmota</span><span class=p>.</span><span class=nf>add_driver</span><span class=p>(</span><span class=kr>self</span><span class=p>)</span>
<span class=w>    </span><span class=k>end</span>

<span class=w>    </span><span class=kd>def</span><span class=w> </span><span class=nf>stop</span><span class=p>()</span>
<span class=w>        </span><span class=kr>self</span><span class=p>.</span><span class=na>tasmota</span><span class=p>.</span><span class=nf>remove_driver</span><span class=p>(</span><span class=kr>self</span><span class=p>)</span>
<span class=w>    </span><span class=k>end</span>

<span class=w>    </span><span class=kd>def</span><span class=w> </span><span class=nf>initCam</span><span class=p>()</span>
<span class=w>        </span><span class=kr>import</span><span class=w> </span><span class=n>cam</span>
<span class=w>        </span><span class=n>cam</span><span class=p>.</span><span class=nf>setup</span><span class=p>(</span><span class=mi>8</span><span class=p>)</span><span class=w> </span><span class=c1># 640 * 480</span>
<span class=w>    </span><span class=k>end</span>

<span class=w>    </span><span class=kd>def</span><span class=w> </span><span class=nf>initFromFile</span><span class=p>()</span><span class=w> </span><span class=c1># utility method for demo testing/debugging</span>
<span class=w>        </span><span class=kd>var</span><span class=w> </span><span class=n>f</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>open</span><span class=p>(</span><span class=s2>&quot;/dt.jpg&quot;</span><span class=p>,</span><span class=s2>&quot;r&quot;</span><span class=p>)</span>
<span class=w>        </span><span class=kd>var</span><span class=w> </span><span class=n>b</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>f</span><span class=p>.</span><span class=nf>readbytes</span><span class=p>()</span>
<span class=w>        </span><span class=n>f</span><span class=p>.</span><span class=nf>close</span><span class=p>()</span>
<span class=w>        </span><span class=kr>self</span><span class=p>.</span><span class=na>cam_img</span><span class=p>.</span><span class=nf>from_jpg</span><span class=p>(</span><span class=n>b</span><span class=p>,</span><span class=n>img</span><span class=p>.</span><span class=na>GRAYSCALE</span><span class=p>)</span>
<span class=w>        </span><span class=n>b</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>nil</span>
<span class=w>        </span><span class=n>tasmota</span><span class=p>.</span><span class=nf>gc</span><span class=p>()</span>
<span class=w>    </span><span class=k>end</span>

<span class=w>    </span><span class=kd>def</span><span class=w> </span><span class=nf>updateImg</span><span class=p>()</span>
<span class=w>        </span><span class=kr>import</span><span class=w> </span><span class=n>cam</span>
<span class=w>        </span><span class=n>cam</span><span class=p>.</span><span class=nf>get_image</span><span class=p>(</span><span class=kr>self</span><span class=p>.</span><span class=na>cam_img</span><span class=p>,</span><span class=n>img</span><span class=p>.</span><span class=na>GRAYSCALE</span><span class=p>)</span>
<span class=w>    </span><span class=k>end</span>

<span class=w>    </span><span class=kd>def</span><span class=w> </span><span class=nf>initTFL</span><span class=p>()</span>
<span class=w>        </span><span class=kr>import</span><span class=w> </span><span class=n>TFL</span>
<span class=w>        </span><span class=n>TFL</span><span class=p>.</span><span class=nf>begin</span><span class=p>(</span><span class=s2>&quot;BUF&quot;</span><span class=p>)</span><span class=w>  </span><span class=c1># generic TFL session </span>
<span class=w>        </span><span class=kr>self</span><span class=p>.</span><span class=na>out</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>bytes</span><span class=p>(</span><span class=mi>-10</span><span class=p>)</span><span class=w> </span><span class=c1># one output for every digit</span>
<span class=w>        </span><span class=kr>self</span><span class=p>.</span><span class=na>model</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>open</span><span class=p>(</span><span class=s2>&quot;/7d.lite&quot;</span><span class=p>).</span><span class=nf>readbytes</span><span class=p>()</span><span class=w> </span><span class=c1># this binary file must have been saved in the FS before</span>
<span class=w>        </span><span class=n>TFL</span><span class=p>.</span><span class=nf>load</span><span class=p>(</span><span class=kr>self</span><span class=p>.</span><span class=na>model</span><span class=p>,</span><span class=kr>self</span><span class=p>.</span><span class=na>out</span><span class=p>,</span><span class=mi>20000</span><span class=p>)</span><span class=w> </span><span class=c1># load and run, find value for memory allocation by trial and error</span>
<span class=w>    </span><span class=k>end</span>

<span class=w>    </span><span class=kd>def</span><span class=w> </span><span class=nf>handle_inference</span><span class=p>()</span>
<span class=w>        </span><span class=kr>import</span><span class=w> </span><span class=n>mqtt</span>
<span class=w>        </span><span class=kd>var</span><span class=w> </span><span class=n>digit</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kr>self</span><span class=p>.</span><span class=nf>predict</span><span class=p>()</span>
<span class=w>        </span><span class=k>if</span><span class=w> </span><span class=n>digit</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>nil</span>
<span class=w>            </span><span class=kr>self</span><span class=p>.</span><span class=na>result</span><span class=p>[</span><span class=kr>self</span><span class=p>.</span><span class=na>idx</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>-1</span>
<span class=w>            </span><span class=c1># mqtt.publish(&quot;tele/display&quot;,format(&#39;{&quot;time&quot;:&quot;error&quot;}&#39;))</span>
<span class=w>        </span><span class=k>else</span>
<span class=w>            </span><span class=kr>self</span><span class=p>.</span><span class=na>result</span><span class=p>[</span><span class=kr>self</span><span class=p>.</span><span class=na>idx</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>digit</span>
<span class=w>        </span><span class=k>end</span>
<span class=w>        </span><span class=kr>self</span><span class=p>.</span><span class=na>idx</span><span class=w> </span><span class=o>+=</span><span class=w> </span><span class=mi>1</span>
<span class=w>        </span><span class=k>if</span><span class=w> </span><span class=kr>self</span><span class=p>.</span><span class=na>idx</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=nb>size</span><span class=p>(</span><span class=kr>self</span><span class=p>.</span><span class=na>result</span><span class=p>)</span><span class=w> </span><span class=c1># full run over 4 digits complete</span>
<span class=w>            </span><span class=kr>self</span><span class=p>.</span><span class=na>idx</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span>

<span class=w>            </span><span class=c1># self.updateImg() # now we might take the next picture</span>

<span class=w>            </span><span class=nf>log</span><span class=p>(</span><span class=n>f</span><span class=s2>&quot;Complete result: {self.result[0]}{self.result[1]}:{self.result[2]}{self.result[3]}&quot;</span><span class=p>)</span><span class=w> </span><span class=c1># or mqtt publish</span>
<span class=w>            </span><span class=c1># mqtt.publish(&quot;tele/clock&quot;,format(&#39;{&quot;time&quot;:&quot;%i%i:%i%i&quot;}&#39;,self.result[0],self.result[1],self.result[2],self.result[3]))</span>
<span class=w>        </span><span class=k>end</span>
<span class=w>        </span><span class=nf>log</span><span class=p>(</span><span class=n>f</span><span class=s2>&quot;DIG: result of inference: {digit} for {self.idx}&quot;</span><span class=p>,</span><span class=mi>3</span><span class=p>)</span>
<span class=w>        </span><span class=kr>self</span><span class=p>.</span><span class=na>need_input</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>true</span>
<span class=w>    </span><span class=k>end</span>

<span class=w>    </span><span class=kd>def</span><span class=w> </span><span class=nf>update_input</span><span class=p>()</span>
<span class=w>        </span><span class=kr>import</span><span class=w> </span><span class=n>TFL</span>
<span class=w>        </span><span class=kd>var</span><span class=w> </span><span class=n>next_dsc</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kr>self</span><span class=p>.</span><span class=na>dsc</span><span class=p>.</span><span class=nf>get</span><span class=p>(</span><span class=kr>self</span><span class=p>.</span><span class=na>idx</span><span class=p>)</span>
<span class=w>        </span><span class=kd>var</span><span class=w> </span><span class=n>roi</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kr>self</span><span class=p>.</span><span class=na>cam_img</span><span class=p>.</span><span class=nf>get_buffer</span><span class=p>(</span><span class=n>next_dsc</span><span class=p>)</span>
<span class=w>        </span><span class=k>if</span><span class=w> </span><span class=n>TFL</span><span class=p>.</span><span class=nb>input</span><span class=p>(</span><span class=n>roi</span><span class=p>,</span><span class=w> </span><span class=kc>true</span><span class=p>)</span>
<span class=w>            </span><span class=kr>self</span><span class=p>.</span><span class=na>need_input</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>false</span>
<span class=w>        </span><span class=k>end</span>
<span class=w>    </span><span class=k>end</span>

<span class=w>    </span><span class=kd>def</span><span class=w> </span><span class=nf>every_100ms</span><span class=p>()</span><span class=w> </span><span class=c1># not aiming at </span>
<span class=w>        </span><span class=kr>import</span><span class=w> </span><span class=n>TFL</span>
<span class=w>        </span><span class=k>if</span><span class=w> </span><span class=kr>self</span><span class=p>.</span><span class=na>need_input</span>
<span class=w>            </span><span class=kr>self</span><span class=p>.</span><span class=nf>update_input</span><span class=p>()</span>
<span class=w>        </span><span class=k>elif</span><span class=w> </span><span class=n>TFL</span><span class=p>.</span><span class=nf>output</span><span class=p>(</span><span class=kr>self</span><span class=p>.</span><span class=na>out</span><span class=p>)</span>
<span class=w>            </span><span class=kr>self</span><span class=p>.</span><span class=nf>handle_inference</span><span class=p>()</span>
<span class=w>        </span><span class=k>end</span>
<span class=w>        </span><span class=kd>var</span><span class=w> </span><span class=n>log_msg</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>TFL</span><span class=p>.</span><span class=nf>log</span><span class=p>()</span><span class=w> </span><span class=c1># receive log messages from the TF lite tasks</span>
<span class=w>        </span><span class=k>if</span><span class=w> </span><span class=n>log_msg</span><span class=w> </span><span class=nf>log</span><span class=p>(</span><span class=n>f</span><span class=s2>&quot;TFL: {log_msg}&quot;</span><span class=p>,</span><span class=mi>3</span><span class=p>)</span><span class=w> </span><span class=k>end</span><span class=w> </span>
<span class=w>    </span><span class=k>end</span>

<span class=w>    </span><span class=kd>def</span><span class=w> </span><span class=nf>predict</span><span class=p>()</span>
<span class=w>        </span><span class=c1># very simple implementation</span>
<span class=w>        </span><span class=kd>var</span><span class=w> </span><span class=n>max_val</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>-128</span>
<span class=w>        </span><span class=kd>var</span><span class=w> </span><span class=n>threshold</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=w> </span><span class=c1># find out empirically</span>
<span class=w>        </span><span class=kd>var</span><span class=w> </span><span class=n>digit</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>nil</span>
<span class=w>        </span><span class=k>for</span><span class=w> </span><span class=n>idx</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=mi>0</span><span class=o>..</span><span class=p>(</span><span class=nb>size</span><span class=p>(</span><span class=kr>self</span><span class=p>.</span><span class=na>out</span><span class=p>)</span><span class=mi>-1</span><span class=p>)</span>
<span class=w>            </span><span class=kd>var</span><span class=w> </span><span class=n>score</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kr>self</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=nf>geti</span><span class=p>(</span><span class=n>idx</span><span class=p>,</span><span class=mi>1</span><span class=p>)</span>
<span class=w>            </span><span class=k>if</span><span class=w> </span><span class=n>max_val</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>score</span>
<span class=w>                </span><span class=k>if</span><span class=w> </span><span class=n>score</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=n>threshold</span>
<span class=w>                    </span><span class=n>digit</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>idx</span>
<span class=w>                </span><span class=k>end</span>
<span class=w>                </span><span class=n>max_val</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>score</span>
<span class=w>            </span><span class=k>end</span>
<span class=w>        </span><span class=k>end</span>
<span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>digit</span>
<span class=w>    </span><span class=k>end</span>
<span class=k>end</span>

<span class=n>digits</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>DIGITS</span><span class=p>()</span>
</code></pre></div> <p>This will print the clock string to the console and can be used as a starting point for real world use cases.</p> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://discord.gg/Ks2Kzd4 target=_blank rel=noopener title=discord.gg class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 576 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M492.5 69.8c-.2-.3-.4-.6-.8-.7-38.1-17.5-78.4-30-119.7-37.1-.4-.1-.8 0-1.1.1s-.6.4-.8.8c-5.5 9.9-10.5 20.2-14.9 30.6-44.6-6.8-89.9-6.8-134.4 0-4.5-10.5-9.5-20.7-15.1-30.6-.2-.3-.5-.6-.8-.8s-.7-.2-1.1-.2C162.5 39 122.2 51.5 84.1 69c-.3.1-.6.4-.8.7C7.1 183.5-13.8 294.6-3.6 404.2c0 .3.1.5.2.8s.3.4.5.6c44.4 32.9 94 58 146.8 74.2.4.1.8.1 1.1 0s.7-.4.9-.7c11.3-15.4 21.4-31.8 30-48.8.1-.2.2-.5.2-.8s0-.5-.1-.8-.2-.5-.4-.6-.4-.3-.7-.4c-15.8-6.1-31.2-13.4-45.9-21.9-.3-.2-.5-.4-.7-.6s-.3-.6-.3-.9 0-.6.2-.9.3-.5.6-.7c3.1-2.3 6.2-4.7 9.1-7.1.3-.2.6-.4.9-.4s.7 0 1 .1c96.2 43.9 200.4 43.9 295.5 0 .3-.1.7-.2 1-.2s.7.2.9.4c2.9 2.4 6 4.9 9.1 7.2.2.2.4.4.6.7s.2.6.2.9-.1.6-.3.9-.4.5-.6.6c-14.7 8.6-30 15.9-45.9 21.8-.2.1-.5.2-.7.4s-.3.4-.4.7-.1.5-.1.8.1.5.2.8c8.8 17 18.8 33.3 30 48.8.2.3.6.6.9.7s.8.1 1.1 0c52.9-16.2 102.6-41.3 147.1-74.2.2-.2.4-.4.5-.6s.2-.5.2-.8c12.3-126.8-20.5-236.9-86.9-334.5zm-302 267.7c-29 0-52.8-26.6-52.8-59.2s23.4-59.2 52.8-59.2c29.7 0 53.3 26.8 52.8 59.2 0 32.7-23.4 59.2-52.8 59.2m195.4 0c-29 0-52.8-26.6-52.8-59.2s23.4-59.2 52.8-59.2c29.7 0 53.3 26.8 52.8 59.2 0 32.7-23.2 59.2-52.8 59.2"/></svg> </a> <a href=https://t.me/tasmota target=_blank rel=noopener title=t.me class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M256 8a248 248 0 1 0 0 496 248 248 0 1 0 0-496m115 168.7c-3.7 39.2-19.9 134.4-28.1 178.3-3.5 18.6-10.3 24.8-16.9 25.4-14.4 1.3-25.3-9.5-39.3-18.7-21.8-14.3-34.2-23.2-55.3-37.2-24.5-16.1-8.6-25 5.3-39.5 3.7-3.8 67.1-61.5 68.3-66.7.2-.7.3-3.1-1.2-4.4s-3.6-.8-5.1-.5c-2.2.5-37.1 23.5-104.6 69.1-9.9 6.8-18.9 10.1-26.9 9.9-8.9-.2-25.9-5-38.6-9.1-15.5-5-27.9-7.7-26.8-16.3.6-4.5 6.7-9 18.4-13.7 72.3-31.5 120.5-52.3 144.6-62.3 68.9-28.6 83.2-33.6 92.5-33.8 2.1 0 6.6.5 9.6 2.9 2 1.7 3.2 4.1 3.5 6.7.5 3.2.6 6.5.4 9.8z"/></svg> </a> <a href=https://github.com/tasmota target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M202.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1M496 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2m-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3m-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "..", "features": ["navigation.instant", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "navigation.tracking", "content.action.edit", "content.code.copy"], "search": "../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script> <script src=../assets/javascripts/bundle.f55a23d4.min.js></script> <script src=https://unpkg.com/tablesort@5.3.0/dist/tablesort.min.js></script> <script src=../extra_javascript/tablesort.js></script> </body> </html>