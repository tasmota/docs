<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Documentation (Wiki) for Tasmota"><link href=https://tasmota.github.io/docs/animation_docs/Animation_Tutorial/ rel=canonical><link rel=icon href=../../_media/favicon.ico><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.7.3"><title>Animation DSL Tutorial - Tasmota</title><link rel=stylesheet href=../../assets/stylesheets/main.484c7ddc.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.ab4e12ef.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Barlow:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Barlow";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../assets/css/anchor-fix.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-8J08F8X90S"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-8J08F8X90S",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-8J08F8X90S",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script><script>"undefined"!=typeof __md_analytics&&__md_analytics()</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=blue data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#animation-dsl-tutorial class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title=Tasmota class="md-header__button md-logo" aria-label=Tasmota data-md-component=logo> <img src=../../_media/logo.svg alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Tasmota </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Animation DSL Tutorial </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=blue data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=blue data-md-color-accent=deep-purple aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/arendst/tasmota title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg> </div> <div class=md-source__repository> arendst/tasmota </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../../Features/ class=md-tabs__link> Features </a> </li> <li class=md-tabs__item> <a href=../../ESP32/ class=md-tabs__link> ESP32 </a> </li> <li class=md-tabs__item> <a href=../../Integrations/ class=md-tabs__link> Smart Home Integrations </a> </li> <li class=md-tabs__item> <a href=../../Supported-Peripherals/ class=md-tabs__link> Peripherals </a> </li> <li class=md-tabs__item> <a href=../../Configuration-Procedure-for-New-Devices/ class=md-tabs__link> Supported Devices </a> </li> <li class=md-tabs__item> <a href=../../FAQ/ class=md-tabs__link> Help </a> </li> <li class=md-tabs__item> <a href=http://tasmota.github.io/install class=md-tabs__link> Web Installer </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title=Tasmota class="md-nav__button md-logo" aria-label=Tasmota data-md-component=logo> <img src=../../_media/logo.svg alt=logo> </a> Tasmota </label> <div class=md-nav__source> <a href=https://github.com/arendst/tasmota title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg> </div> <div class=md-source__repository> arendst/tasmota </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_1> <label class=md-nav__link for=__nav_1 id=__nav_1_label tabindex=0> <span class=md-ellipsis> Home </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_1_label aria-expanded=false> <label class=md-nav__title for=__nav_1> <span class="md-nav__icon md-icon"></span> Home </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> <span class=md-ellipsis> News </span> </a> </li> <li class=md-nav__item> <a href=../../About/ class=md-nav__link> <span class=md-ellipsis> About </span> </a> </li> <li class=md-nav__item> <a href=../../Getting-Started/ class=md-nav__link> <span class=md-ellipsis> Getting Started </span> </a> </li> <li class=md-nav__item> <a href=../../Upgrading/ class=md-nav__link> <span class=md-ellipsis> Upgrading </span> </a> </li> <li class=md-nav__item> <a href=../../MQTT/ class=md-nav__link> <span class=md-ellipsis> MQTT </span> </a> </li> <li class=md-nav__item> <a href=../../Commands/ class=md-nav__link> <span class=md-ellipsis> Commands </span> </a> </li> <li class=md-nav__item> <a href=../../Templates/ class=md-nav__link> <span class=md-ellipsis> Templates </span> </a> </li> <li class=md-nav__item> <a href=../../Components/ class=md-nav__link> <span class=md-ellipsis> Components </span> </a> </li> <li class=md-nav__item> <a href=../../Modules/ class=md-nav__link> <span class=md-ellipsis> Modules </span> </a> </li> <li class=md-nav__item> <a href=../../Peripherals/ class=md-nav__link> <span class=md-ellipsis> Peripherals </span> </a> </li> <li class=md-nav__item> <a href=../../WebUI/ class=md-nav__link> <span class=md-ellipsis> WebUI </span> </a> </li> <li class=md-nav__item> <a href=../../Firmware-Builds/ class=md-nav__link> <span class=md-ellipsis> Firmware Builds </span> </a> </li> <li class=md-nav__item> <a href=../../Compile-your-build/ class=md-nav__link> <span class=md-ellipsis> Compiling </span> </a> </li> <li class=md-nav__item> <a href=../../Contributing/ class=md-nav__link> <span class=md-ellipsis> Contributing </span> </a> </li> <li class=md-nav__item> <a href=../../Download/ class=md-nav__link> <span class=md-ellipsis> Download </span> </a> </li> <li class=md-nav__item> <a href=https://github.com/arendst/Tasmota/discussions/categories/show-and-tell class=md-nav__link> <span class=md-ellipsis> Project Showcase </span> </a> </li> <li class=md-nav__item> <a href=../../For-Developers/ class=md-nav__link> <span class=md-ellipsis> For Developers </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex=0> <span class=md-ellipsis> Features </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Features </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Features/ class=md-nav__link> <span class=md-ellipsis> Introduction </span> </a> </li> <li class=md-nav__item> <a href=../../ADC/ class=md-nav__link> <span class=md-ellipsis> Analog Pin </span> </a> </li> <li class=md-nav__item> <a href=../../ArtNet/ class=md-nav__link> <span class=md-ellipsis> ArtNet DMX </span> </a> </li> <li class=md-nav__item> <a href=../../Buttons-and-Switches/ class=md-nav__link> <span class=md-ellipsis> Buttons and Switches </span> </a> </li> <li class=md-nav__item> <a href=../../DeepSleep/ class=md-nav__link> <span class=md-ellipsis> DeepSleep </span> </a> </li> <li class=md-nav__item> <a href=../../Device-Groups/ class=md-nav__link> <span class=md-ellipsis> Device Groups </span> </a> </li> <li class=md-nav__item> <a href=../../Universal-Display-Driver/ class=md-nav__link> <span class=md-ellipsis> Universal Display and Universal Touch drivers (uDisplay/uTouch) </span> </a> </li> <li class=md-nav__item> <a href=../../Displays/ class=md-nav__link> <span class=md-ellipsis> Displays </span> </a> </li> <li class=md-nav__item> <a href=../../Dynamic-Sleep/ class=md-nav__link> <span class=md-ellipsis> Dynamic Sleep </span> </a> </li> <li class=md-nav__item> <a href=../../I2CDEVICES/ class=md-nav__link> <span class=md-ellipsis> I2C Devices </span> </a> </li> <li class=md-nav__item> <a href=../../I2S-Audio/ class=md-nav__link> <span class=md-ellipsis> I2S Audio </span> </a> </li> <li class=md-nav__item> <a href=../../IPv6/ class=md-nav__link> <span class=md-ellipsis> IPv6 </span> </a> </li> <li class=md-nav__item> <a href=../../Lights/ class=md-nav__link> <span class=md-ellipsis> Lights </span> </a> </li> <li class=md-nav__item> <a href=../../Matter/ class=md-nav__link> <span class=md-ellipsis> Matter </span> </a> </li> <li class=md-nav__item> <a href=../../PIR-Motion-Sensors/ class=md-nav__link> <span class=md-ellipsis> PIR Motion Sensors </span> </a> </li> <li class=md-nav__item> <a href=../../Power-Monitoring-Calibration/ class=md-nav__link> <span class=md-ellipsis> Power Monitoring Calibration </span> </a> </li> <li class=md-nav__item> <a href=../../PWM-dimmer-switch/ class=md-nav__link> <span class=md-ellipsis> PWM Dimmer </span> </a> </li> <li class=md-nav__item> <a href=../../Rules/ class=md-nav__link> <span class=md-ellipsis> Rules </span> </a> </li> <li class=md-nav__item> <a href=../../Scripting-Language/ class=md-nav__link> <span class=md-ellipsis> Scripting Language </span> </a> </li> <li class=md-nav__item> <a href=../../Blinds-and-Shutters/ class=md-nav__link> <span class=md-ellipsis> Shutters and Blinds </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_21> <label class=md-nav__link for=__nav_2_21 id=__nav_2_21_label tabindex=0> <span class=md-ellipsis> Protocol Bridging </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_21_label aria-expanded=false> <label class=md-nav__title for=__nav_2_21> <span class="md-nav__icon md-icon"></span> Protocol Bridging </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../TasmotaClient/ class=md-nav__link> <span class=md-ellipsis> Arduino MCU </span> </a> </li> <li class=md-nav__item> <a href=../../Bluetooth/ class=md-nav__link> <span class=md-ellipsis> BLE Gateway </span> </a> </li> <li class=md-nav__item> <a href=../../DALI/ class=md-nav__link> <span class=md-ellipsis> DALI </span> </a> </li> <li class=md-nav__item> <a href=../../HDMI_CEC/ class=md-nav__link> <span class=md-ellipsis> HDMI CEC </span> </a> </li> <li class=md-nav__item> <a href=../../Tasmota-IR/ class=md-nav__link> <span class=md-ellipsis> IR Communication </span> </a> </li> <li class=md-nav__item> <a href=../../Projector/ class=md-nav__link> <span class=md-ellipsis> LCD/DLP Projector Control </span> </a> </li> <li class=md-nav__item> <a href=../../LoRa-and-LoRaWan-Bridge/ class=md-nav__link> <span class=md-ellipsis> LoRa and LoRaWan Bridge </span> </a> </li> <li class=md-nav__item> <a href=../../Modbus-Bridge/ class=md-nav__link> <span class=md-ellipsis> Modbus Bridge </span> </a> </li> <li class=md-nav__item> <a href=../../OpenTherm/ class=md-nav__link> <span class=md-ellipsis> OpenTherm </span> </a> </li> <li class=md-nav__item> <a href=../../RF-Protocol/ class=md-nav__link> <span class=md-ellipsis> RF Communication </span> </a> </li> <li class=md-nav__item> <a href=../../Serial-to-TCP-Bridge/ class=md-nav__link> <span class=md-ellipsis> Serial to TCP Bridge </span> </a> </li> <li class=md-nav__item> <a href=../../TWAI/ class=md-nav__link> <span class=md-ellipsis> TWAI </span> </a> </li> <li class=md-nav__item> <a href=../../Telegram/ class=md-nav__link> <span class=md-ellipsis> Telegram </span> </a> </li> <li class=md-nav__item> <a href=../../Zigbee/ class=md-nav__link> <span class=md-ellipsis> Zigbee </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../Smart-Meter-Interface/ class=md-nav__link> <span class=md-ellipsis> Smart Meter Interface </span> </a> </li> <li class=md-nav__item> <a href=../../Thermostat/ class=md-nav__link> <span class=md-ellipsis> Thermostat </span> </a> </li> <li class=md-nav__item> <a href=../../Timers/ class=md-nav__link> <span class=md-ellipsis> Timers </span> </a> </li> <li class=md-nav__item> <a href=../../TLS/ class=md-nav__link> <span class=md-ellipsis> TLS Secured MQTT </span> </a> </li> <li class=md-nav__item> <a href=../../TuyaMCU/ class=md-nav__link> <span class=md-ellipsis> TuyaMCU </span> </a> </li> <li class=md-nav__item> <a href=../../UFS/ class=md-nav__link> <span class=md-ellipsis> Universal File System </span> </a> </li> <li class=md-nav__item> <a href=../../Range-Extender/ class=md-nav__link> <span class=md-ellipsis> Wi-Fi Range Extender </span> </a> </li> <li class=md-nav__item> <a href=../../Wireguard/ class=md-nav__link> <span class=md-ellipsis> Wireguard VPN </span> </a> </li> <li class=md-nav__item> <a href=../../Tutorials/ class=md-nav__link> <span class=md-ellipsis> Projects and Tutorials </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex=0> <span class=md-ellipsis> ESP32 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> ESP32 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../ESP32/ class=md-nav__link> <span class=md-ellipsis> Tasmota32 Features </span> </a> </li> <li class=md-nav__item> <a href=../../Berry/ class=md-nav__link> <span class=md-ellipsis> Berry </span> </a> </li> <li class=md-nav__item> <a href=../../Bluetooth_ESP32/ class=md-nav__link> <span class=md-ellipsis> Bluetooth Low Energy </span> </a> </li> <li class=md-nav__item> <a href=../../LVGL/ class=md-nav__link> <span class=md-ellipsis> LVGL </span> </a> </li> <li class=md-nav__item> <a href=../../HASPmota/ class=md-nav__link> <span class=md-ellipsis> HASPmota </span> </a> </li> <li class=md-nav__item> <a href=../../Matter/ class=md-nav__link> <span class=md-ellipsis> Matter </span> </a> </li> <li class=md-nav__item> <a href=../../Tasmota-Extension/ class=md-nav__link> <span class=md-ellipsis> Tasmota Extension </span> </a> </li> <li class=md-nav__item> <a href=../../Tasmota-Application/ class=md-nav__link> <span class=md-ellipsis> Tasmota Application Files </span> </a> </li> <li class=md-nav__item> <a href=../../TFL/ class=md-nav__link> <span class=md-ellipsis> TensorFlow Lite </span> </a> </li> <li class=md-nav__item> <a href=../../TouchPin/ class=md-nav__link> <span class=md-ellipsis> Touch GPIOs </span> </a> </li> <li class=md-nav__item> <a href=../../Safeboot/ class=md-nav__link> <span class=md-ellipsis> Safeboot Partition Layout </span> </a> </li> <li class=md-nav__item> <a href=https://templates.blakadder.com/esp32 class=md-nav__link> <span class=md-ellipsis> Supported Devices </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex=0> <span class=md-ellipsis> Smart Home Integrations </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Smart Home Integrations </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Integrations/ class=md-nav__link> <span class=md-ellipsis> Introduction </span> </a> </li> <li class=md-nav__item> <a href=../../Alexa/ class=md-nav__link> <span class=md-ellipsis> Alexa </span> </a> </li> <li class=md-nav__item> <a href=../../AWS-IoT/ class=md-nav__link> <span class=md-ellipsis> AWS IoT </span> </a> </li> <li class=md-nav__item> <a href=../../Domoticz/ class=md-nav__link> <span class=md-ellipsis> Domoticz </span> </a> </li> <li class=md-nav__item> <a href=../../Home-Assistant/ class=md-nav__link> <span class=md-ellipsis> Home Assistant </span> </a> </li> <li class=md-nav__item> <a href=../../Homebridge/ class=md-nav__link> <span class=md-ellipsis> Homebridge </span> </a> </li> <li class=md-nav__item> <a href=https://homey.app/en-us/app/com.paveld.tasmota/Tasmota-MQTT/ class=md-nav__link> <span class=md-ellipsis> Homey </span> </a> </li> <li class=md-nav__item> <a href=../../HomeSeer/ class=md-nav__link> <span class=md-ellipsis> HomeSeer </span> </a> </li> <li class=md-nav__item> <a href=../../IP-Symcon/ class=md-nav__link> <span class=md-ellipsis> IP Symcon </span> </a> </li> <li class=md-nav__item> <a href=../../KNX/ class=md-nav__link> <span class=md-ellipsis> KNX </span> </a> </li> <li class=md-nav__item> <a href=../../NodeRed/ class=md-nav__link> <span class=md-ellipsis> NodeRed </span> </a> </li> <li class=md-nav__item> <a href=../../nymea/ class=md-nav__link> <span class=md-ellipsis> nymea </span> </a> </li> <li class=md-nav__item> <a href=../../Octoprint/ class=md-nav__link> <span class=md-ellipsis> OctoPrint </span> </a> </li> <li class=md-nav__item> <a href=../../openHAB/ class=md-nav__link> <span class=md-ellipsis> openHAB </span> </a> </li> <li class=md-nav__item> <a href=../../otto/ class=md-nav__link> <span class=md-ellipsis> Otto </span> </a> </li> <li class=md-nav__item> <a href=https://github.com/arendst/Tasmota/issues/3769 class=md-nav__link> <span class=md-ellipsis> IOBroker </span> </a> </li> <li class=md-nav__item> <a href=https://github.com/tim-hellhake/tasmota-adapter class=md-nav__link> <span class=md-ellipsis> Mozilla WebThings Adapter </span> </a> </li> <li class=md-nav__item> <a href=https://github.com/hongtat/tasmota-connect class=md-nav__link> <span class=md-ellipsis> SmartThings </span> </a> </li> <li class=md-nav__item> <a href=https://github.com/Gifford47/tasmohab/blob/master/README.md class=md-nav__link> <span class=md-ellipsis> Tasmohab </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../Supported-Peripherals/ class=md-nav__link> <span class=md-ellipsis> Peripherals </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6 id=__nav_6_label tabindex=0> <span class=md-ellipsis> Supported Devices </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=false> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Supported Devices </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Configuration-Procedure-for-New-Devices/ class=md-nav__link> <span class=md-ellipsis> Configure Unknown Device </span> </a> </li> <li class=md-nav__item> <a href="https://templates.blakadder.com/ " target='_blank""' class=md-nav__link> <span class=md-ellipsis> All Supported Devices </span> </a> </li> <li class=md-nav__item> <a href=../../Pinouts/ class=md-nav__link> <span class=md-ellipsis> Wi-Fi Module Pinouts </span> </a> </li> <li class=md-nav__item> <a href=../../Supported-Modules/ class=md-nav__link> <span class=md-ellipsis> Supported Modules </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7> <label class=md-nav__link for=__nav_7 id=__nav_7_label tabindex=0> <span class=md-ellipsis> Help </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_7_label aria-expanded=false> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> Help </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../FAQ/ class=md-nav__link> <span class=md-ellipsis> FAQ </span> </a> </li> <li class=md-nav__item> <a href=../../Troubleshooting/ class=md-nav__link> <span class=md-ellipsis> Troubleshooting </span> </a> </li> <li class=md-nav__item> <a href=../../Device-Recovery/ class=md-nav__link> <span class=md-ellipsis> Device Recovery </span> </a> </li> <li class=md-nav__item> <a href="https://discord.gg/Ks2Kzd4 " target='_blank""' class=md-nav__link> <span class=md-ellipsis> Discord Support </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=http://tasmota.github.io/install class=md-nav__link> <span class=md-ellipsis> Web Installer </span> </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#table-of-contents class=md-nav__link> <span class=md-ellipsis> Table of Contents </span> </a> </li> <li class=md-nav__item> <a href=#overview class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> <nav class=md-nav aria-label=Overview> <ul class=md-nav__list> <li class=md-nav__item> <a href=#why-use-the-dsl class=md-nav__link> <span class=md-ellipsis> Why Use the DSL? </span> </a> </li> <li class=md-nav__item> <a href=#key-concepts class=md-nav__link> <span class=md-ellipsis> Key Concepts </span> </a> </li> <li class=md-nav__item> <a href=#how-it-works class=md-nav__link> <span class=md-ellipsis> How It Works </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#chapter-1-getting-started class=md-nav__link> <span class=md-ellipsis> Chapter 1: Getting Started </span> </a> <nav class=md-nav aria-label="Chapter 1: Getting Started"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#11-your-first-animation-solid-color class=md-nav__link> <span class=md-ellipsis> 1.1 Your First Animation: Solid Color </span> </a> </li> <li class=md-nav__item> <a href=#12-custom-colors class=md-nav__link> <span class=md-ellipsis> 1.2 Custom Colors </span> </a> </li> <li class=md-nav__item> <a href=#13-using-predefined-animations class=md-nav__link> <span class=md-ellipsis> 1.3 Using Predefined Animations </span> </a> </li> <li class=md-nav__item> <a href=#14-animation-parameters class=md-nav__link> <span class=md-ellipsis> 1.4 Animation Parameters </span> </a> </li> <li class=md-nav__item> <a href=#15-layering-animations class=md-nav__link> <span class=md-ellipsis> 1.5 Layering Animations </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#chapter-2-color-cycling-with-palettes class=md-nav__link> <span class=md-ellipsis> Chapter 2: Color Cycling with Palettes </span> </a> <nav class=md-nav aria-label="Chapter 2: Color Cycling with Palettes"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#21-built-in-palette-cycling class=md-nav__link> <span class=md-ellipsis> 2.1 Built-in Palette Cycling </span> </a> </li> <li class=md-nav__item> <a href=#22-custom-palettes class=md-nav__link> <span class=md-ellipsis> 2.2 Custom Palettes </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#chapter-3-smooth-color-transitions class=md-nav__link> <span class=md-ellipsis> Chapter 3: Smooth Color Transitions </span> </a> <nav class=md-nav aria-label="Chapter 3: Smooth Color Transitions"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#31-rich-palette-animation class=md-nav__link> <span class=md-ellipsis> 3.1 Rich Palette Animation </span> </a> </li> <li class=md-nav__item> <a href=#32-rich-palette-with-custom-colors class=md-nav__link> <span class=md-ellipsis> 3.2 Rich Palette with Custom Colors </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#chapter-4-spatial-patterns-and-gradients class=md-nav__link> <span class=md-ellipsis> Chapter 4: Spatial Patterns and Gradients </span> </a> <nav class=md-nav aria-label="Chapter 4: Spatial Patterns and Gradients"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#41-rainbow-gradient class=md-nav__link> <span class=md-ellipsis> 4.1 Rainbow Gradient </span> </a> </li> <li class=md-nav__item> <a href=#42-multiple-gradient-repetitions class=md-nav__link> <span class=md-ellipsis> 4.2 Multiple Gradient Repetitions </span> </a> </li> <li class=md-nav__item> <a href=#43-oscillating-spatial-period class=md-nav__link> <span class=md-ellipsis> 4.3 Oscillating Spatial Period </span> </a> </li> <li class=md-nav__item> <a href=#44-rotating-gradient class=md-nav__link> <span class=md-ellipsis> 4.4 Rotating Gradient </span> </a> </li> <li class=md-nav__item> <a href=#45-vu-meter-style-animation class=md-nav__link> <span class=md-ellipsis> 4.5 VU-Meter Style Animation </span> </a> </li> <li class=md-nav__item> <a href=#46-custom-value-functions class=md-nav__link> <span class=md-ellipsis> 4.6 Custom Value Functions </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#chapter-5-beacons-and-moving-effects class=md-nav__link> <span class=md-ellipsis> Chapter 5: Beacons and Moving Effects </span> </a> <nav class=md-nav aria-label="Chapter 5: Beacons and Moving Effects"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#51-static-beacon class=md-nav__link> <span class=md-ellipsis> 5.1 Static Beacon </span> </a> </li> <li class=md-nav__item> <a href=#52-beacon-with-slew-soft-edges class=md-nav__link> <span class=md-ellipsis> 5.2 Beacon with Slew (Soft Edges) </span> </a> </li> <li class=md-nav__item> <a href=#53-animated-slew class=md-nav__link> <span class=md-ellipsis> 5.3 Animated Slew </span> </a> </li> <li class=md-nav__item> <a href=#54-cylon-eye-moving-beacon class=md-nav__link> <span class=md-ellipsis> 5.4 Cylon Eye (Moving Beacon) </span> </a> </li> <li class=md-nav__item> <a href=#55-rainbow-cylon-with-stars class=md-nav__link> <span class=md-ellipsis> 5.5 Rainbow Cylon with Stars </span> </a> </li> <li class=md-nav__item> <a href=#56-beacon-as-opacity-mask class=md-nav__link> <span class=md-ellipsis> 5.6 Beacon as Opacity Mask </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#chapter-6-shutters-and-sequences class=md-nav__link> <span class=md-ellipsis> Chapter 6: Shutters and Sequences </span> </a> <nav class=md-nav aria-label="Chapter 6: Shutters and Sequences"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#61-simple-shutter class=md-nav__link> <span class=md-ellipsis> 6.1 Simple Shutter </span> </a> </li> <li class=md-nav__item> <a href=#62-shutter-with-rotating-colors class=md-nav__link> <span class=md-ellipsis> 6.2 Shutter with Rotating Colors </span> </a> </li> <li class=md-nav__item> <a href=#63-central-shutter class=md-nav__link> <span class=md-ellipsis> 6.3 Central Shutter </span> </a> </li> <li class=md-nav__item> <a href=#64-bidirectional-shutter class=md-nav__link> <span class=md-ellipsis> 6.4 Bidirectional Shutter </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#chapter-7-crenel-patterns class=md-nav__link> <span class=md-ellipsis> Chapter 7: Crenel Patterns </span> </a> <nav class=md-nav aria-label="Chapter 7: Crenel Patterns"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#71-static-crenel class=md-nav__link> <span class=md-ellipsis> 7.1 Static Crenel </span> </a> </li> <li class=md-nav__item> <a href=#72-variable-number-of-pulses class=md-nav__link> <span class=md-ellipsis> 7.2 Variable Number of Pulses </span> </a> </li> <li class=md-nav__item> <a href=#73-variable-pulse-size class=md-nav__link> <span class=md-ellipsis> 7.3 Variable Pulse Size </span> </a> </li> <li class=md-nav__item> <a href=#74-dynamic-colors class=md-nav__link> <span class=md-ellipsis> 7.4 Dynamic Colors </span> </a> </li> <li class=md-nav__item> <a href=#75-crenel-as-opacity-mask class=md-nav__link> <span class=md-ellipsis> 7.5 Crenel as Opacity Mask </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#chapter-8-templates-for-reusable-animations class=md-nav__link> <span class=md-ellipsis> Chapter 8: Templates for Reusable Animations </span> </a> <nav class=md-nav aria-label="Chapter 8: Templates for Reusable Animations"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#81-simple-template-cylon-eye class=md-nav__link> <span class=md-ellipsis> 8.1 Simple Template: Cylon Eye </span> </a> </li> <li class=md-nav__item> <a href=#82-template-with-palette-parameter class=md-nav__link> <span class=md-ellipsis> 8.2 Template with Palette Parameter </span> </a> </li> <li class=md-nav__item> <a href=#83-advanced-template-with-conditional-flags class=md-nav__link> <span class=md-ellipsis> 8.3 Advanced Template with Conditional Flags </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#quick-reference-card class=md-nav__link> <span class=md-ellipsis> Quick Reference Card </span> </a> <nav class=md-nav aria-label="Quick Reference Card"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#animation-types class=md-nav__link> <span class=md-ellipsis> Animation Types </span> </a> </li> <li class=md-nav__item> <a href=#colors class=md-nav__link> <span class=md-ellipsis> Colors </span> </a> </li> <li class=md-nav__item> <a href=#palettes class=md-nav__link> <span class=md-ellipsis> Palettes </span> </a> </li> <li class=md-nav__item> <a href=#value-providers class=md-nav__link> <span class=md-ellipsis> Value Providers </span> </a> </li> <li class=md-nav__item> <a href=#time-units class=md-nav__link> <span class=md-ellipsis> Time Units </span> </a> </li> <li class=md-nav__item> <a href=#percentages class=md-nav__link> <span class=md-ellipsis> Percentages </span> </a> </li> <li class=md-nav__item> <a href=#sequence-statements class=md-nav__link> <span class=md-ellipsis> Sequence Statements </span> </a> </li> <li class=md-nav__item> <a href=#template-definition class=md-nav__link> <span class=md-ellipsis> Template Definition </span> </a> </li> <li class=md-nav__item> <a href=#resources class=md-nav__link> <span class=md-ellipsis> Resources </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/tasmota/docs/blob/master/docs/animation_docs/Animation_Tutorial.md title="Edit this page" class="md-content__button md-icon" rel=edit> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg> </a> <h1 id=animation-dsl-tutorial>Animation DSL Tutorial<a class=headerlink href=#animation-dsl-tutorial title="Permanent link">~</a></h1> <div class="admonition tip"> <p class=admonition-title>Try it online!</p> <p>You can test all examples in this tutorial directly in your browser using the <strong><a href=https://tasmota.github.io/docs/Tasmota-Berry-emulator/index.html>Online Emulator</a></strong>. No hardware required! All tutorial examples are available in the <strong>Examples</strong> dropdown menu.</p> </div> <p>This tutorial will guide you through the Berry Animation DSL, from your first solid color to complex animated sequences with templates. Each chapter builds on the previous one, introducing new concepts progressively.</p> <h2 id=table-of-contents>Table of Contents<a class=headerlink href=#table-of-contents title="Permanent link">~</a></h2> <ul> <li><a href=#overview>Overview</a></li> <li><a href=#chapter-1-getting-started>Chapter 1: Getting Started</a></li> <li><a href=#chapter-2-color-cycling-with-palettes>Chapter 2: Color Cycling with Palettes</a></li> <li><a href=#chapter-3-smooth-color-transitions>Chapter 3: Smooth Color Transitions</a></li> <li><a href=#chapter-4-spatial-patterns-and-gradients>Chapter 4: Spatial Patterns and Gradients</a></li> <li><a href=#chapter-5-beacons-and-moving-effects>Chapter 5: Beacons and Moving Effects</a></li> <li><a href=#chapter-6-shutters-and-sequences>Chapter 6: Shutters and Sequences</a></li> <li><a href=#chapter-7-crenel-patterns>Chapter 7: Crenel Patterns</a></li> <li><a href=#chapter-8-templates-for-reusable-animations>Chapter 8: Templates for Reusable Animations</a></li> <li><a href=#quick-reference-card>Quick Reference Card</a></li> </ul> <hr> <h2 id=overview>Overview<a class=headerlink href=#overview title="Permanent link">~</a></h2> <p>The Animation DSL (Domain-Specific Language) lets you create LED strip animations using simple, declarative syntax. Instead of writing complex Berry code with timing loops and state machines, you describe <em>what</em> you want and <em>how long</em> it should take.</p> <h3 id=why-use-the-dsl>Why Use the DSL?<a class=headerlink href=#why-use-the-dsl title="Permanent link">~</a></h3> <p>Traditional LED programming requires managing frame buffers, timing loops, and complex state machines. The Animation DSL abstracts all of this away:</p> <ul> <li><strong>No timing code</strong> - Just specify durations like <code>period=2s</code> and the framework handles the rest</li> <li><strong>No state machines</strong> - Animations automatically manage their internal state</li> <li><strong>Composable</strong> - Layer multiple animations, use one as an opacity mask for another</li> <li><strong>Readable</strong> - Code reads almost like English: "animation pulse = breathe(color=red, period=2s)"</li> </ul> <h3 id=key-concepts>Key Concepts<a class=headerlink href=#key-concepts title="Permanent link">~</a></h3> <p>Before diving into code, let's understand the building blocks:</p> <table> <thead> <tr> <th>Concept</th> <th>What It Does</th> <th>Example</th> </tr> </thead> <tbody> <tr> <td><strong>Animation</strong></td> <td>A visual effect on the LED strip</td> <td><code>solid</code>, <code>twinkle</code>, <code>beacon</code></td> </tr> <tr> <td><strong>Color</strong></td> <td>Either a static value or a dynamic provider that changes over time</td> <td><code>red</code>, <code>0xFF0000</code>, <code>color_cycle(...)</code></td> </tr> <tr> <td><strong>Palette</strong></td> <td>A collection of colors for gradients or cycling</td> <td><code>PALETTE_RAINBOW</code>, custom arrays</td> </tr> <tr> <td><strong>Value Provider</strong></td> <td>A number that changes over time (oscillates)</td> <td><code>sine_osc</code>, <code>triangle</code>, <code>sawtooth</code></td> </tr> <tr> <td><strong>Sequence</strong></td> <td>Orchestrates animations with timing control</td> <td><code>play</code>, <code>wait</code>, <code>repeat</code></td> </tr> <tr> <td><strong>Template</strong></td> <td>A reusable animation pattern with parameters</td> <td><code>template animation cylon_eye { ... }</code></td> </tr> </tbody> </table> <h3 id=how-it-works>How It Works<a class=headerlink href=#how-it-works title="Permanent link">~</a></h3> <ol> <li>You write DSL code in a <code>.anim</code> file</li> <li>The transpiler converts it to Berry code</li> <li>Berry code runs on your ESP32 (or in the browser emulator)</li> <li>The animation engine renders frames to your LED strip</li> </ol> <hr> <h2 id=chapter-1-getting-started>Chapter 1: Getting Started<a class=headerlink href=#chapter-1-getting-started title="Permanent link">~</a></h2> <p>This chapter covers the basics: creating simple animations, using colors, and layering effects. By the end, you'll understand how to combine multiple animations into a scene.</p> <h3 id=11-your-first-animation-solid-color>1.1 Your First Animation: Solid Color<a class=headerlink href=#11-your-first-animation-solid-color title="Permanent link">~</a></h3> <p><a href="https://tasmota.github.io/docs/Tasmota-Berry-emulator/index.html?example=chap_1_10_plain" target=_blank><img src=../../_media/berry_animation/chap_1_10.png alt="Solid Red"></a></p> <p>Every animation starts with two steps: <strong>define</strong> it, then <strong>run</strong> it. The simplest animation fills the entire strip with a single color.</p> <div class=highlight><pre><span></span><code><span class=c1># Solid red background - the simplest animation</span>

<span class=n>animation</span><span class=w> </span><span class=n>back</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>solid</span><span class=p>(</span><span class=n>color</span><span class=o>=</span><span class=n>red</span><span class=p>)</span>
<span class=n>run</span><span class=w> </span><span class=n>back</span>
</code></pre></div> <p>Let's break this down:</p> <ul> <li><code>animation back</code> - Creates a new animation and names it "back"</li> <li><code>solid(color=red)</code> - Uses the <code>solid</code> animation type, which fills all LEDs with one color</li> <li><code>run back</code> - Starts the animation running</li> </ul> <p>The DSL provides many predefined colors: <code>red</code>, <code>green</code>, <code>blue</code>, <code>white</code>, <code>yellow</code>, <code>orange</code>, <code>purple</code>, <code>cyan</code>, and more.</p> <h3 id=12-custom-colors>1.2 Custom Colors<a class=headerlink href=#12-custom-colors title="Permanent link">~</a></h3> <p><a href="https://tasmota.github.io/docs/Tasmota-Berry-emulator/index.html?example=chap_1_20_plain_custom_color" target=_blank><img src=../../_media/berry_animation/chap_1_20.png alt="Custom Color"></a></p> <p>Predefined colors are convenient, but you'll often want specific shades. Define custom colors using hexadecimal values.</p> <div class=highlight><pre><span></span><code><span class=c1># Solid dark blue - using a custom color</span>

<span class=n>color</span><span class=w> </span><span class=n>space_blue</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mh>0x000066</span><span class=w>    </span><span class=c1># Note: opaque 0xFF alpha channel is implicitly added</span>
<span class=n>animation</span><span class=w> </span><span class=n>back</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>solid</span><span class=p>(</span><span class=n>color</span><span class=o>=</span><span class=n>space_blue</span><span class=p>)</span>
<span class=n>run</span><span class=w> </span><span class=n>back</span>
</code></pre></div> <p><strong>Color format:</strong> Colors include an alpha channel (transparency) in addition to RGB:</p> <ul> <li><strong>6-digit format</strong> <code>0xRRGGBB</code> - The alpha is automatically set to <code>FF</code> (fully opaque)</li> <li><strong>8-digit format</strong> <code>0xAARRGGBB</code> - You specify the alpha explicitly</li> </ul> <p>The alpha channel ranges from <code>00</code> (fully transparent) to <code>FF</code> (fully opaque). Examples:</p> <ul> <li><code>0xFF0000</code> = pure red (actually stored as <code>0xFFFF0000</code>)</li> <li><code>0x00FF00</code> = pure green (actually stored as <code>0xFF00FF00</code>)</li> <li><code>0x000066</code> = dark blue, fully opaque</li> <li><code>0x80FF0000</code> = semi-transparent red (50% opacity)</li> </ul> <p>The DSL also provides <code>transparent</code> as a predefined color, equivalent to <code>0x00000000</code> (fully transparent black). This is useful for backgrounds or opacity masks where you want parts to be invisible.</p> <h3 id=13-using-predefined-animations>1.3 Using Predefined Animations<a class=headerlink href=#13-using-predefined-animations title="Permanent link">~</a></h3> <p><a href="https://tasmota.github.io/docs/Tasmota-Berry-emulator/index.html?example=chap_1_30_twinkle" target=_blank><img src=../../_media/berry_animation/chap_1_30.png alt="Twinkle Stars"></a></p> <p>Beyond <code>solid</code>, the DSL includes many ready-to-use animation types. Each creates a different visual effect. Let's try <code>twinkle</code>, which creates a twinkling stars effect.</p> <div class=highlight><pre><span></span><code><span class=c1># Twinkle stars - using predefined animations</span>

<span class=n>animation</span><span class=w> </span><span class=n>stars</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>twinkle</span><span class=p>()</span>
<span class=n>run</span><span class=w> </span><span class=n>stars</span>
</code></pre></div> <p>With no parameters, animations use sensible defaults. The twinkle effect will use white sparkles at a moderate density. But you can customize everything!</p> <h3 id=14-animation-parameters>1.4 Animation Parameters<a class=headerlink href=#14-animation-parameters title="Permanent link">~</a></h3> <p><a href="https://tasmota.github.io/docs/Tasmota-Berry-emulator/index.html?example=chap_1_40_twinke_params" target=_blank><img src=../../_media/berry_animation/chap_1_40.png alt="Twinkle Parameters"></a></p> <p>Most animations accept <strong>parameters</strong> to customize their behavior. Parameters use the <code>name=value</code> syntax inside the parentheses.</p> <div class=highlight><pre><span></span><code><span class=c1># Twinkle stars with parameters - using animation parameters</span>

<span class=c1># Note: when parameters are in separate lines, you don&#39;t need a comma &#39;,&#39;</span>
<span class=n>animation</span><span class=w> </span><span class=n>stars</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>twinkle</span><span class=p>(</span>
<span class=w>  </span><span class=n>color</span><span class=o>=</span><span class=mh>0xFFFFAA</span><span class=w>        </span><span class=c1># Light yellow sparkles</span>
<span class=w>  </span><span class=n>density</span><span class=o>=</span><span class=mi>8</span><span class=w>             </span><span class=c1># density (moderate sparkles)</span>
<span class=w>  </span><span class=n>twinkle_speed</span><span class=o>=</span><span class=mi>100</span><span class=err>ms</span><span class=w>   </span><span class=c1># twinkle speed</span>
<span class=w>  </span><span class=n>fade_speed</span><span class=o>=</span><span class=mi>50</span><span class=w>         </span><span class=c1># when no unit, time unit is &#39;ms&#39;  </span>
<span class=p>)</span>
<span class=n>run</span><span class=w> </span><span class=n>stars</span>
</code></pre></div> <div class="admonition tip"> <p class=admonition-title>Parameter Syntax</p> <p>When parameters are on separate lines, commas are optional. This makes the code more readable for complex animations.</p> </div> <p><strong>Time values</strong> can use units (internally converted to milliseconds):</p> <ul> <li><code>500ms</code> - milliseconds (stays as 500)</li> <li><code>2s</code> - seconds (converted to 2000)</li> <li><code>1m</code> - minutes (converted to 60000)</li> </ul> <h3 id=15-layering-animations>1.5 Layering Animations<a class=headerlink href=#15-layering-animations title="Permanent link">~</a></h3> <p><a href="https://tasmota.github.io/docs/Tasmota-Berry-emulator/index.html?example=chap_1_50_twinke_night" target=_blank><img src=../../_media/berry_animation/chap_1_50.png alt="Twinkle Night"></a></p> <p>One of the most powerful features is <strong>layering</strong> - running multiple animations simultaneously. Each animation has a <code>priority</code> that determines its rendering order. Think of it like layers in an image editor: lower numbers are "on top" and can obscure higher numbers.</p> <div class=highlight><pre><span></span><code><span class=c1># Twinkle night - twinkle stars over a dark night</span>

<span class=c1># Dark blue background</span>
<span class=n>color</span><span class=w> </span><span class=n>space_blue</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mh>0x000066</span>
<span class=n>animation</span><span class=w> </span><span class=n>background</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>solid</span><span class=p>(</span><span class=n>color</span><span class=o>=</span><span class=n>space_blue</span><span class=p>)</span>
<span class=n>run</span><span class=w> </span><span class=n>background</span>

<span class=c1># Twinkle stars on top</span>
<span class=n>animation</span><span class=w> </span><span class=n>stars</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>twinkle</span><span class=p>(</span>
<span class=w>  </span><span class=n>color</span><span class=o>=</span><span class=mh>0xFFFFAA</span><span class=w>        </span><span class=c1># Light yellow sparkles</span>
<span class=w>  </span><span class=n>density</span><span class=o>=</span><span class=mi>8</span><span class=w>             </span><span class=c1># density (moderate sparkles)</span>
<span class=w>  </span><span class=n>twinkle_speed</span><span class=o>=</span><span class=mi>100</span><span class=err>ms</span><span class=w>   </span><span class=c1># twinkle speed</span>
<span class=w>  </span><span class=n>fade_speed</span><span class=o>=</span><span class=mi>50</span><span class=w>         </span><span class=c1># when no unit, time unit is &#39;ms&#39;</span>
<span class=w>  </span><span class=n>priority</span><span class=o>=</span><span class=mi>8</span><span class=w>            </span><span class=c1># default priority is 10, so being lower puts it on top</span>
<span class=p>)</span>
<span class=n>run</span><span class=w> </span><span class=n>stars</span>
</code></pre></div> <p>Here's what happens:</p> <ol> <li>The <code>background</code> animation runs with default priority 10</li> <li>The <code>stars</code> animation runs with priority 8</li> <li>Since 8 &lt; 10, stars render "on top" of the background</li> <li>Where there's no star, the blue background shows through</li> </ol> <p>This layering technique is fundamental - you'll use it throughout this tutorial to create complex scenes.</p> <hr> <h2 id=chapter-2-color-cycling-with-palettes>Chapter 2: Color Cycling with Palettes<a class=headerlink href=#chapter-2-color-cycling-with-palettes title="Permanent link">~</a></h2> <p>So far, our colors have been static. This chapter introduces <strong>dynamic colors</strong> that change over time, creating smooth color transitions without any manual timing code.</p> <p>The key concept is the <strong>color provider</strong> - instead of a fixed color value, you use a function that produces different colors as time passes.</p> <h3 id=21-built-in-palette-cycling>2.1 Built-in Palette Cycling<a class=headerlink href=#21-built-in-palette-cycling title="Permanent link">~</a></h3> <p><a href="https://tasmota.github.io/docs/Tasmota-Berry-emulator/index.html?example=chap_2_10_palette_rotation" target=_blank><img src=../../_media/berry_animation/chap_2_10.png alt="Palette Rotation"></a></p> <p>The simplest way to create changing colors is with <code>color_cycle</code>, which steps through a palette of colors over time.</p> <div class=highlight><pre><span></span><code><span class=c1># Rainbow colors cycling through the entire strip over time</span>

<span class=c1># Define a color that cycles over time, cycle is 5 seconds</span>
<span class=c1># PALETTE_RAINBOW_W defines 7 rainbow colors + white</span>
<span class=n>color</span><span class=w> </span><span class=n>rainbow_color</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>color_cycle</span><span class=p>(</span><span class=n>colors</span><span class=o>=</span><span class=n>PALETTE_RAINBOW_W</span><span class=p>,</span><span class=w> </span><span class=n>period</span><span class=o>=</span><span class=mi>5</span><span class=err>s</span><span class=p>)</span>
<span class=n>animation</span><span class=w> </span><span class=n>back</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>solid</span><span class=p>(</span><span class=n>color</span><span class=o>=</span><span class=n>rainbow_color</span><span class=p>)</span>
<span class=n>run</span><span class=w> </span><span class=n>back</span>
</code></pre></div> <p>Notice the difference from Chapter 1:</p> <ul> <li>Before: <code>color=red</code> (static color)</li> <li>Now: <code>color=rainbow_color</code> (dynamic color provider)</li> </ul> <p>The <code>color_cycle</code> function creates a color provider that cycles through the palette. The <code>period=5s</code> means one complete cycle takes 5 seconds.</p> <p><strong>Built-in palettes:</strong></p> <ul> <li><code>PALETTE_RAINBOW</code> - 7 rainbow colors</li> <li><code>PALETTE_RAINBOW_W</code> - 7 rainbow colors + white</li> <li><code>PALETTE_RAINBOW2</code> - Rainbow with first color repeated at end for smooth roll-over</li> <li><code>PALETTE_RAINBOW_W2</code> - Rainbow + white with first color repeated at end for smooth roll-over</li> <li><code>PALETTE_FIRE</code> - Fire colors (red, orange, yellow)</li> </ul> <h3 id=22-custom-palettes>2.2 Custom Palettes<a class=headerlink href=#22-custom-palettes title="Permanent link">~</a></h3> <p><a href="https://tasmota.github.io/docs/Tasmota-Berry-emulator/index.html?example=chap_2_20_palette_rotation" target=_blank><img src=../../_media/berry_animation/chap_2_20.png alt="Custom Palette"></a></p> <p>Built-in palettes are convenient, but you'll often want your own color schemes. Define custom palettes as arrays of hex colors.</p> <div class=highlight><pre><span></span><code><span class=c1># Rainbow colors cycling with custom palette</span>

<span class=c1># Define a palette of rainbow colors including white</span>
<span class=n>palette</span><span class=w> </span><span class=n>rainbow_with_white</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>[</span>
<span class=w>  </span><span class=mh>0xFC0000</span><span class=w>        </span><span class=c1># Red</span>
<span class=w>  </span><span class=mh>0xFF8000</span><span class=w>        </span><span class=c1># Orange</span>
<span class=w>  </span><span class=mh>0xFFFF00</span><span class=w>        </span><span class=c1># Yellow</span>
<span class=w>  </span><span class=mh>0x00FF00</span><span class=w>        </span><span class=c1># Green</span>
<span class=w>  </span><span class=mh>0x00FFFF</span><span class=w>        </span><span class=c1># Cyan</span>
<span class=w>  </span><span class=mh>0x0080FF</span><span class=w>        </span><span class=c1># Blue</span>
<span class=w>  </span><span class=mh>0x8000FF</span><span class=w>        </span><span class=c1># Violet</span>
<span class=w>  </span><span class=mh>0xCCCCCC</span><span class=w>        </span><span class=c1># White</span>
<span class=p>]</span>

<span class=c1># Define a color that cycles over time</span>
<span class=n>color</span><span class=w> </span><span class=n>rainbow_color</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>color_cycle</span><span class=p>(</span><span class=n>colors</span><span class=o>=</span><span class=n>rainbow_with_white</span><span class=p>,</span><span class=w> </span><span class=n>period</span><span class=o>=</span><span class=mi>5</span><span class=err>s</span><span class=p>)</span>

<span class=c1># Use it in a solid animation</span>
<span class=n>animation</span><span class=w> </span><span class=n>back</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>solid</span><span class=p>(</span><span class=n>color</span><span class=o>=</span><span class=n>rainbow_color</span><span class=p>)</span>
<span class=n>run</span><span class=w> </span><span class=n>back</span>
</code></pre></div> <p>The <code>palette</code> keyword creates a named color collection. Colors are listed in order - the cycle will go Red  Orange  Yellow  ...  White  Red.</p> <hr> <h2 id=chapter-3-smooth-color-transitions>Chapter 3: Smooth Color Transitions<a class=headerlink href=#chapter-3-smooth-color-transitions title="Permanent link">~</a></h2> <p>Chapter 2 showed <code>color_cycle</code>, which steps discretely between colors. This chapter introduces <code>rich_palette_color</code>, which creates <strong>smooth, interpolated transitions</strong> - the color gradually morphs from one to the next.</p> <h3 id=31-rich-palette-animation>3.1 Rich Palette Animation<a class=headerlink href=#31-rich-palette-animation title="Permanent link">~</a></h3> <p><a href="https://tasmota.github.io/docs/Tasmota-Berry-emulator/index.html?example=chap_3_10_color_transition" target=_blank><img src=../../_media/berry_animation/chap_3_10.png alt="Rich Palette"></a></p> <p>The <code>rich_palette</code> is a complete animation that handles both the color transitions and rendering. It's the easiest way to get smooth rainbow effects.</p> <div class=highlight><pre><span></span><code><span class=c1># Smooth cycling through rainbow colors</span>

<span class=n>animation</span><span class=w> </span><span class=n>back</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>rich_palette</span><span class=p>()</span>
<span class=c1># Equivalent to:</span>
<span class=c1># animation back = rich_palette(colors=PALETTE_RAINBOW, period=5s,</span>
<span class=c1>#                                         transition_type=SINE, brightness=100%)</span>
<span class=n>run</span><span class=w> </span><span class=n>back</span>
</code></pre></div> <p>With no parameters, it uses sensible defaults. The <code>transition_type=SINE</code> creates smooth, natural-looking transitions that ease in and out.</p> <h3 id=32-rich-palette-with-custom-colors>3.2 Rich Palette with Custom Colors<a class=headerlink href=#32-rich-palette-with-custom-colors title="Permanent link">~</a></h3> <p><a href="https://tasmota.github.io/docs/Tasmota-Berry-emulator/index.html?example=chap_3_20_color_transition_palette" target=_blank><img src=../../_media/berry_animation/chap_3_20.png alt="Rich Palette Custom"></a></p> <p>For more control, use <code>rich_palette_color</code> as a <strong>color provider</strong> (not an animation). This lets you use smooth color transitions with any animation type.</p> <div class=highlight><pre><span></span><code><span class=c1># Smooth cycling through rainbow colors with custom palette</span>

<span class=n>palette</span><span class=w> </span><span class=n>rainbow_with_white</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>[</span>
<span class=w>  </span><span class=mh>0xFC0000</span><span class=w>        </span><span class=c1># Red</span>
<span class=w>  </span><span class=mh>0xFF8000</span><span class=w>        </span><span class=c1># Orange</span>
<span class=w>  </span><span class=mh>0xFFFF00</span><span class=w>        </span><span class=c1># Yellow</span>
<span class=w>  </span><span class=mh>0x00FF00</span><span class=w>        </span><span class=c1># Green</span>
<span class=w>  </span><span class=mh>0x00FFFF</span><span class=w>        </span><span class=c1># Cyan</span>
<span class=w>  </span><span class=mh>0x0080FF</span><span class=w>        </span><span class=c1># Blue</span>
<span class=w>  </span><span class=mh>0x8000FF</span><span class=w>        </span><span class=c1># Violet</span>
<span class=w>  </span><span class=mh>0xCCCCCC</span><span class=w>        </span><span class=c1># White</span>
<span class=w>  </span><span class=mh>0xFC0000</span><span class=w>        </span><span class=c1># Red - add first color at end for smooth roll-over</span>
<span class=p>]</span>

<span class=c1># Define a color that cycles over time with smooth transitions</span>
<span class=n>color</span><span class=w> </span><span class=n>rainbow_color_rollover</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>rich_palette_color</span><span class=p>(</span><span class=n>period</span><span class=o>=</span><span class=mi>10</span><span class=err>s</span><span class=p>)</span>

<span class=c1># Use the dynamic color in a solid animation</span>
<span class=n>animation</span><span class=w> </span><span class=n>back</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>solid</span><span class=p>(</span><span class=n>color</span><span class=o>=</span><span class=n>rainbow_color_rollover</span><span class=p>)</span>
<span class=n>run</span><span class=w> </span><span class=n>back</span>
</code></pre></div> <div class="admonition tip"> <p class=admonition-title>Smooth Roll-over</p> <p>Add the first color at the end of your palette to ensure smooth transitions when the cycle repeats.</p> </div> <hr> <h2 id=chapter-4-spatial-patterns-and-gradients>Chapter 4: Spatial Patterns and Gradients<a class=headerlink href=#chapter-4-spatial-patterns-and-gradients title="Permanent link">~</a></h2> <p>Until now, all LEDs displayed the same color at any given moment. This chapter introduces <strong>spatial variation</strong> - different LEDs showing different colors simultaneously, creating gradients and patterns across the strip.</p> <p>The key insight is that color providers can work in two dimensions:</p> <ul> <li><strong>Time</strong>: Colors change as time passes (what we've done so far)</li> <li><strong>Space</strong>: Colors vary by position along the strip (new in this chapter)</li> </ul> <h3 id=41-rainbow-gradient>4.1 Rainbow Gradient<a class=headerlink href=#41-rainbow-gradient title="Permanent link">~</a></h3> <p><a href="https://tasmota.github.io/docs/Tasmota-Berry-emulator/index.html?example=chap_4_10_color_pattern" target=_blank><img src=../../_media/berry_animation/chap_4_10.png alt="Color Pattern"></a></p> <p>A gradient maps colors to positions along the strip. The <code>palette_gradient</code> does exactly this.</p> <div class=highlight><pre><span></span><code><span class=c1># Rainbow pattern across the strip</span>

<span class=c1># Define a palette with period=0 (no time-based change, only spatial)</span>
<span class=n>color</span><span class=w> </span><span class=n>rainbow_rich_color</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>rich_palette_color</span><span class=p>(</span><span class=n>colors</span><span class=o>=</span><span class=n>PALETTE_RAINBOW_W</span><span class=p>,</span><span class=w> </span><span class=n>period</span><span class=o>=</span><span class=mi>0</span><span class=p>)</span>

<span class=c1># Create a gradient across the whole strip</span>
<span class=n>animation</span><span class=w> </span><span class=n>back_pattern</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>palette_gradient</span><span class=p>(</span><span class=n>color_source</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>rainbow_rich_color</span><span class=p>)</span>
<span class=n>run</span><span class=w> </span><span class=n>back_pattern</span>
</code></pre></div> <p>The magic is <code>period=0</code> - this tells the color provider to ignore time and only vary by position. The gradient animation then maps the palette across the strip's length.</p> <h3 id=42-multiple-gradient-repetitions>4.2 Multiple Gradient Repetitions<a class=headerlink href=#42-multiple-gradient-repetitions title="Permanent link">~</a></h3> <p><a href="https://tasmota.github.io/docs/Tasmota-Berry-emulator/index.html?example=chap_4_12_color_pattern_spatial_2" target=_blank><img src=../../_media/berry_animation/chap_4_12.png alt="Gradient 2x"></a></p> <p>By default, the gradient spans the entire strip once. Use <code>spatial_period</code> to control how many LEDs one complete gradient cycle covers.</p> <div class=highlight><pre><span></span><code><span class=c1># Rainbow gradient with 2 repetitions across the strip</span>

<span class=n>color</span><span class=w> </span><span class=n>rainbow_rich_color</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>rich_palette_color</span><span class=p>(</span><span class=n>colors</span><span class=o>=</span><span class=n>PALETTE_RAINBOW_W</span><span class=p>,</span><span class=w> </span><span class=n>period</span><span class=o>=</span><span class=mi>0</span><span class=p>)</span>

<span class=c1># Get the strip length as a variable</span>
<span class=n>set</span><span class=w> </span><span class=n>strip_len</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>strip_length</span><span class=p>()</span>

<span class=c1># Create gradient with half the strip length as spatial period</span>
<span class=n>animation</span><span class=w> </span><span class=n>back_pattern</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>palette_gradient</span><span class=p>(</span>
<span class=w>  </span><span class=n>color_source</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>rainbow_rich_color</span>
<span class=w>  </span><span class=n>spatial_period</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>strip_len</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=mi>2</span>
<span class=p>)</span>
<span class=n>run</span><span class=w> </span><span class=n>back_pattern</span>
</code></pre></div> <p>With <code>spatial_period = strip_len / 2</code>, the gradient repeats twice across the strip. Use smaller values for more repetitions.</p> <div class="admonition note"> <p class=admonition-title>Using strip_length()</p> <p>The <code>strip_length()</code> function returns the current LED count. Since it's a value provider, you must assign it to a variable with <code>set</code> before using it in calculations.</p> </div> <h3 id=43-oscillating-spatial-period>4.3 Oscillating Spatial Period<a class=headerlink href=#43-oscillating-spatial-period title="Permanent link">~</a></h3> <p><a href="https://tasmota.github.io/docs/Tasmota-Berry-emulator/index.html?example=chap_4_15_color_pattern_spatial_osc" target=_blank><img src=../../_media/berry_animation/chap_4_15.png alt="Oscillating Period"></a></p> <p>Here's where things get interesting: you can make <strong>any parameter dynamic</strong> by using a value provider instead of a fixed number. This example makes the gradient "breathe" by oscillating its spatial period.</p> <div class=highlight><pre><span></span><code><span class=c1># Rainbow gradient with oscillating spatial period</span>

<span class=n>color</span><span class=w> </span><span class=n>rainbow_rich_color</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>rich_palette_color</span><span class=p>(</span><span class=n>colors</span><span class=o>=</span><span class=n>PALETTE_RAINBOW_W</span><span class=p>,</span><span class=w> </span><span class=n>period</span><span class=o>=</span><span class=mi>0</span><span class=p>)</span>

<span class=n>set</span><span class=w> </span><span class=n>strip_len</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>strip_length</span><span class=p>()</span>

<span class=c1># Oscillate spatial period between 1/2 and 3/2 of strip length</span>
<span class=n>set</span><span class=w> </span><span class=n>period</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>sine_osc</span><span class=p>(</span><span class=n>min_value</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>strip_len</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=mi>1</span><span class=p>)</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=mi>2</span><span class=p>,</span><span class=w> </span><span class=n>max_value</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=mi>3</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>strip_len</span><span class=p>)</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=mi>2</span><span class=p>,</span><span class=w> </span><span class=n>duration</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>5</span><span class=err>s</span><span class=p>)</span>

<span class=n>animation</span><span class=w> </span><span class=n>back</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>palette_gradient</span><span class=p>(</span><span class=n>color_source</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>rainbow_rich_color</span><span class=p>,</span><span class=w> </span><span class=n>spatial_period</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>period</span><span class=p>)</span>
<span class=n>run</span><span class=w> </span><span class=n>back</span>
</code></pre></div> <p>The <code>sine_osc</code> function creates a <strong>value provider</strong> - a number that changes smoothly over time. Here it oscillates the spatial period, making the gradient compress and expand.</p> <p><strong>Available oscillators:</strong></p> <table> <thead> <tr> <th>Oscillator</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>sine_osc</code></td> <td>Smooth sine wave</td> </tr> <tr> <td><code>cosine_osc</code></td> <td>Cosine wave (same as sine, different phase)</td> </tr> <tr> <td><code>triangle</code></td> <td>Linear up and down</td> </tr> <tr> <td><code>sawtooth</code></td> <td>Linear up, instant reset</td> </tr> <tr> <td><code>smooth</code></td> <td>Smooth cosine-based</td> </tr> <tr> <td><code>square</code></td> <td>Instant on/off</td> </tr> </tbody> </table> <h3 id=44-rotating-gradient>4.4 Rotating Gradient<a class=headerlink href=#44-rotating-gradient title="Permanent link">~</a></h3> <p><a href="https://tasmota.github.io/docs/Tasmota-Berry-emulator/index.html?example=chap_4_18_color_pattern_spatial_rotate" target=_blank><img src=../../_media/berry_animation/chap_4_18.png alt="Rotating Gradient"></a></p> <p>Make the gradient rotate along the strip:</p> <div class=highlight><pre><span></span><code><span class=c1># Rainbow gradient rotating along the strip over 5 seconds</span>

<span class=n>color</span><span class=w> </span><span class=n>rainbow_rich_color</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>rich_palette_color</span><span class=p>(</span><span class=n>colors</span><span class=o>=</span><span class=n>PALETTE_RAINBOW_W</span><span class=p>,</span><span class=w> </span><span class=n>period</span><span class=o>=</span><span class=mi>0</span><span class=p>)</span>

<span class=n>animation</span><span class=w> </span><span class=n>back</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>palette_gradient</span><span class=p>(</span>
<span class=w>  </span><span class=n>color_source</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>rainbow_rich_color</span>
<span class=w>  </span><span class=n>shift_period</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>5</span><span class=err>s</span><span class=w>    </span><span class=c1># Complete rotation in 5 seconds</span>
<span class=p>)</span>
<span class=n>run</span><span class=w> </span><span class=n>back</span>
</code></pre></div> <p>The <code>shift_period</code> parameter makes the entire pattern shift along the strip.</p> <h3 id=45-vu-meter-style-animation>4.5 VU-Meter Style Animation<a class=headerlink href=#45-vu-meter-style-animation title="Permanent link">~</a></h3> <p><a href="https://tasmota.github.io/docs/Tasmota-Berry-emulator/index.html?example=chap_4_30_color_pattern_meter" target=_blank><img src=../../_media/berry_animation/chap_4_30.png alt="VU Meter"></a></p> <p>Create a meter/bar that fills based on a value:</p> <div class=highlight><pre><span></span><code><span class=c1># VU-meter style animation with green-yellow-red gradient</span>

<span class=c1># Define a VU-meter palette with position-based colors</span>
<span class=n>palette</span><span class=w> </span><span class=n>vue_meter_palette</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>[</span>
<span class=w>  </span><span class=p>(</span><span class=w>  </span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=mh>0x00FF00</span><span class=p>)</span><span class=w>     </span><span class=c1># Green at 0%</span>
<span class=w>  </span><span class=p>(</span><span class=mi>143</span><span class=p>,</span><span class=w> </span><span class=mh>0x00FF00</span><span class=p>)</span><span class=w>     </span><span class=c1># Green until ~56%</span>

<span class=w>  </span><span class=p>(</span><span class=mi>164</span><span class=p>,</span><span class=w> </span><span class=mh>0xFFFF00</span><span class=p>)</span><span class=w>     </span><span class=c1># Yellow transition</span>
<span class=w>  </span><span class=p>(</span><span class=mi>207</span><span class=p>,</span><span class=w> </span><span class=mh>0xFFFF00</span><span class=p>)</span><span class=w>     </span><span class=c1># Yellow until ~81%</span>

<span class=w>  </span><span class=p>(</span><span class=mi>228</span><span class=p>,</span><span class=w> </span><span class=mh>0xFF0000</span><span class=p>)</span><span class=w>     </span><span class=c1># Red transition</span>
<span class=w>  </span><span class=p>(</span><span class=mi>255</span><span class=p>,</span><span class=w> </span><span class=mh>0xFF0000</span><span class=p>)</span><span class=w>     </span><span class=c1># Red at 100%</span>
<span class=p>]</span>

<span class=n>color</span><span class=w> </span><span class=n>rainbow_rich_color</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>rich_palette_color</span><span class=p>(</span><span class=n>colors</span><span class=o>=</span><span class=n>vue_meter_palette</span><span class=p>,</span><span class=w> </span><span class=n>period</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=n>transition_type</span><span class=o>=</span><span class=n>LINEAR</span><span class=p>)</span>

<span class=c1># Sawtooth value from 0% to 100%</span>
<span class=n>set</span><span class=w> </span><span class=n>level</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>sawtooth</span><span class=p>(</span><span class=n>min_value</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=o>%</span><span class=p>,</span><span class=w> </span><span class=n>max_value</span><span class=o>=</span><span class=mi>100</span><span class=o>%</span><span class=p>,</span><span class=w> </span><span class=n>duration</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>2</span><span class=err>s</span><span class=p>)</span>

<span class=c1># Create the meter animation</span>
<span class=n>animation</span><span class=w> </span><span class=n>back</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>palette_meter</span><span class=p>(</span><span class=n>color_source</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>rainbow_rich_color</span><span class=p>,</span><span class=w> </span><span class=n>level</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>level</span><span class=p>)</span>
<span class=n>run</span><span class=w> </span><span class=n>back</span>
</code></pre></div> <p>The palette uses position-based entries <code>(position, color)</code> where position ranges from 0 to 255.</p> <h3 id=46-custom-value-functions>4.6 Custom Value Functions<a class=headerlink href=#46-custom-value-functions title="Permanent link">~</a></h3> <p><a href="https://tasmota.github.io/docs/Tasmota-Berry-emulator/index.html?example=chap_4_35_color_pattern_meter_random" target=_blank><img src=../../_media/berry_animation/chap_4_35.png alt="Random Meter"></a></p> <p>Sometimes the built-in oscillators aren't enough - you need custom logic like random values, sensor readings, or complex calculations. The DSL lets you embed native Berry code and use it in your animations.</p> <p><strong>How it works:</strong></p> <ol> <li><strong>Embed Berry code</strong> using <code>berry """..."""</code> blocks (triple quotes) and multi-line content</li> <li><strong>Declare the function</strong> with <code>extern function name</code> so the DSL knows about it</li> <li><strong>Call the function</strong> in your animation parameters</li> </ol> <p><strong>Function signature:</strong> Your function receives an <code>engine</code> parameter that provides access to timing and animation state. It should return a value (typically 0-255 for levels/opacity).</p> <div class=highlight><pre><span></span><code><span class=c1># VU-meter with random level using custom Berry function</span>

<span class=c1># Step 1: Embed native Berry code</span>
<span class=c1># The function receives &#39;engine&#39; which has properties like time_ms</span>
<span class=n>berry</span><span class=w> </span><span class=s2>&quot;&quot;&quot;</span>
<span class=s2>def rand_meter(engine)</span>
<span class=s2>  # Use time to generate pseudo-random values</span>
<span class=s2>  # The &amp; 0xFF ensures result is 0-255</span>
<span class=s2>  return (engine.time_ms * 2654435761) &amp; 0xFF</span>
<span class=s2>end</span>
<span class=s2>&quot;&quot;&quot;</span>

<span class=c1># Step 2: Declare the function for DSL use</span>
<span class=c1># This tells the transpiler that &#39;rand_meter&#39; is a valid function</span>
<span class=n>extern</span><span class=w> </span><span class=n>function</span><span class=w> </span><span class=n>rand_meter</span>

<span class=n>palette</span><span class=w> </span><span class=n>vue_meter_palette</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>[</span>
<span class=w>  </span><span class=p>(</span><span class=w>  </span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=mh>0x00FF00</span><span class=p>)</span><span class=w>     </span><span class=c1># Green</span>
<span class=w>  </span><span class=p>(</span><span class=mi>143</span><span class=p>,</span><span class=w> </span><span class=mh>0x00FF00</span><span class=p>)</span>
<span class=w>  </span><span class=p>(</span><span class=mi>164</span><span class=p>,</span><span class=w> </span><span class=mh>0xFFFF00</span><span class=p>)</span><span class=w>     </span><span class=c1># Yellow</span>
<span class=w>  </span><span class=p>(</span><span class=mi>207</span><span class=p>,</span><span class=w> </span><span class=mh>0xFFFF00</span><span class=p>)</span>
<span class=w>  </span><span class=p>(</span><span class=mi>228</span><span class=p>,</span><span class=w> </span><span class=mh>0xFF0000</span><span class=p>)</span><span class=w>     </span><span class=c1># Red</span>
<span class=w>  </span><span class=p>(</span><span class=mi>255</span><span class=p>,</span><span class=w> </span><span class=mh>0xFF0000</span><span class=p>)</span>
<span class=p>]</span>

<span class=n>color</span><span class=w> </span><span class=n>rainbow_rich_color</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>rich_palette_color</span><span class=p>(</span><span class=n>colors</span><span class=o>=</span><span class=n>vue_meter_palette</span><span class=p>,</span><span class=w> </span><span class=n>period</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=n>transition_type</span><span class=o>=</span><span class=n>LINEAR</span><span class=p>)</span>

<span class=c1># Step 3: Use the custom function as a parameter</span>
<span class=c1># Call it with () - the engine parameter is passed automatically</span>
<span class=n>animation</span><span class=w> </span><span class=n>back</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>palette_meter</span><span class=p>(</span><span class=n>color_source</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>rainbow_rich_color</span><span class=p>,</span><span class=w> </span><span class=n>level</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>rand_meter</span><span class=p>())</span>
<span class=n>run</span><span class=w> </span><span class=n>back</span>
</code></pre></div> <p>The <code>berry """..."""</code> block lets you embed arbitrary Berry code. The <code>extern function</code> declaration makes it available to the DSL.</p> <hr> <h2 id=chapter-5-beacons-and-moving-effects>Chapter 5: Beacons and Moving Effects<a class=headerlink href=#chapter-5-beacons-and-moving-effects title="Permanent link">~</a></h2> <p>Previous chapters filled the entire strip with colors or gradients. This chapter introduces <strong>beacons</strong> - localized highlights at specific positions. By animating the position, you create moving effects like the classic "Cylon eye" scanner.</p> <p>A beacon has five key properties:</p> <table> <thead> <tr> <th>Property</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr> <td><code>color</code></td> <td>The highlight color</td> <td><code>white</code></td> </tr> <tr> <td><code>back_color</code></td> <td>The background color</td> <td><code>transparent</code></td> </tr> <tr> <td><code>pos</code></td> <td>Position on the strip (pixel index)</td> <td><code>0</code></td> </tr> <tr> <td><code>beacon_size</code></td> <td>Width of the highlight in pixels</td> <td><code>1</code></td> </tr> <tr> <td><code>slew_size</code></td> <td>Fade-out width on each edge (soft edges)</td> <td><code>0</code></td> </tr> </tbody> </table> <h3 id=51-static-beacon>5.1 Static Beacon<a class=headerlink href=#51-static-beacon title="Permanent link">~</a></h3> <p><a href="https://tasmota.github.io/docs/Tasmota-Berry-emulator/index.html?example=chap_5_10_beacon" target=_blank><img src=../../_media/berry_animation/chap_5_10.png alt="Static Beacon"></a></p> <p>Let's start with a stationary beacon - a red highlight on a blue background.</p> <div class=highlight><pre><span></span><code><span class=c1># Static beacon</span>

<span class=n>animation</span><span class=w> </span><span class=n>back</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>beacon</span><span class=p>(</span>
<span class=w>  </span><span class=n>back_color</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>blue</span>
<span class=w>  </span><span class=n>color</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>red</span>
<span class=w>  </span><span class=n>pos</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>5</span><span class=w>              </span><span class=c1># Start at pixel 5</span>
<span class=w>  </span><span class=n>beacon_size</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>7</span><span class=w>      </span><span class=c1># 7 pixels wide</span>
<span class=p>)</span>
<span class=n>run</span><span class=w> </span><span class=n>back</span>
</code></pre></div> <h3 id=52-beacon-with-slew-soft-edges>5.2 Beacon with Slew (Soft Edges)<a class=headerlink href=#52-beacon-with-slew-soft-edges title="Permanent link">~</a></h3> <p><a href="https://tasmota.github.io/docs/Tasmota-Berry-emulator/index.html?example=chap_5_15_beacon_slew" target=_blank><img src=../../_media/berry_animation/chap_5_15.png alt="Beacon Slew"></a></p> <p>Hard edges can look harsh. The <code>slew_size</code> parameter adds a gradual fade on each side of the beacon, creating softer, more natural-looking highlights.</p> <p><strong>How slew works:</strong></p> <ul> <li>The slew creates a transition zone of <code>slew_size</code> pixels on each side of the beacon</li> <li>Within the slew zone, the color gradually blends from <code>color</code> to <code>back_color</code></li> <li>The blending is linear: the first slew pixel is mostly <code>color</code>, the last is mostly <code>back_color</code></li> <li>If <code>back_color</code> is <code>transparent</code>, the edges become progressively transparent, allowing underlying animations to show through</li> </ul> <p><strong>Total width:</strong> A beacon with <code>beacon_size=7</code> and <code>slew_size=3</code> occupies 7 + 3 + 3 = 13 pixels total (7 solid + 3 fade on each side).</p> <div class=highlight><pre><span></span><code><span class=c1># Static beacon with slew</span>

<span class=n>animation</span><span class=w> </span><span class=n>back</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>beacon</span><span class=p>(</span>
<span class=w>  </span><span class=n>back_color</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>blue</span>
<span class=w>  </span><span class=n>color</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>red</span>
<span class=w>  </span><span class=n>pos</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>5</span>
<span class=w>  </span><span class=n>beacon_size</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>7</span>
<span class=w>  </span><span class=n>slew_size</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>3</span><span class=w>        </span><span class=c1># 3 pixel fade on each side</span>
<span class=p>)</span>
<span class=n>run</span><span class=w> </span><span class=n>back</span>
</code></pre></div> <h3 id=53-animated-slew>5.3 Animated Slew<a class=headerlink href=#53-animated-slew title="Permanent link">~</a></h3> <p><a href="https://tasmota.github.io/docs/Tasmota-Berry-emulator/index.html?example=chap_5_20_beacon_slew_osc" target=_blank><img src=../../_media/berry_animation/chap_5_20.png alt="Oscillating Slew"></a></p> <p>Remember: any numeric parameter can be replaced with a value provider. Here we make the slew size pulse in and out.</p> <div class=highlight><pre><span></span><code><span class=c1># Beacon with oscillating slew</span>

<span class=n>set</span><span class=w> </span><span class=n>slew</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>cosine_osc</span><span class=p>(</span><span class=n>min_value</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=n>max_value</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>4</span><span class=p>,</span><span class=w> </span><span class=n>duration</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>2</span><span class=err>s</span><span class=p>)</span>

<span class=n>animation</span><span class=w> </span><span class=n>back</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>beacon</span><span class=p>(</span>
<span class=w>  </span><span class=n>back_color</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>blue</span>
<span class=w>  </span><span class=n>color</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>red</span>
<span class=w>  </span><span class=n>pos</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>5</span>
<span class=w>  </span><span class=n>beacon_size</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>7</span>
<span class=w>  </span><span class=n>slew_size</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>slew</span><span class=w>     </span><span class=c1># Dynamic slew size</span>
<span class=p>)</span>
<span class=n>run</span><span class=w> </span><span class=n>back</span>
</code></pre></div> <h3 id=54-cylon-eye-moving-beacon>5.4 Cylon Eye (Moving Beacon)<a class=headerlink href=#54-cylon-eye-moving-beacon title="Permanent link">~</a></h3> <p><a href="https://tasmota.github.io/docs/Tasmota-Berry-emulator/index.html?example=chap_5_30_cylon" target=_blank><img src=../../_media/berry_animation/chap_5_30.png alt="Cylon Eye"></a></p> <p>Now for the classic effect: a beacon that moves back and forth across the strip. We use <code>cosine_osc</code> on the <code>pos</code> parameter to create smooth scanning motion.</p> <div class=highlight><pre><span></span><code><span class=c1># Moving red beacon - Cylon style</span>

<span class=n>set</span><span class=w> </span><span class=n>strip_len</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>strip_length</span><span class=p>()</span>

<span class=n>animation</span><span class=w> </span><span class=n>back</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>beacon</span><span class=p>(</span>
<span class=w>    </span><span class=n>color</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>red</span>
<span class=w>    </span><span class=n>pos</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>cosine_osc</span><span class=p>(</span><span class=n>min_value</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>-1</span><span class=p>,</span><span class=w> </span><span class=n>max_value</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>strip_len</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=mi>2</span><span class=p>,</span><span class=w> </span><span class=n>duration</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>5</span><span class=err>s</span><span class=p>)</span>
<span class=w>    </span><span class=n>beacon_size</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>3</span><span class=w>       </span><span class=c1># small 3 pixels eye</span>
<span class=w>    </span><span class=n>slew_size</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>2</span><span class=w>         </span><span class=c1># with 2 pixel shading around</span>
<span class=p>)</span>
<span class=n>run</span><span class=w> </span><span class=n>back</span>
</code></pre></div> <p>The cosine oscillator creates smooth acceleration and deceleration at the ends, just like the original Battlestar Galactica Cylon!</p> <h3 id=55-rainbow-cylon-with-stars>5.5 Rainbow Cylon with Stars<a class=headerlink href=#55-rainbow-cylon-with-stars title="Permanent link">~</a></h3> <p><a href="https://tasmota.github.io/docs/Tasmota-Berry-emulator/index.html?example=chap_5_40_cylon_rainbow" target=_blank><img src=../../_media/berry_animation/chap_5_40.png alt="Rainbow Cylon"></a></p> <p>Let's combine everything we've learned: layered animations, dynamic colors, and moving beacons. This example creates a scene with two layers.</p> <p><strong>Layer structure (rendered bottom to top):</strong></p> <table> <thead> <tr> <th>Priority</th> <th>Animation</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td>10 (default)</td> <td><code>stars</code></td> <td>Twinkling background - rendered first</td> </tr> <tr> <td>5</td> <td><code>back</code></td> <td>Moving rainbow beacon - rendered on top</td> </tr> </tbody> </table> <p><strong>How layering works:</strong></p> <ol> <li>The <code>stars</code> animation runs with default priority 10</li> <li>The <code>back</code> beacon runs with priority 5 (lower = on top)</li> <li>The beacon uses <code>back_color = transparent</code> (default), so where there's no beacon, the stars show through</li> <li>The beacon's slew creates a soft edge that gradually reveals the stars underneath</li> </ol> <div class=highlight><pre><span></span><code><span class=c1># Moving rainbow beacon with twinkling stars background</span>

<span class=n>set</span><span class=w> </span><span class=n>strip_len</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>strip_length</span><span class=p>()</span>

<span class=c1># Twinkling stars background</span>
<span class=n>animation</span><span class=w> </span><span class=n>stars</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>twinkle</span><span class=p>(</span>
<span class=w>  </span><span class=n>color</span><span class=o>=</span><span class=mh>0xFFFFAA</span>
<span class=w>  </span><span class=n>density</span><span class=o>=</span><span class=mi>2</span>
<span class=w>  </span><span class=n>twinkle_speed</span><span class=o>=</span><span class=mi>100</span><span class=err>ms</span>
<span class=w>  </span><span class=n>fade_speed</span><span class=o>=</span><span class=mi>100</span>
<span class=w>  </span><span class=c1># priority = 10 (default)</span>
<span class=p>)</span>
<span class=n>run</span><span class=w> </span><span class=n>stars</span>

<span class=c1># Moving beacon with dynamic color</span>
<span class=c1># back_color defaults to transparent, so stars show through</span>
<span class=n>animation</span><span class=w> </span><span class=n>back</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>beacon</span><span class=p>(</span>
<span class=w>    </span><span class=n>color</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>rich_palette_color</span><span class=p>(</span><span class=n>colors</span><span class=o>=</span><span class=n>PALETTE_RAINBOW_W2</span><span class=p>,</span><span class=w> </span><span class=n>period</span><span class=o>=</span><span class=mi>5</span><span class=err>s</span><span class=p>)</span>
<span class=w>    </span><span class=n>pos</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>cosine_osc</span><span class=p>(</span><span class=n>min_value</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>-1</span><span class=p>,</span><span class=w> </span><span class=n>max_value</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>strip_len</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=mi>2</span><span class=p>,</span><span class=w> </span><span class=n>duration</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>5</span><span class=err>s</span><span class=p>)</span>
<span class=w>    </span><span class=n>beacon_size</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>3</span>
<span class=w>    </span><span class=n>slew_size</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>2</span>
<span class=w>    </span><span class=n>priority</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>5</span><span class=w>          </span><span class=c1># Lower priority = rendered on top of stars</span>
<span class=p>)</span>
<span class=n>run</span><span class=w> </span><span class=n>back</span>
</code></pre></div> <p>The result: a rainbow-colored eye scans across a field of twinkling stars, with the stars visible everywhere except where the beacon is.</p> <h3 id=56-beacon-as-opacity-mask>5.6 Beacon as Opacity Mask<a class=headerlink href=#56-beacon-as-opacity-mask title="Permanent link">~</a></h3> <p><a href="https://tasmota.github.io/docs/Tasmota-Berry-emulator/index.html?example=chap_5_50_cylon_opacity" target=_blank><img src=../../_media/berry_animation/chap_5_50.png alt="Opacity Mask"></a></p> <p>Instead of layering animations with priority, you can use one animation as an <strong>opacity mask</strong> for another. This creates a "window" effect where the mask controls what's visible.</p> <p><strong>How opacity masks work:</strong></p> <ol> <li>The mask animation renders to determine opacity values (0-255 per pixel)</li> <li>Where the mask is bright (white/high values), the main animation is fully visible</li> <li>Where the mask is dark (black/low values), the main animation is transparent</li> <li>The mask's actual color doesn't matter - only its brightness/alpha is used</li> </ol> <p><strong>In this example:</strong></p> <ul> <li><code>moving_eye</code> is a beacon that moves back and forth</li> <li><code>eye_pattern</code> is a red-blue-red gradient across the entire strip</li> <li>The gradient is only visible where the beacon is - creating a "spotlight" effect</li> <li>The beacon's slew creates soft edges on the spotlight</li> </ul> <div class=highlight><pre><span></span><code><span class=c1># Moving beacon used as opacity filter on pattern</span>

<span class=n>set</span><span class=w> </span><span class=n>strip_len</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>strip_length</span><span class=p>()</span>

<span class=c1># Define a red-blue-red gradient palette</span>
<span class=n>palette</span><span class=w> </span><span class=n>red_blue_red_palette</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>[</span><span class=w> </span><span class=n>red</span><span class=p>,</span><span class=w> </span><span class=mh>0x3333FF</span><span class=p>,</span><span class=w> </span><span class=n>red</span><span class=w> </span><span class=p>]</span>
<span class=n>color</span><span class=w> </span><span class=n>red_blue_red_color</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>rich_palette_color</span><span class=p>(</span><span class=n>colors</span><span class=o>=</span><span class=n>red_blue_red_palette</span><span class=p>)</span>

<span class=c1># Moving beacon as opacity mask</span>
<span class=c1># The color is white but it doesn&#39;t matter - only brightness counts</span>
<span class=n>animation</span><span class=w> </span><span class=n>moving_eye</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>beacon</span><span class=p>(</span>
<span class=w>    </span><span class=n>color</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>white</span><span class=w>           </span><span class=c1># Color doesn&#39;t matter, only brightness/alpha</span>
<span class=w>    </span><span class=n>pos</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>cosine_osc</span><span class=p>(</span><span class=n>min_value</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>-1</span><span class=p>,</span><span class=w> </span><span class=n>max_value</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>strip_len</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=mi>2</span><span class=p>,</span><span class=w> </span><span class=n>duration</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>5</span><span class=err>s</span><span class=p>)</span>
<span class=w>    </span><span class=n>beacon_size</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>3</span>
<span class=w>    </span><span class=n>slew_size</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>2</span>
<span class=p>)</span>

<span class=c1># Apply the mask to a gradient</span>
<span class=c1># The gradient exists everywhere, but only shows where the beacon is</span>
<span class=n>animation</span><span class=w> </span><span class=n>eye_pattern</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>palette_gradient</span><span class=p>(</span>
<span class=w>  </span><span class=n>color_source</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>red_blue_red_color</span>
<span class=w>  </span><span class=n>opacity</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>moving_eye</span><span class=w>      </span><span class=c1># Use beacon as opacity mask</span>
<span class=p>)</span>
<span class=n>run</span><span class=w> </span><span class=n>eye_pattern</span>
</code></pre></div> <p>The result: a moving "window" reveals different parts of the underlying gradient as it scans across the strip.</p> <hr> <h2 id=chapter-6-shutters-and-sequences>Chapter 6: Shutters and Sequences<a class=headerlink href=#chapter-6-shutters-and-sequences title="Permanent link">~</a></h2> <p>This chapter introduces two powerful concepts:</p> <ol> <li><strong>Shutters</strong> - Expanding/contracting effects created by animating a beacon's size</li> <li><strong>Sequences</strong> - Orchestrating multiple animations with precise timing control</li> </ol> <p>Sequences are essential when you need things to happen in order: play animation A, then wait, then play animation B, then change a color, etc.</p> <h3 id=61-simple-shutter>6.1 Simple Shutter<a class=headerlink href=#61-simple-shutter title="Permanent link">~</a></h3> <p><a href="https://tasmota.github.io/docs/Tasmota-Berry-emulator/index.html?example=chap_6_10_shutter_lr" target=_blank><img src=../../_media/berry_animation/chap_6_10.png alt="Simple Shutter"></a></p> <p>A shutter effect is simply a beacon with an animated size. Using <code>sawtooth</code> makes it grow linearly then reset.</p> <div class=highlight><pre><span></span><code><span class=c1># Shutter left to right using beacon</span>

<span class=n>set</span><span class=w> </span><span class=n>strip_len</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>strip_length</span><span class=p>()</span>

<span class=c1># Sawtooth from 0 to strip_len - grows linearly, then resets</span>
<span class=n>set</span><span class=w> </span><span class=n>shutter_size</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>sawtooth</span><span class=p>(</span><span class=n>min_value</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=n>max_value</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>strip_len</span><span class=p>,</span><span class=w> </span><span class=n>duration</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=mf>.5</span><span class=err>s</span><span class=p>)</span>

<span class=n>animation</span><span class=w> </span><span class=n>shutter_lr_animation</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>beacon</span><span class=p>(</span>
<span class=w>    </span><span class=n>color</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>red</span>
<span class=w>    </span><span class=n>back_color</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>blue</span>
<span class=w>    </span><span class=n>pos</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=w>                         </span><span class=c1># Start from left</span>
<span class=w>    </span><span class=n>beacon_size</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>shutter_size</span><span class=w>      </span><span class=c1># Expanding size</span>
<span class=p>)</span>
<span class=n>run</span><span class=w> </span><span class=n>shutter_lr_animation</span>
</code></pre></div> <h3 id=62-shutter-with-rotating-colors>6.2 Shutter with Rotating Colors<a class=headerlink href=#62-shutter-with-rotating-colors title="Permanent link">~</a></h3> <p><a href="https://tasmota.github.io/docs/Tasmota-Berry-emulator/index.html?example=chap_6_20_shutter_lr_rotate" target=_blank><img src=../../_media/berry_animation/chap_6_20.png alt="Rotating Shutter"></a></p> <p>Now let's add color changes after each shutter cycle. This requires a <strong>sequence</strong> - a way to run code at specific times.</p> <p>A sequence contains steps that execute in order:</p> <ul> <li><code>play animation for duration</code> - Run an animation for a specific time</li> <li><code>wait duration</code> - Pause before the next step</li> <li><code>restart provider</code> - Reset a value provider's timing</li> <li><code>repeat N times { ... }</code> - Loop a block of steps</li> </ul> <div class=highlight><pre><span></span><code><span class=c1># Shutter with rotating colors using sequence</span>

<span class=n>set</span><span class=w> </span><span class=n>strip_len</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>strip_length</span><span class=p>()</span>
<span class=n>set</span><span class=w> </span><span class=n>period</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=mf>.5</span><span class=err>s</span>

<span class=n>set</span><span class=w> </span><span class=n>shutter_size</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>sawtooth</span><span class=p>(</span><span class=n>min_value</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=n>max_value</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>strip_len</span><span class=p>,</span><span class=w> </span><span class=n>duration</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>period</span><span class=p>)</span>

<span class=c1># Two color providers cycling through rainbow</span>
<span class=c1># period=0 means they don&#39;t auto-cycle - we control them manually</span>
<span class=n>color</span><span class=w> </span><span class=n>col1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>color_cycle</span><span class=p>(</span><span class=n>colors</span><span class=o>=</span><span class=n>PALETTE_RAINBOW_W</span><span class=p>,</span><span class=w> </span><span class=n>period</span><span class=o>=</span><span class=mi>0</span><span class=p>)</span>
<span class=n>color</span><span class=w> </span><span class=n>col2</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>color_cycle</span><span class=p>(</span><span class=n>colors</span><span class=o>=</span><span class=n>PALETTE_RAINBOW_W</span><span class=p>,</span><span class=w> </span><span class=n>period</span><span class=o>=</span><span class=mi>0</span><span class=p>)</span>
<span class=n>col2</span><span class=p>.</span><span class=na>next</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w>           </span><span class=c1># Shift col2 by one color at startup</span>

<span class=n>animation</span><span class=w> </span><span class=n>shutter_lr_animation</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>beacon</span><span class=p>(</span>
<span class=w>    </span><span class=n>color</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>col2</span>
<span class=w>    </span><span class=n>back_color</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>col1</span>
<span class=w>    </span><span class=n>pos</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span>
<span class=w>    </span><span class=n>beacon_size</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>shutter_size</span>
<span class=p>)</span>

<span class=c1># Sequence running forever</span>
<span class=n>sequence</span><span class=w> </span><span class=n>shutter_seq</span><span class=w> </span><span class=n>repeat</span><span class=w> </span><span class=n>forever</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=n>restart</span><span class=w> </span><span class=n>shutter_size</span><span class=w>        </span><span class=c1># Sync timing</span>
<span class=w>    </span><span class=n>play</span><span class=w> </span><span class=n>shutter_lr_animation</span><span class=w> </span><span class=k>for</span><span class=w> </span><span class=n>period</span>
<span class=w>    </span><span class=n>col1</span><span class=p>.</span><span class=na>next</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w>               </span><span class=c1># Advance col1 to next color in palette</span>
<span class=w>    </span><span class=n>col2</span><span class=p>.</span><span class=na>next</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w>               </span><span class=c1># Advance col2 to next color in palette</span>
<span class=p>}</span>
<span class=n>run</span><span class=w> </span><span class=n>shutter_seq</span>
</code></pre></div> <p><strong>Understanding <code>color_cycle</code> with <code>period=0</code>:</strong></p> <p>When <code>period=0</code>, the color provider doesn't automatically cycle through colors over time. Instead, you control it manually by writing to its <code>next</code> property:</p> <ul> <li><code>col.next = 1</code> - Advance to the next color in the palette</li> <li><code>col.next = 2</code> - Skip ahead by 2 colors</li> <li><code>col.next = -1</code> - Go back to the previous color</li> </ul> <p>This gives you precise control over color changes, synchronized with your sequence timing.</p> <p><strong>Sequence statements:</strong></p> <table> <thead> <tr> <th>Statement</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>play animation for duration</code></td> <td>Play an animation for a specific time</td> </tr> <tr> <td><code>wait duration</code></td> <td>Pause the sequence</td> </tr> <tr> <td><code>restart value_provider</code></td> <td>Reset a value provider's timing</td> </tr> <tr> <td><code>repeat N times { ... }</code></td> <td>Repeat a block N times</td> </tr> <tr> <td><code>repeat forever { ... }</code></td> <td>Repeat indefinitely</td> </tr> </tbody> </table> <h3 id=63-central-shutter>6.3 Central Shutter<a class=headerlink href=#63-central-shutter title="Permanent link">~</a></h3> <p><a href="https://tasmota.github.io/docs/Tasmota-Berry-emulator/index.html?example=chap_6_30_shutter_central" target=_blank><img src=../../_media/berry_animation/chap_6_30.png alt="Central Shutter"></a></p> <p>Instead of expanding from the left edge, this shutter expands from the center outward.</p> <p><strong>From left-right to center-out:</strong></p> <p>The key difference is the <code>pos</code> calculation:</p> <ul> <li><strong>Left-right shutter</strong> (6.1): <code>pos = 0</code> - beacon starts at left edge and grows rightward</li> <li><strong>Center-out shutter</strong> (6.3): <code>pos = strip_len_2 - (shutter_size + 1) / 2</code> - beacon stays centered as it grows</li> </ul> <p>The formula <code>strip_len_2 - (shutter_size + 1) / 2</code> keeps the beacon centered by:</p> <ol> <li>Starting at the center (<code>strip_len_2</code>)</li> <li>Subtracting half the beacon size so it expands equally in both directions</li> <li>As <code>shutter_size</code> grows from 0 to <code>strip_len</code>, the position moves left to keep the beacon centered</li> </ol> <div class=highlight><pre><span></span><code><span class=c1># Shutter central with rotating colors</span>

<span class=n>set</span><span class=w> </span><span class=n>strip_len</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>strip_length</span><span class=p>()</span>
<span class=n>set</span><span class=w> </span><span class=n>strip_len_2</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>strip_len</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mi>1</span><span class=p>)</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=mi>2</span><span class=w>       </span><span class=c1># Half length (center position)</span>

<span class=n>set</span><span class=w> </span><span class=n>period</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=mf>.5</span><span class=err>s</span>
<span class=n>set</span><span class=w> </span><span class=n>shutter_size</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>sawtooth</span><span class=p>(</span><span class=n>min_value</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=n>max_value</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>strip_len</span><span class=p>,</span><span class=w> </span><span class=n>duration</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>period</span><span class=p>)</span>

<span class=n>color</span><span class=w> </span><span class=n>col1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>color_cycle</span><span class=p>(</span><span class=n>colors</span><span class=o>=</span><span class=n>PALETTE_RAINBOW_W</span><span class=p>,</span><span class=w> </span><span class=n>period</span><span class=o>=</span><span class=mi>0</span><span class=p>)</span>
<span class=n>color</span><span class=w> </span><span class=n>col2</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>color_cycle</span><span class=p>(</span><span class=n>colors</span><span class=o>=</span><span class=n>PALETTE_RAINBOW_W</span><span class=p>,</span><span class=w> </span><span class=n>period</span><span class=o>=</span><span class=mi>0</span><span class=p>)</span>
<span class=n>col2</span><span class=p>.</span><span class=na>next</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span>

<span class=c1># Position calculated to center the beacon as it grows</span>
<span class=n>animation</span><span class=w> </span><span class=n>shutter_inout_animation</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>beacon</span><span class=p>(</span>
<span class=w>    </span><span class=n>color</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>col2</span>
<span class=w>    </span><span class=n>back_color</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>col1</span>
<span class=w>    </span><span class=n>pos</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>strip_len_2</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=p>(</span><span class=n>shutter_size</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mi>1</span><span class=p>)</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=mi>2</span>
<span class=w>    </span><span class=n>beacon_size</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>shutter_size</span>
<span class=p>)</span>

<span class=n>sequence</span><span class=w> </span><span class=n>shutter_seq</span><span class=w> </span><span class=n>repeat</span><span class=w> </span><span class=n>forever</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=n>restart</span><span class=w> </span><span class=n>shutter_size</span>
<span class=w>    </span><span class=n>play</span><span class=w> </span><span class=n>shutter_inout_animation</span><span class=w> </span><span class=k>for</span><span class=w> </span><span class=n>period</span>
<span class=w>    </span><span class=n>col1</span><span class=p>.</span><span class=na>next</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span>
<span class=w>    </span><span class=n>col2</span><span class=p>.</span><span class=na>next</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span>
<span class=p>}</span>
<span class=n>run</span><span class=w> </span><span class=n>shutter_seq</span>
</code></pre></div> <h3 id=64-bidirectional-shutter>6.4 Bidirectional Shutter<a class=headerlink href=#64-bidirectional-shutter title="Permanent link">~</a></h3> <p><a href="https://tasmota.github.io/docs/Tasmota-Berry-emulator/index.html?example=chap_6_40_shutter_central_bidir" target=_blank><img src=../../_media/berry_animation/chap_6_40.png alt="Bidirectional Shutter"></a></p> <p>This example combines both directions: first the shutter expands from center (in-out), then contracts back to center (out-in). The sequence cycles through all palette colors in each direction before switching.</p> <p><strong>Sequence structure:</strong></p> <p>The sequence contains two nested <code>repeat</code> blocks:</p> <ol> <li><strong>First repeat</strong>: Runs the in-out animation once for each color in the palette</li> <li><strong>Second repeat</strong>: Runs the out-in animation once for each color in the palette</li> </ol> <p>The repeat count <code>col1.palette_size</code> dynamically gets the number of colors in the palette (8 for <code>PALETTE_RAINBOW_W</code>), so the animation automatically adapts if you change palettes.</p> <p><strong>Why <code>restart</code> is important:</strong></p> <p>The <code>shutter_size</code> sawtooth oscillator runs continuously based on elapsed time. Without <code>restart</code>, each iteration would start wherever the sawtooth happened to be, causing visual glitches. By calling <code>restart shutter_size</code> at the beginning of each iteration:</p> <ul> <li>The sawtooth resets to its starting value (0)</li> <li>The shutter animation starts cleanly from the beginning</li> <li>Everything stays perfectly synchronized with the sequence timing</li> </ul> <div class=highlight><pre><span></span><code><span class=c1># Shutter central in-out and out-in with rotating colors</span>

<span class=n>set</span><span class=w> </span><span class=n>strip_len</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>strip_length</span><span class=p>()</span>
<span class=n>set</span><span class=w> </span><span class=n>strip_len_2</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>strip_len</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mi>1</span><span class=p>)</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=mi>2</span>

<span class=n>set</span><span class=w> </span><span class=n>period</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=mf>.5</span><span class=err>s</span>
<span class=n>set</span><span class=w> </span><span class=n>shutter_size</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>sawtooth</span><span class=p>(</span><span class=n>min_value</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=n>max_value</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>strip_len</span><span class=p>,</span><span class=w> </span><span class=n>duration</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>period</span><span class=p>)</span>

<span class=n>color</span><span class=w> </span><span class=n>col1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>color_cycle</span><span class=p>(</span><span class=n>colors</span><span class=o>=</span><span class=n>PALETTE_RAINBOW_W</span><span class=p>,</span><span class=w> </span><span class=n>period</span><span class=o>=</span><span class=mi>0</span><span class=p>)</span>
<span class=n>color</span><span class=w> </span><span class=n>col2</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>color_cycle</span><span class=p>(</span><span class=n>colors</span><span class=o>=</span><span class=n>PALETTE_RAINBOW_W</span><span class=p>,</span><span class=w> </span><span class=n>period</span><span class=o>=</span><span class=mi>0</span><span class=p>)</span>
<span class=n>col2</span><span class=p>.</span><span class=na>next</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span>

<span class=c1># In-out animation: beacon grows from center outward</span>
<span class=n>animation</span><span class=w> </span><span class=n>shutter_inout_animation</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>beacon</span><span class=p>(</span>
<span class=w>    </span><span class=n>color</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>col2</span>
<span class=w>    </span><span class=n>back_color</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>col1</span>
<span class=w>    </span><span class=n>pos</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>strip_len_2</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=p>(</span><span class=n>shutter_size</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mi>1</span><span class=p>)</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=mi>2</span>
<span class=w>    </span><span class=n>beacon_size</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>shutter_size</span>
<span class=p>)</span>

<span class=c1># Out-in animation: beacon shrinks from edges toward center</span>
<span class=c1># Uses inverted size (strip_len - shutter_size) and swapped colors</span>
<span class=n>animation</span><span class=w> </span><span class=n>shutter_outin_animation</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>beacon</span><span class=p>(</span>
<span class=w>    </span><span class=n>color</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>col1</span>
<span class=w>    </span><span class=n>back_color</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>col2</span>
<span class=w>    </span><span class=n>pos</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>strip_len_2</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=p>(</span><span class=n>strip_len</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>shutter_size</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mi>1</span><span class=p>)</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=mi>2</span>
<span class=w>    </span><span class=n>beacon_size</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>strip_len</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>shutter_size</span>
<span class=p>)</span>

<span class=n>sequence</span><span class=w> </span><span class=n>shutter_seq</span><span class=w> </span><span class=n>repeat</span><span class=w> </span><span class=n>forever</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=c1># First: cycle through all colors in-out (8 iterations for PALETTE_RAINBOW_W)</span>
<span class=w>    </span><span class=n>repeat</span><span class=w> </span><span class=n>col1</span><span class=p>.</span><span class=na>palette_size</span><span class=w> </span><span class=n>times</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=n>restart</span><span class=w> </span><span class=n>shutter_size</span><span class=w>        </span><span class=c1># Reset sawtooth to 0 for clean start</span>
<span class=w>        </span><span class=n>play</span><span class=w> </span><span class=n>shutter_inout_animation</span><span class=w> </span><span class=k>for</span><span class=w> </span><span class=n>period</span>
<span class=w>        </span><span class=n>col1</span><span class=p>.</span><span class=na>next</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w>               </span><span class=c1># Advance both colors</span>
<span class=w>        </span><span class=n>col2</span><span class=p>.</span><span class=na>next</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>    </span><span class=c1># Then: cycle through all colors out-in (8 more iterations)</span>
<span class=w>    </span><span class=n>repeat</span><span class=w> </span><span class=n>col1</span><span class=p>.</span><span class=na>palette_size</span><span class=w> </span><span class=n>times</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=n>restart</span><span class=w> </span><span class=n>shutter_size</span><span class=w>        </span><span class=c1># Reset sawtooth again</span>
<span class=w>        </span><span class=n>play</span><span class=w> </span><span class=n>shutter_outin_animation</span><span class=w> </span><span class=k>for</span><span class=w> </span><span class=n>period</span>
<span class=w>        </span><span class=n>col1</span><span class=p>.</span><span class=na>next</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span>
<span class=w>        </span><span class=n>col2</span><span class=p>.</span><span class=na>next</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span>
<span class=w>    </span><span class=p>}</span>
<span class=p>}</span>
<span class=n>run</span><span class=w> </span><span class=n>shutter_seq</span>
</code></pre></div> <hr> <h2 id=chapter-7-crenel-patterns>Chapter 7: Crenel Patterns<a class=headerlink href=#chapter-7-crenel-patterns title="Permanent link">~</a></h2> <p>Crenels create repeating square wave patterns - alternating blocks of two colors, like the battlements on a castle wall. They're useful for:</p> <ul> <li>Creating striped patterns</li> <li>Building opacity masks with regular gaps</li> <li>Marquee-style effects when animated</li> </ul> <h3 id=71-static-crenel>7.1 Static Crenel<a class=headerlink href=#71-static-crenel title="Permanent link">~</a></h3> <p><a href="https://tasmota.github.io/docs/Tasmota-Berry-emulator/index.html?example=chap_7_10_crenel" target=_blank><img src=../../_media/berry_animation/chap_7_10.png alt="Static Crenel"></a></p> <p>A basic crenel alternates between two colors with configurable block sizes.</p> <p><strong>Crenel parameters:</strong></p> <table> <thead> <tr> <th>Parameter</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr> <td><code>color</code></td> <td>Color of the "high" pulses</td> <td><code>white</code></td> </tr> <tr> <td><code>back_color</code></td> <td>Color of the "low" gaps</td> <td><code>transparent</code> (0x00000000)</td> </tr> <tr> <td><code>pos</code></td> <td>Starting position on the strip</td> <td><code>0</code></td> </tr> <tr> <td><code>pulse_size</code></td> <td>Width of each pulse in pixels</td> <td><code>1</code></td> </tr> <tr> <td><code>low_size</code></td> <td>Width of each gap in pixels</td> <td><code>3</code></td> </tr> <tr> <td><code>nb_pulse</code></td> <td>Number of pulses (<code>-1</code> = infinite)</td> <td><code>-1</code></td> </tr> </tbody> </table> <p>The pattern repeats with a period of <code>pulse_size + low_size</code> pixels.</p> <div class=highlight><pre><span></span><code><span class=c1># Static crenel pattern</span>

<span class=n>animation</span><span class=w> </span><span class=n>back</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>crenel</span><span class=p>(</span>
<span class=w>    </span><span class=n>color</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>red</span>
<span class=w>    </span><span class=n>back_color</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>blue</span>
<span class=w>    </span><span class=n>pulse_size</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>2</span><span class=w>        </span><span class=c1># 2 pixels of &#39;color&#39;</span>
<span class=w>    </span><span class=n>low_size</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>2</span><span class=w>          </span><span class=c1># 2 pixels of &#39;back_color&#39;</span>
<span class=p>)</span>
<span class=n>run</span><span class=w> </span><span class=n>back</span>
</code></pre></div> <p>This creates a pattern: ... across the entire strip.</p> <h3 id=72-variable-number-of-pulses>7.2 Variable Number of Pulses<a class=headerlink href=#72-variable-number-of-pulses title="Permanent link">~</a></h3> <p><a href="https://tasmota.github.io/docs/Tasmota-Berry-emulator/index.html?example=chap_7_20_crenel_nb_pulse" target=_blank><img src=../../_media/berry_animation/chap_7_20.png alt="Variable Pulses"></a></p> <p>Instead of showing all pulses (<code>nb_pulse = -1</code>), you can animate the number of visible pulses using a value provider. The <code>triangle</code> oscillator smoothly varies <code>nb_pulse</code> from 0 (no pulses) to the maximum that fits on the strip.</p> <p>To compute the maximum number of pulses, use the formula: <code>max_pulses = (strip_len + period - 1) / period</code> where <code>period = pulse_size + low_size</code>. This ceiling division ensures we count partial pulses at the end of the strip.</p> <div class=highlight><pre><span></span><code><span class=c1># Crenel with variable number of pulses</span>

<span class=n>set</span><span class=w> </span><span class=n>strip_len</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>strip_length</span><span class=p>()</span>
<span class=n>set</span><span class=w> </span><span class=n>period</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>4</span><span class=w>                    </span><span class=c1># pulse_size (2) + low_size (2)</span>
<span class=n>set</span><span class=w> </span><span class=n>max_pulses</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>strip_len</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>period</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=mi>1</span><span class=p>)</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=n>period</span>

<span class=n>set</span><span class=w> </span><span class=n>nb_pulse</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>triangle</span><span class=p>(</span><span class=n>min_value</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=n>max_value</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>max_pulses</span><span class=p>,</span><span class=w> </span><span class=n>duration</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>2</span><span class=err>s</span><span class=p>)</span>

<span class=n>animation</span><span class=w> </span><span class=n>back</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>crenel</span><span class=p>(</span>
<span class=w>    </span><span class=n>color</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>red</span>
<span class=w>    </span><span class=n>back_color</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>blue</span>
<span class=w>    </span><span class=n>pulse_size</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>2</span>
<span class=w>    </span><span class=n>low_size</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>2</span>
<span class=w>    </span><span class=n>nb_pulse</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>nb_pulse</span>
<span class=p>)</span>
<span class=n>run</span><span class=w> </span><span class=n>back</span>
</code></pre></div> <h3 id=73-variable-pulse-size>7.3 Variable Pulse Size<a class=headerlink href=#73-variable-pulse-size title="Permanent link">~</a></h3> <p><a href="https://tasmota.github.io/docs/Tasmota-Berry-emulator/index.html?example=chap_7_30_crenel_pulse_size" target=_blank><img src=../../_media/berry_animation/chap_7_30.png alt="Variable Size"></a></p> <p>Instead of a fixed <code>pulse_size</code>, you can use a value provider to animate the pulse width over time. Here, a <code>triangle</code> oscillator smoothly varies the pulse size between 0 and 4 pixels over 2 seconds, creating a breathing effect on the crenel pattern:</p> <div class=highlight><pre><span></span><code><span class=c1># Crenel with variable pulse size</span>

<span class=n>set</span><span class=w> </span><span class=n>pulse_size</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>triangle</span><span class=p>(</span><span class=n>min_value</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=n>max_value</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>4</span><span class=p>,</span><span class=w> </span><span class=n>duration</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>2</span><span class=err>s</span><span class=p>)</span>

<span class=n>animation</span><span class=w> </span><span class=n>back</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>crenel</span><span class=p>(</span>
<span class=w>    </span><span class=n>color</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>red</span>
<span class=w>    </span><span class=n>back_color</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>blue</span>
<span class=w>    </span><span class=n>pulse_size</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>pulse_size</span>
<span class=w>    </span><span class=n>low_size</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>2</span>
<span class=p>)</span>
<span class=n>run</span><span class=w> </span><span class=n>back</span>
</code></pre></div> <h3 id=74-dynamic-colors>7.4 Dynamic Colors<a class=headerlink href=#74-dynamic-colors title="Permanent link">~</a></h3> <p><a href="https://tasmota.github.io/docs/Tasmota-Berry-emulator/index.html?example=chap_7_40_crenel_color" target=_blank><img src=../../_media/berry_animation/chap_7_40.png alt="Dynamic Colors"></a></p> <p>The <code>color</code> parameter also accepts a color provider instead of a static color. This example uses <code>rich_palette_color</code> to cycle through rainbow colors over 5 seconds, making the crenel pulses continuously change color while the blue background remains fixed:</p> <div class=highlight><pre><span></span><code><span class=c1># Crenel with dynamic color</span>

<span class=n>color</span><span class=w> </span><span class=n>rainbow_color</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>rich_palette_color</span><span class=p>(</span><span class=n>colors</span><span class=o>=</span><span class=n>PALETTE_RAINBOW_W2</span><span class=p>,</span><span class=w> </span><span class=n>period</span><span class=o>=</span><span class=mi>5</span><span class=err>s</span><span class=p>)</span>

<span class=n>animation</span><span class=w> </span><span class=n>back</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>crenel</span><span class=p>(</span>
<span class=w>    </span><span class=n>color</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>rainbow_color</span>
<span class=w>    </span><span class=n>back_color</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>blue</span>
<span class=w>    </span><span class=n>pulse_size</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>2</span>
<span class=w>    </span><span class=n>low_size</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>2</span>
<span class=p>)</span>
<span class=n>run</span><span class=w> </span><span class=n>back</span>
</code></pre></div> <h3 id=75-crenel-as-opacity-mask>7.5 Crenel as Opacity Mask<a class=headerlink href=#75-crenel-as-opacity-mask title="Permanent link">~</a></h3> <p><a href="https://tasmota.github.io/docs/Tasmota-Berry-emulator/index.html?example=chap_7_50_crenel_opacity" target=_blank><img src=../../_media/berry_animation/chap_7_50.png alt="Crenel Mask"></a></p> <p>Instead of using a crenel directly as a visible animation, you can use it as an <strong>opacity mask</strong> for another animation. This creates a "window" effect where the crenel pattern controls what's visible.</p> <p><strong>How opacity masks work:</strong></p> <ol> <li>The mask animation renders to determine opacity values (0-255 per pixel)</li> <li>Where the mask is bright (white/high values), the main animation is fully visible</li> <li>Where the mask is dark or transparent, the main animation is hidden</li> <li>The mask's actual color doesn't matter - only its brightness/alpha is used</li> </ol> <p><strong>In this example:</strong></p> <ul> <li><code>back</code> is a solid blue background at priority 20</li> <li><code>mask</code> is a crenel pattern with white pulses and transparent gaps</li> <li><code>pattern</code> is a rotating rainbow gradient that uses the crenel as its <code>opacity</code> parameter</li> <li>The rainbow gradient is only visible where the crenel pulses are white - creating alternating "windows" of rainbow color on a blue background</li> </ul> <div class=highlight><pre><span></span><code><span class=c1># Crenel used as opacity mask</span>

<span class=c1># Blue background</span>
<span class=n>animation</span><span class=w> </span><span class=n>back</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>solid</span><span class=p>(</span><span class=n>color</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>blue</span><span class=p>,</span><span class=w> </span><span class=n>priority</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>20</span><span class=p>)</span>
<span class=n>run</span><span class=w> </span><span class=n>back</span>

<span class=c1># Crenel mask (white = visible, transparent = hidden)</span>
<span class=n>animation</span><span class=w> </span><span class=n>mask</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>crenel</span><span class=p>(</span>
<span class=w>    </span><span class=n>color</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>white</span>
<span class=w>    </span><span class=n>back_color</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>transparent</span>
<span class=w>    </span><span class=n>pulse_size</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>2</span>
<span class=w>    </span><span class=n>low_size</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>2</span>
<span class=p>)</span>

<span class=c1># Rainbow gradient masked by crenel</span>
<span class=n>color</span><span class=w> </span><span class=n>rainbow_rich_color</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>rich_palette_color</span><span class=p>(</span><span class=n>colors</span><span class=o>=</span><span class=n>PALETTE_RAINBOW_W</span><span class=p>,</span><span class=w> </span><span class=n>period</span><span class=o>=</span><span class=mi>0</span><span class=p>)</span>
<span class=n>animation</span><span class=w> </span><span class=n>pattern</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>palette_gradient</span><span class=p>(</span>
<span class=w>    </span><span class=n>color_source</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>rainbow_rich_color</span>
<span class=w>    </span><span class=n>shift_period</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>2</span><span class=err>s</span><span class=w>           </span><span class=c1># Rotating gradient</span>
<span class=w>    </span><span class=n>opacity</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>mask</span><span class=w>              </span><span class=c1># Apply crenel mask</span>
<span class=p>)</span>
<span class=n>run</span><span class=w> </span><span class=n>pattern</span>
</code></pre></div> <hr> <h2 id=chapter-8-templates-for-reusable-animations>Chapter 8: Templates for Reusable Animations<a class=headerlink href=#chapter-8-templates-for-reusable-animations title="Permanent link">~</a></h2> <p>As your animations grow more complex, you'll want to reuse patterns with different parameters. <strong>Templates</strong> solve this by letting you define animation "blueprints" with configurable parameters.</p> <p>Think of templates like functions in programming: define once, use many times with different inputs.</p> <h3 id=81-simple-template-cylon-eye>8.1 Simple Template: Cylon Eye<a class=headerlink href=#81-simple-template-cylon-eye title="Permanent link">~</a></h3> <p><a href="https://tasmota.github.io/docs/Tasmota-Berry-emulator/index.html?example=chap_8_10_template_cylon" target=_blank><img src=../../_media/berry_animation/chap_8_10.png alt="Template Cylon"></a></p> <p>The <code>template animation</code> keyword creates a new animation type that can be instantiated just like built-in animations (<code>solid</code>, <code>beacon</code>, etc.). Once defined, you use it by calling <code>animation my_anim = template_name(param1=value1, ...)</code> - exactly like native animations.</p> <p><strong>Defining parameters:</strong></p> <p>Each <code>param</code> declaration creates a configurable input for your template:</p> <div class=highlight><pre><span></span><code><span class=n>param</span><span class=w> </span><span class=n>parameter_name</span><span class=w> </span><span class=nb>type</span><span class=w> </span><span class=n>type_name</span><span class=w> </span><span class=n>default</span><span class=w> </span><span class=n>default_value</span>
</code></pre></div> <ul> <li><code>parameter_name</code>: The name you'll use inside the template and when instantiating</li> <li><code>type type_name</code>: Optional type constraint (see table below)</li> <li><code>default value</code>: Optional default value if not provided at instantiation</li> </ul> <p><strong>Available parameter types:</strong></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> <th>Example</th> </tr> </thead> <tbody> <tr> <td><code>color</code></td> <td>Color value (hex or named)</td> <td><code>param fg type color default red</code></td> </tr> <tr> <td><code>palette</code></td> <td>Palette definition (bytes)</td> <td><code>param colors type palette</code></td> </tr> <tr> <td><code>time</code></td> <td>Time value with unit (converted to ms)</td> <td><code>param period type time default 5s</code></td> </tr> <tr> <td><code>int</code></td> <td>Integer value</td> <td><code>param count type int default 10</code></td> </tr> <tr> <td><code>bool</code></td> <td>Boolean (true/false)</td> <td><code>param enabled type bool default true</code></td> </tr> <tr> <td><code>string</code></td> <td>String value</td> <td><code>param name type string default "anim"</code></td> </tr> <tr> <td><code>percentage</code></td> <td>Percentage (0-255)</td> <td><code>param brightness type percentage default 255</code></td> </tr> <tr> <td><code>number</code></td> <td>Generic numeric</td> <td><code>param value type number</code></td> </tr> <tr> <td><code>any</code></td> <td>Any type (no validation)</td> <td><code>param data type any</code></td> </tr> </tbody> </table> <p>Let's package the Cylon eye effect from Chapter 5 as a reusable template. Users can customize the color, speed, and priority without rewriting the animation logic:</p> <div class=highlight><pre><span></span><code><span class=c1># Template for Cylon-style scanning eye</span>

<span class=n>template</span><span class=w> </span><span class=n>animation</span><span class=w> </span><span class=n>cylon_eye</span><span class=w> </span><span class=p>{</span>
<span class=w>  </span><span class=n>param</span><span class=w> </span><span class=n>eye_color</span><span class=w> </span><span class=nb>type</span><span class=w> </span><span class=n>color</span><span class=w> </span><span class=n>default</span><span class=w> </span><span class=n>red</span>
<span class=w>  </span><span class=n>param</span><span class=w> </span><span class=n>back_color</span><span class=w> </span><span class=nb>type</span><span class=w> </span><span class=n>color</span><span class=w> </span><span class=n>default</span><span class=w> </span><span class=n>transparent</span>
<span class=w>  </span><span class=n>param</span><span class=w> </span><span class=n>period</span><span class=w> </span><span class=nb>type</span><span class=w> </span><span class=n>time</span><span class=w> </span><span class=n>default</span><span class=w> </span><span class=mi>5</span><span class=err>s</span>
<span class=w>  </span><span class=n>param</span><span class=w> </span><span class=n>priority</span><span class=w> </span><span class=n>default</span><span class=w> </span><span class=mi>5</span>

<span class=w>  </span><span class=n>set</span><span class=w> </span><span class=n>strip_len</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>strip_length</span><span class=p>()</span>

<span class=w>  </span><span class=n>animation</span><span class=w> </span><span class=n>eye_animation</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>beacon</span><span class=p>(</span>
<span class=w>    </span><span class=n>color</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>eye_color</span>
<span class=w>    </span><span class=n>back_color</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>back_color</span>
<span class=w>    </span><span class=n>pos</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>cosine_osc</span><span class=p>(</span><span class=n>min_value</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>-1</span><span class=p>,</span><span class=w> </span><span class=n>max_value</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>strip_len</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=mi>2</span><span class=p>,</span><span class=w> </span><span class=n>duration</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>period</span><span class=p>)</span>
<span class=w>    </span><span class=n>beacon_size</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>3</span>
<span class=w>    </span><span class=n>slew_size</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>2</span>
<span class=w>    </span><span class=n>priority</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>priority</span>
<span class=w>  </span><span class=p>)</span>

<span class=w>  </span><span class=n>run</span><span class=w> </span><span class=n>eye_animation</span>
<span class=p>}</span>

<span class=c1># Use the template with defaults</span>
<span class=n>animation</span><span class=w> </span><span class=n>eye</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>cylon_eye</span><span class=p>()</span>
<span class=n>run</span><span class=w> </span><span class=n>eye</span>
</code></pre></div> <h3 id=82-template-with-palette-parameter>8.2 Template with Palette Parameter<a class=headerlink href=#82-template-with-palette-parameter title="Permanent link">~</a></h3> <p><a href="https://tasmota.github.io/docs/Tasmota-Berry-emulator/index.html?example=chap_8_20_template_color_cycle" target=_blank><img src=../../_media/berry_animation/chap_8_20.png alt="Template Color Cycle"></a></p> <p>Templates can accept complex types like palettes. Here we create a reusable color cycling animation where the user provides their own palette and cycle period:</p> <div class=highlight><pre><span></span><code><span class=c1># Template for color cycling animation</span>

<span class=n>template</span><span class=w> </span><span class=n>animation</span><span class=w> </span><span class=n>color_cycle2</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=n>param</span><span class=w> </span><span class=n>colors</span><span class=w> </span><span class=nb>type</span><span class=w> </span><span class=n>palette</span>
<span class=w>    </span><span class=n>param</span><span class=w> </span><span class=n>period</span><span class=w> </span><span class=n>default</span><span class=w> </span><span class=mi>5</span><span class=err>s</span>

<span class=w>    </span><span class=n>color</span><span class=w> </span><span class=n>rainbow_color</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>color_cycle</span><span class=p>(</span><span class=n>colors</span><span class=o>=</span><span class=n>colors</span><span class=p>,</span><span class=w> </span><span class=n>period</span><span class=o>=</span><span class=n>period</span><span class=p>)</span>
<span class=w>    </span><span class=n>animation</span><span class=w> </span><span class=n>back</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>solid</span><span class=p>(</span><span class=n>color</span><span class=o>=</span><span class=n>rainbow_color</span><span class=p>)</span>
<span class=w>    </span><span class=n>run</span><span class=w> </span><span class=n>back</span>
<span class=p>}</span>

<span class=c1># Define a custom palette</span>
<span class=n>palette</span><span class=w> </span><span class=n>rgb</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>[</span>
<span class=w>  </span><span class=mh>0xFC0000</span><span class=w>        </span><span class=c1># Red</span>
<span class=w>  </span><span class=mh>0x00FF00</span><span class=w>        </span><span class=c1># Green</span>
<span class=w>  </span><span class=mh>0x0080FF</span><span class=w>        </span><span class=c1># Blue</span>
<span class=p>]</span>

<span class=c1># Use the template with custom parameters</span>
<span class=n>animation</span><span class=w> </span><span class=n>main</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>color_cycle2</span><span class=p>(</span><span class=n>colors</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>rgb</span><span class=p>,</span><span class=w> </span><span class=n>period</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>2</span><span class=err>s</span><span class=p>)</span>
<span class=n>run</span><span class=w> </span><span class=n>main</span>
</code></pre></div> <h3 id=83-advanced-template-with-conditional-flags>8.3 Advanced Template with Conditional Flags<a class=headerlink href=#83-advanced-template-with-conditional-flags title="Permanent link">~</a></h3> <p><a href="https://tasmota.github.io/docs/Tasmota-Berry-emulator/index.html?example=chap_8_30_template_shutter_bidir_flags" target=_blank><img src=../../_media/berry_animation/chap_8_30.png alt="Template Shutter"></a></p> <p>Templates support <code>bool</code> parameters that can be used with <code>if</code> statements inside sequences. This allows users to enable or disable parts of the animation at instantiation time. Here we create a bidirectional shutter (based on chapter 6.4) that can optionally run in-out, out-in, or both directions.</p> <p><strong>Dynamic parameter changes:</strong></p> <p>You can also modify template parameters at runtime using Berry code. Note that DSL variable names get an underscore suffix in Berry to avoid collisions with reserved words (e.g., <code>main</code> becomes <code>main_</code>). For example: <code>main_.inout = false</code> disables the in-out animation while it's running.</p> <div class=highlight><pre><span></span><code><span class=c1># Template to illustrate the parameters and flags</span>

<span class=c1># Define a template to package the shutter in-out-in from 6.40</span>
<span class=c1># with flags to enable or disable in-out or out-in</span>
<span class=n>template</span><span class=w> </span><span class=n>animation</span><span class=w> </span><span class=n>shutter_bidir</span><span class=w> </span><span class=p>{</span>
<span class=w>  </span><span class=n>param</span><span class=w> </span><span class=n>colors</span><span class=w> </span><span class=nb>type</span><span class=w> </span><span class=n>palette</span>
<span class=w>  </span><span class=n>param</span><span class=w> </span><span class=n>period</span><span class=w> </span><span class=n>default</span><span class=w> </span><span class=mi>2</span><span class=err>s</span>
<span class=w>  </span><span class=n>param</span><span class=w> </span><span class=n>inout</span><span class=w> </span><span class=nb>type</span><span class=w> </span><span class=nb>bool</span><span class=w> </span><span class=n>default</span><span class=w> </span><span class=kc>true</span><span class=w>    </span><span class=c1># define to true to enable &#39;inout&#39; part</span>
<span class=w>  </span><span class=n>param</span><span class=w> </span><span class=n>outin</span><span class=w> </span><span class=nb>type</span><span class=w> </span><span class=nb>bool</span><span class=w> </span><span class=n>default</span><span class=w> </span><span class=kc>true</span><span class=w>    </span><span class=c1># define to true to enable &#39;outin&#39; part</span>

<span class=w>  </span><span class=c1># since &#39;strip_length()&#39; is a value provider, it must be assigned to a variable before being used</span>
<span class=w>  </span><span class=n>set</span><span class=w> </span><span class=n>strip_len</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>strip_length</span><span class=p>()</span>
<span class=w>  </span><span class=n>set</span><span class=w> </span><span class=n>strip_len_2</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>strip_len</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mi>1</span><span class=p>)</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=mi>2</span><span class=w>       </span><span class=c1># half length rounded</span>

<span class=w>  </span><span class=c1># Define animated value for the size of the shutter, evolving linearly in time (sawtooth from 0% to 100%)</span>
<span class=w>  </span><span class=n>set</span><span class=w> </span><span class=n>shutter_size</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>sawtooth</span><span class=p>(</span><span class=n>min_value</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=n>max_value</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>strip_len</span><span class=p>,</span><span class=w> </span><span class=n>duration</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>period</span><span class=p>)</span>

<span class=w>  </span><span class=c1># Define two rotating palettes, shifted by one color</span>
<span class=w>  </span><span class=n>color</span><span class=w> </span><span class=n>col1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>color_cycle</span><span class=p>(</span><span class=n>colors</span><span class=o>=</span><span class=n>colors</span><span class=p>,</span><span class=w> </span><span class=n>period</span><span class=o>=</span><span class=mi>0</span><span class=p>)</span>
<span class=w>  </span><span class=n>color</span><span class=w> </span><span class=n>col2</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>color_cycle</span><span class=p>(</span><span class=n>colors</span><span class=o>=</span><span class=n>colors</span><span class=p>,</span><span class=w> </span><span class=n>period</span><span class=o>=</span><span class=mi>0</span><span class=p>)</span>
<span class=w>  </span><span class=n>col2</span><span class=p>.</span><span class=na>next</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w>     </span><span class=c1># move &#39;col2&#39; to the next color so it&#39;s shifte by one compared to &#39;col1&#39;</span>

<span class=w>  </span><span class=c1># Shutter moving in in-out</span>
<span class=w>  </span><span class=n>animation</span><span class=w> </span><span class=n>shutter_inout_animation</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>beacon</span><span class=p>(</span>
<span class=w>    </span><span class=n>color</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>col2</span><span class=w>                    </span><span class=c1># Use two rotating colors</span>
<span class=w>    </span><span class=n>back_color</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>col1</span><span class=w>               </span><span class=c1># Use two rotating colors</span>
<span class=w>    </span><span class=n>pos</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>strip_len_2</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=p>(</span><span class=n>shutter_size</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mi>1</span><span class=p>)</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=mi>2</span>
<span class=w>    </span><span class=n>beacon_size</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>shutter_size</span>
<span class=w>  </span><span class=p>)</span>

<span class=w>  </span><span class=c1># shutter moving in out-in</span>
<span class=w>  </span><span class=n>animation</span><span class=w> </span><span class=n>shutter_outin_animation</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>beacon</span><span class=p>(</span>
<span class=w>    </span><span class=n>color</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>col1</span>
<span class=w>    </span><span class=n>back_color</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>col2</span>
<span class=w>    </span><span class=n>pos</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>strip_len_2</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=p>(</span><span class=n>strip_len</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>shutter_size</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mi>1</span><span class=p>)</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=mi>2</span>
<span class=w>    </span><span class=n>beacon_size</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>strip_len</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>shutter_size</span>
<span class=w>  </span><span class=p>)</span>

<span class=w>  </span><span class=c1># this is the overall sequence composed of two sub-sequences</span>
<span class=w>  </span><span class=c1># the first in ascending mode, the second in descending</span>
<span class=w>  </span><span class=n>sequence</span><span class=w> </span><span class=n>shutter_seq</span><span class=w> </span><span class=n>repeat</span><span class=w> </span><span class=n>forever</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=n>inout</span><span class=w> </span><span class=p>{</span><span class=w>                              </span><span class=c1># un only if &#39;ascending&#39; is true</span>
<span class=w>      </span><span class=n>repeat</span><span class=w> </span><span class=n>col1</span><span class=p>.</span><span class=na>palette_size</span><span class=w> </span><span class=n>times</span><span class=w> </span><span class=p>{</span><span class=w>          </span><span class=c1># run the shutter animation</span>
<span class=w>        </span><span class=n>restart</span><span class=w> </span><span class=n>shutter_size</span><span class=w>                    </span><span class=c1># resync all times for this animation, to avoid temporal drift</span>
<span class=w>        </span><span class=n>play</span><span class=w> </span><span class=n>shutter_inout_animation</span><span class=w> </span><span class=k>for</span><span class=w> </span><span class=n>period</span><span class=w>    </span><span class=c1># run the animation</span>
<span class=w>        </span><span class=n>col1</span><span class=p>.</span><span class=na>next</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w>                           </span><span class=c1># then move to next color for both palettes</span>
<span class=w>        </span><span class=n>col2</span><span class=p>.</span><span class=na>next</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span>
<span class=w>      </span><span class=p>}</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=n>outin</span><span class=w> </span><span class=p>{</span><span class=w>                             </span><span class=c1># run only if &#39;descending&#39; is true</span>
<span class=w>      </span><span class=n>repeat</span><span class=w> </span><span class=n>col1</span><span class=p>.</span><span class=na>palette_size</span><span class=w> </span><span class=n>times</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=n>restart</span><span class=w> </span><span class=n>shutter_size</span>
<span class=w>        </span><span class=n>play</span><span class=w> </span><span class=n>shutter_outin_animation</span><span class=w> </span><span class=k>for</span><span class=w> </span><span class=n>period</span>
<span class=w>        </span><span class=n>col1</span><span class=p>.</span><span class=na>next</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span>
<span class=w>        </span><span class=n>col2</span><span class=p>.</span><span class=na>next</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span>
<span class=w>      </span><span class=p>}</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>  </span><span class=p>}</span>
<span class=w>  </span><span class=n>run</span><span class=w> </span><span class=n>shutter_seq</span>
<span class=p>}</span>

<span class=c1># define a palette of rainbow colors including white with constant brightness</span>
<span class=n>palette</span><span class=w> </span><span class=n>rainbow_with_white</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>[</span>
<span class=w>  </span><span class=mh>0xFC0000</span><span class=w>        </span><span class=c1># Red</span>
<span class=w>  </span><span class=mh>0xFF8000</span><span class=w>        </span><span class=c1># Orange</span>
<span class=w>  </span><span class=mh>0xFFFF00</span><span class=w>        </span><span class=c1># Yellow</span>
<span class=w>  </span><span class=mh>0x00FF00</span><span class=w>        </span><span class=c1># Green</span>
<span class=w>  </span><span class=mh>0x00FFFF</span><span class=w>        </span><span class=c1># Cyan</span>
<span class=w>  </span><span class=mh>0x0080FF</span><span class=w>        </span><span class=c1># Blue</span>
<span class=w>  </span><span class=mh>0x8000FF</span><span class=w>        </span><span class=c1># Violet</span>
<span class=w>  </span><span class=mh>0xCCCCCC</span><span class=w>        </span><span class=c1># White</span>
<span class=p>]</span>

<span class=n>animation</span><span class=w> </span><span class=n>main</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>shutter_bidir</span><span class=p>(</span><span class=n>colors</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>rainbow_with_white</span><span class=p>,</span><span class=w> </span><span class=n>period</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=mf>.5</span><span class=err>s</span><span class=p>)</span>
<span class=n>run</span><span class=w> </span><span class=n>main</span>
</code></pre></div> <h2 id=quick-reference-card>Quick Reference Card<a class=headerlink href=#quick-reference-card title="Permanent link">~</a></h2> <h3 id=animation-types>Animation Types<a class=headerlink href=#animation-types title="Permanent link">~</a></h3> <table> <thead> <tr> <th>Animation</th> <th>Description</th> <th>Key Parameters</th> </tr> </thead> <tbody> <tr> <td><code>solid</code></td> <td>Solid color fill</td> <td><code>color</code></td> </tr> <tr> <td><code>twinkle</code></td> <td>Twinkling stars effect</td> <td><code>color</code>, <code>density</code>, <code>twinkle_speed</code>, <code>fade_speed</code></td> </tr> <tr> <td><code>beacon</code></td> <td>Positioned pulse/highlight</td> <td><code>color</code>, <code>pos</code>, <code>beacon_size</code>, <code>slew_size</code></td> </tr> <tr> <td><code>crenel</code></td> <td>Square wave pattern</td> <td><code>color</code>, <code>back_color</code>, <code>pulse_size</code>, <code>low_size</code></td> </tr> <tr> <td><code>rich_palette</code></td> <td>Smooth palette cycling</td> <td><code>colors</code>, <code>period</code>, <code>transition_type</code></td> </tr> <tr> <td><code>palette_gradient</code></td> <td>Gradient across strip</td> <td><code>color_source</code>, <code>spatial_period</code>, <code>shift_period</code></td> </tr> <tr> <td><code>palette_meter</code></td> <td>VU-meter style bar</td> <td><code>color_source</code>, <code>level</code></td> </tr> <tr> <td><code>breathe</code></td> <td>Breathing/pulsing effect</td> <td><code>color</code>, <code>period</code></td> </tr> <tr> <td><code>comet</code></td> <td>Moving comet with tail</td> <td><code>color</code>, <code>tail_length</code>, <code>speed</code></td> </tr> </tbody> </table> <h3 id=colors>Colors<a class=headerlink href=#colors title="Permanent link">~</a></h3> <div class=highlight><pre><span></span><code><span class=c1># Predefined</span>
<span class=n>red</span><span class=p>,</span><span class=w> </span><span class=n>green</span><span class=p>,</span><span class=w> </span><span class=n>blue</span><span class=p>,</span><span class=w> </span><span class=n>white</span><span class=p>,</span><span class=w> </span><span class=n>yellow</span><span class=p>,</span><span class=w> </span><span class=n>orange</span><span class=p>,</span><span class=w> </span><span class=n>purple</span><span class=p>,</span><span class=w> </span><span class=n>cyan</span><span class=p>,</span><span class=w> </span><span class=n>transparent</span>

<span class=c1># Custom hex</span>
<span class=n>color</span><span class=w> </span><span class=n>my_color</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=err>xRRGGBB</span>
</code></pre></div> <h3 id=palettes>Palettes<a class=headerlink href=#palettes title="Permanent link">~</a></h3> <div class=highlight><pre><span></span><code><span class=c1># Built-in</span>
<span class=n>PALETTE_RAINBOW</span><span class=p>,</span><span class=w> </span><span class=n>PALETTE_RAINBOW_W</span><span class=p>,</span><span class=w> </span><span class=n>PALETTE_FIRE</span>

<span class=c1># Custom</span>
<span class=n>palette</span><span class=w> </span><span class=n>my_palette</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>[</span><span class=w> </span><span class=mh>0xFF0000</span><span class=p>,</span><span class=w> </span><span class=mh>0x00FF00</span><span class=p>,</span><span class=w> </span><span class=mh>0x0000FF</span><span class=w> </span><span class=p>]</span>

<span class=c1># Position-based</span>
<span class=n>palette</span><span class=w> </span><span class=n>gradient</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>[</span><span class=w> </span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=n>red</span><span class=p>),</span><span class=w> </span><span class=p>(</span><span class=mi>128</span><span class=p>,</span><span class=w> </span><span class=n>yellow</span><span class=p>),</span><span class=w> </span><span class=p>(</span><span class=mi>255</span><span class=p>,</span><span class=w> </span><span class=n>green</span><span class=p>)</span><span class=w> </span><span class=p>]</span>
</code></pre></div> <h3 id=value-providers>Value Providers<a class=headerlink href=#value-providers title="Permanent link">~</a></h3> <div class=highlight><pre><span></span><code><span class=nf>sine_osc</span><span class=p>(</span><span class=n>min_value</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=n>max_value</span><span class=o>=</span><span class=mi>255</span><span class=p>,</span><span class=w> </span><span class=n>duration</span><span class=o>=</span><span class=mi>2</span><span class=err>s</span><span class=p>)</span>
<span class=nf>cosine_osc</span><span class=p>(</span><span class=n>min_value</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=n>max_value</span><span class=o>=</span><span class=mi>255</span><span class=p>,</span><span class=w> </span><span class=n>duration</span><span class=o>=</span><span class=mi>2</span><span class=err>s</span><span class=p>)</span>
<span class=nf>triangle</span><span class=p>(</span><span class=n>min_value</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=n>max_value</span><span class=o>=</span><span class=mi>255</span><span class=p>,</span><span class=w> </span><span class=n>duration</span><span class=o>=</span><span class=mi>2</span><span class=err>s</span><span class=p>)</span>
<span class=nf>sawtooth</span><span class=p>(</span><span class=n>min_value</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=n>max_value</span><span class=o>=</span><span class=mi>255</span><span class=p>,</span><span class=w> </span><span class=n>duration</span><span class=o>=</span><span class=mi>2</span><span class=err>s</span><span class=p>)</span>
<span class=nf>smooth</span><span class=p>(</span><span class=n>min_value</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=n>max_value</span><span class=o>=</span><span class=mi>255</span><span class=p>,</span><span class=w> </span><span class=n>duration</span><span class=o>=</span><span class=mi>2</span><span class=err>s</span><span class=p>)</span>
<span class=nf>square</span><span class=p>(</span><span class=n>min_value</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=n>max_value</span><span class=o>=</span><span class=mi>255</span><span class=p>,</span><span class=w> </span><span class=n>duration</span><span class=o>=</span><span class=mi>2</span><span class=err>s</span><span class=p>)</span>
<span class=nf>strip_length</span><span class=p>()</span>
</code></pre></div> <h3 id=time-units>Time Units<a class=headerlink href=#time-units title="Permanent link">~</a></h3> <div class=highlight><pre><span></span><code><span class=mi>500</span><span class=err>ms</span><span class=w>    </span><span class=c1># milliseconds</span>
<span class=mi>2</span><span class=err>s</span><span class=w>       </span><span class=c1># seconds</span>
<span class=mi>1</span><span class=err>m</span><span class=w>       </span><span class=c1># minutes</span>
</code></pre></div> <h3 id=percentages>Percentages<a class=headerlink href=#percentages title="Permanent link">~</a></h3> <div class=highlight><pre><span></span><code><span class=mi>0</span><span class=o>%</span><span class=w>       </span><span class=c1># 0</span>
<span class=mi>50</span><span class=o>%</span><span class=w>      </span><span class=c1># 128</span>
<span class=mi>100</span><span class=o>%</span><span class=w>     </span><span class=c1># 255</span>
</code></pre></div> <h3 id=sequence-statements>Sequence Statements<a class=headerlink href=#sequence-statements title="Permanent link">~</a></h3> <div class=highlight><pre><span></span><code><span class=n>play</span><span class=w> </span><span class=n>animation</span><span class=w> </span><span class=k>for</span><span class=w> </span><span class=mi>5</span><span class=err>s</span>
<span class=n>wait</span><span class=w> </span><span class=mi>1</span><span class=err>s</span>
<span class=n>restart</span><span class=w> </span><span class=n>value_provider</span>
<span class=n>repeat</span><span class=w> </span><span class=mi>3</span><span class=w> </span><span class=n>times</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=o>..</span><span class=p>.</span><span class=w> </span><span class=p>}</span>
<span class=n>repeat</span><span class=w> </span><span class=n>forever</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=o>..</span><span class=p>.</span><span class=w> </span><span class=p>}</span>
<span class=k>if</span><span class=w> </span><span class=n>condition</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=o>..</span><span class=p>.</span><span class=w> </span><span class=p>}</span>
</code></pre></div> <h3 id=template-definition>Template Definition<a class=headerlink href=#template-definition title="Permanent link">~</a></h3> <div class=highlight><pre><span></span><code><span class=n>template</span><span class=w> </span><span class=n>animation</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=p>{</span>
<span class=w>  </span><span class=n>param</span><span class=w> </span><span class=n>param_name</span><span class=w> </span><span class=nb>type</span><span class=w> </span><span class=n>type_name</span><span class=w> </span><span class=n>default</span><span class=w> </span><span class=n>value</span>
<span class=w>  </span><span class=c1># ... body ...</span>
<span class=p>}</span>
</code></pre></div> <h3 id=resources>Resources<a class=headerlink href=#resources title="Permanent link">~</a></h3> <ul> <li><strong><a href=../Dsl_Reference/ >DSL Reference</a></strong> - Complete syntax documentation</li> <li><strong><a href=../Animation_Class_Hierarchy/ >Animation Classes</a></strong> - All available animations</li> <li><strong><a href=../Oscillation_Patterns/ >Oscillation Patterns</a></strong> - Value provider waveforms</li> <li><strong><a href=../Examples/ >Examples</a></strong> - More animation examples</li> <li><strong><a href=https://tasmota.github.io/docs/Tasmota-Berry-emulator/index.html>Online Emulator</a></strong> - Test animations in your browser</li> </ul> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://discord.gg/Ks2Kzd4 target=_blank rel=noopener title=discord.gg class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 576 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M492.5 69.8c-.2-.3-.4-.6-.8-.7-38.1-17.5-78.4-30-119.7-37.1-.4-.1-.8 0-1.1.1s-.6.4-.8.8c-5.5 9.9-10.5 20.2-14.9 30.6-44.6-6.8-89.9-6.8-134.4 0-4.5-10.5-9.5-20.7-15.1-30.6-.2-.3-.5-.6-.8-.8s-.7-.2-1.1-.2C162.5 39 122.2 51.5 84.1 69c-.3.1-.6.4-.8.7C7.1 183.5-13.8 294.6-3.6 404.2c0 .3.1.5.2.8s.3.4.5.6c44.4 32.9 94 58 146.8 74.2.4.1.8.1 1.1 0s.7-.4.9-.7c11.3-15.4 21.4-31.8 30-48.8.1-.2.2-.5.2-.8s0-.5-.1-.8-.2-.5-.4-.6-.4-.3-.7-.4c-15.8-6.1-31.2-13.4-45.9-21.9-.3-.2-.5-.4-.7-.6s-.3-.6-.3-.9 0-.6.2-.9.3-.5.6-.7c3.1-2.3 6.2-4.7 9.1-7.1.3-.2.6-.4.9-.4s.7 0 1 .1c96.2 43.9 200.4 43.9 295.5 0 .3-.1.7-.2 1-.2s.7.2.9.4c2.9 2.4 6 4.9 9.1 7.2.2.2.4.4.6.7s.2.6.2.9-.1.6-.3.9-.4.5-.6.6c-14.7 8.6-30 15.9-45.9 21.8-.2.1-.5.2-.7.4s-.3.4-.4.7-.1.5-.1.8.1.5.2.8c8.8 17 18.8 33.3 30 48.8.2.3.6.6.9.7s.8.1 1.1 0c52.9-16.2 102.6-41.3 147.1-74.2.2-.2.4-.4.5-.6s.2-.5.2-.8c12.3-126.8-20.5-236.9-86.9-334.5zm-302 267.7c-29 0-52.8-26.6-52.8-59.2s23.4-59.2 52.8-59.2c29.7 0 53.3 26.8 52.8 59.2 0 32.7-23.4 59.2-52.8 59.2m195.4 0c-29 0-52.8-26.6-52.8-59.2s23.4-59.2 52.8-59.2c29.7 0 53.3 26.8 52.8 59.2 0 32.7-23.2 59.2-52.8 59.2"/></svg> </a> <a href=https://t.me/tasmota target=_blank rel=noopener title=t.me class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M256 8a248 248 0 1 0 0 496 248 248 0 1 0 0-496m115 168.7c-3.7 39.2-19.9 134.4-28.1 178.3-3.5 18.6-10.3 24.8-16.9 25.4-14.4 1.3-25.3-9.5-39.3-18.7-21.8-14.3-34.2-23.2-55.3-37.2-24.5-16.1-8.6-25 5.3-39.5 3.7-3.8 67.1-61.5 68.3-66.7.2-.7.3-3.1-1.2-4.4s-3.6-.8-5.1-.5c-2.2.5-37.1 23.5-104.6 69.1-9.9 6.8-18.9 10.1-26.9 9.9-8.9-.2-25.9-5-38.6-9.1-15.5-5-27.9-7.7-26.8-16.3.6-4.5 6.7-9 18.4-13.7 72.3-31.5 120.5-52.3 144.6-62.3 68.9-28.6 83.2-33.6 92.5-33.8 2.1 0 6.6.5 9.6 2.9 2 1.7 3.2 4.1 3.5 6.7.5 3.2.6 6.5.4 9.8z"/></svg> </a> <a href=https://github.com/tasmota target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M202.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1M496 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2m-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3m-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"annotate": null, "base": "../..", "features": ["navigation.instant", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "navigation.tracking", "content.action.edit", "content.code.copy"], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script> <script src=../../assets/javascripts/bundle.79ae519e.min.js></script> <script src=https://unpkg.com/tablesort@5.3.0/dist/tablesort.min.js></script> <script src=../../extra_javascript/tablesort.js></script> </body> </html>