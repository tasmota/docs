<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" href=../_media/favicon.ico><meta name=generator content="mkdocs-1.1, mkdocs-material-5.0.0rc4"><title>DeepSleep - Tasmota</title><link rel=stylesheet href=../assets/stylesheets/main.c1451e9e.min.css><link rel=stylesheet href=../assets/stylesheets/palette.4444686e.min.css><meta name=theme-color content=#2196f3><link href=https://fonts.gstatic.com rel=preconnect crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Barlow:300,400,400i,700%7CRoboto+Mono&display=fallback"><style>body,input{font-family:"Barlow",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style><link rel="preconnect dns-prefetch" href=https://www.google-analytics.com><script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-140681905-2","auto"),ga("set","anonymizeIp",!0),ga("send","pageview"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})}),document.addEventListener("DOMContentSwitch",function(){ga("send","pageview")})</script><script async src=https://www.google-analytics.com/analytics.js></script></head> <body dir=ltr data-md-color-primary=blue data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#temporarily-disable-deep-sleep-mode class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header-nav md-grid" aria-label=Header> <a href=.. title=Tasmota class="md-header-nav__button md-logo" aria-label=Tasmota> <img src=../_media/logo.svg alt=logo> </a> <label class="md-header-nav__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M3,6H21V8H3V6M3,11H21V13H3V11M3,16H21V18H3V16Z /></svg> </label> <div class=md-header-nav__title data-md-component=header-title> <div class=md-header-nav__ellipsis> <span class="md-header-nav__topic md-ellipsis"> Tasmota </span> <span class="md-header-nav__topic md-ellipsis"> DeepSleep </span> </div> </div> <label class="md-header-nav__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query data-md-state=active> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z /></svg> </label> <button type=reset class="md-search__icon md-icon" aria-label=Clear data-md-component=search-reset tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z /></svg> </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Type to start searching </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header-nav__source> <a href=https://github.com/arendst/tasmota/ title="Go to repository" class=md-source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> arendst/tasmota </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class="md-tabs md-tabs--active" aria-label=Tabs data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../Scripting-Language/ class="md-tabs__link md-tabs__link--active"> Features </a> </li> <li class=md-tabs__item> <a href=../Alexa/ class=md-tabs__link> Smart Home Integrations </a> </li> <li class=md-tabs__item> <a href=../Displays/ class=md-tabs__link> Peripherals </a> </li> <li class=md-tabs__item> <a href=../Configuration-Procedure-for-New-Devices/ class=md-tabs__link> Supported Devices </a> </li> <li class=md-tabs__item> <a href=../FAQ/ class=md-tabs__link> Help </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=.. title=Tasmota class="md-nav__button md-logo" aria-label=Tasmota> <img src=../_media/logo.svg alt=logo> </a> Tasmota </label> <div class=md-nav__source> <a href=https://github.com/arendst/tasmota/ title="Go to repository" class=md-source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> arendst/tasmota </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=.. title=Home class=md-nav__link> Home </a> </li> <li class=md-nav__item> <a href=../About/ title=About class=md-nav__link> About </a> </li> <li class=md-nav__item> <a href=../Getting-Started/ title="Getting Started" class=md-nav__link> Getting Started </a> </li> <li class=md-nav__item> <a href=../Upgrading/ title=Upgrading class=md-nav__link> Upgrading </a> </li> <li class=md-nav__item> <a href=../MQTT/ title=MQTT class=md-nav__link> MQTT </a> </li> <li class=md-nav__item> <a href=../Commands/ title=Commands class=md-nav__link> Commands </a> </li> <li class=md-nav__item> <a href=../Templates/ title=Templates class=md-nav__link> Templates </a> </li> <li class=md-nav__item> <a href=../Components/ title=Components class=md-nav__link> Components </a> </li> <li class=md-nav__item> <a href=../Modules/ title=Modules class=md-nav__link> Modules </a> </li> <li class=md-nav__item> <a href=../Rules/ title=Rules class=md-nav__link> Rules </a> </li> <li class=md-nav__item> <a href=../Timers/ title=Timers class=md-nav__link> Timers </a> </li> <li class=md-nav__item> <a href=../Lights/ title=Lights class=md-nav__link> Lights </a> </li> <li class=md-nav__item> <a href=../Buttons-and-Switches/ title="Buttons and Switches" class=md-nav__link> Buttons and Switches </a> </li> <li class=md-nav__item> <a href=../Supported-Peripherals/ title=Peripherals class=md-nav__link> Peripherals </a> </li> <li class=md-nav__item> <a href=../TuyaMCU/ title=TuyaMCU class=md-nav__link> TuyaMCU </a> </li> <li class=md-nav__item> <a href=../Device-groups.md title=None class=md-nav__link> None </a> </li> <li class=md-nav__item> <a href=../Blinds-and-Shutters/ title="Blinds and Shutters" class=md-nav__link> Blinds and Shutters </a> </li> <li class=md-nav__item> <a href=../Shutter-and-Steppers/ title="Shutter and Steppers" class=md-nav__link> Shutter and Steppers </a> </li> <li class=md-nav__item> <a href=../Tasmota-IR/ title="IR Communication" class=md-nav__link> IR Communication </a> </li> <li class=md-nav__item> <a href=../WebUI/ title=WebUI class=md-nav__link> WebUI </a> </li> <li class=md-nav__item> <a href=../Compile-your-build/ title=Compiling class=md-nav__link> Compiling </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-22 type=checkbox id=nav-22 checked> <label class=md-nav__link for=nav-22> Features <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z /></svg> </span> </label> <nav class=md-nav aria-label=Features data-md-level=1> <label class=md-nav__title for=nav-22> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z /></svg> </span> Features </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Scripting-Language/ title=Scripting class=md-nav__link> Scripting </a> </li> <li class=md-nav__item> <a href=../Bluetooth/ title=Bluetooth class=md-nav__link> Bluetooth </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-22-3 type=checkbox id=nav-22-3> <label class=md-nav__link for=nav-22-3> Zigbee <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z /></svg> </span> </label> <nav class=md-nav aria-label=Zigbee data-md-level=2> <label class=md-nav__title for=nav-22-3> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z /></svg> </span> Zigbee </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Zigbee/ title=Zigbee class=md-nav__link> Zigbee </a> </li> <li class=md-nav__item> <a href=../Zigbee-Internals/ title="Zigbee internals" class=md-nav__link> Zigbee internals </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../TasmotaSlave/ title=TasmotaSlave class=md-nav__link> TasmotaSlave </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> DeepSleep <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M3,9H17V7H3V9M3,13H17V11H3V13M3,17H17V15H3V17M19,17H21V15H19V17M19,7V9H21V7H19M19,13H21V11H19V13Z /></svg> </span> </label> <a href=./ title=DeepSleep class="md-nav__link md-nav__link--active"> DeepSleep </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z /></svg> </span> Table of contents </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#temporarily-disable-deep-sleep-mode class=md-nav__link> Temporarily disable deep sleep mode </a> </li> <li class=md-nav__item> <a href=#executing-commands-before-entering-deepsleep class=md-nav__link> Executing commands before entering DeepSleep </a> </li> <li class=md-nav__item> <a href=#overcome-any-network-issue class=md-nav__link> Overcome any Network issue </a> </li> <li class=md-nav__item> <a href=#deep-sleep-algorithm-general-timing class=md-nav__link> Deep Sleep Algorithm General Timing </a> </li> <li class=md-nav__item> <a href=#wemos-d1-deep-sleep-side-effects class=md-nav__link> WEMOS D1 Deep Sleep Side-effects </a> </li> <li class=md-nav__item> <a href=#log-output-explanation class=md-nav__link> Log Output Explanation </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../PWM-dimmer-switch/ title="PWM Dimmer" class=md-nav__link> PWM Dimmer </a> </li> <li class=md-nav__item> <a href=../Buzzer/ title=Buzzer class=md-nav__link> Buzzer </a> </li> <li class=md-nav__item> <a href=../Dynamic-Sleep/ title="Dynamic Sleep" class=md-nav__link> Dynamic Sleep </a> </li> <li class=md-nav__item> <a href=../GPS-NTP-server/ title="GPS NTP server" class=md-nav__link> GPS NTP server </a> </li> <li class=md-nav__item> <a href=../I2CDevices/ title="I2C Devices" class=md-nav__link> I2C Devices </a> </li> <li class=md-nav__item> <a href=../Smart-Meter-Interface/ title="Smart Meter Interface" class=md-nav__link> Smart Meter Interface </a> </li> <li class=md-nav__item> <a href=../PIR-Motion-Sensors/ title="PIR Motion Sensors" class=md-nav__link> PIR Motion Sensors </a> </li> <li class=md-nav__item> <a href=../Power-Monitoring-Calibration/ title="Power Monitoring Calibration" class=md-nav__link> Power Monitoring Calibration </a> </li> <li class=md-nav__item> <a href=../Subscribe-%26-Unsubscribe/ title="Subscribe & Unsubscribe" class=md-nav__link> Subscribe & Unsubscribe </a> </li> <li class=md-nav__item> <a href=../TLS/ title="SSL/TLS on Tasmota" class=md-nav__link> SSL/TLS on Tasmota </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-23 type=checkbox id=nav-23> <label class=md-nav__link for=nav-23> Smart Home Integrations <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z /></svg> </span> </label> <nav class=md-nav aria-label="Smart Home Integrations" data-md-level=1> <label class=md-nav__title for=nav-23> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z /></svg> </span> Smart Home Integrations </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Alexa/ title=Alexa class=md-nav__link> Alexa </a> </li> <li class=md-nav__item> <a href=../AWS-IoT/ title="AWS IoT" class=md-nav__link> AWS IoT </a> </li> <li class=md-nav__item> <a href=../Domoticz/ title=Domoticz class=md-nav__link> Domoticz </a> </li> <li class=md-nav__item> <a href=../Home-Assistant/ title="Home Assistant" class=md-nav__link> Home Assistant </a> </li> <li class=md-nav__item> <a href=../Homebridge/ title=Homebridge class=md-nav__link> Homebridge </a> </li> <li class=md-nav__item> <a href=../HomeSeer/ title=HomeSeer class=md-nav__link> HomeSeer </a> </li> <li class=md-nav__item> <a href=../IP-Symcon/ title="IP Symcon" class=md-nav__link> IP Symcon </a> </li> <li class=md-nav__item> <a href=../KNX/ title=KNX class=md-nav__link> KNX </a> </li> <li class=md-nav__item> <a href=../NodeRed/ title=NodeRed class=md-nav__link> NodeRed </a> </li> <li class=md-nav__item> <a href=../nymea/ title=nymea class=md-nav__link> nymea </a> </li> <li class=md-nav__item> <a href=../OctoPrint.md title=None class=md-nav__link> None </a> </li> <li class=md-nav__item> <a href=../openHAB/ title=openHAB class=md-nav__link> openHAB </a> </li> <li class=md-nav__item> <a href=../otto/ title=Otto class=md-nav__link> Otto </a> </li> <li class=md-nav__item> <a href=https://github.com/arendst/Tasmota/issues/3769 title=IOBroker class=md-nav__link> IOBroker </a> </li> <li class=md-nav__item> <a href=https://github.com/tim-hellhake/tasmota-adapter title="Mozilla WebThings Adapter" class=md-nav__link> Mozilla WebThings Adapter </a> </li> <li class=md-nav__item> <a href=https://github.com/BrettSheleski/SmartThingsPublic/blob/master/devicetypes/brettsheleski/sonoff-tasmota.src/readme.md title=SmartThings class=md-nav__link> SmartThings </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-24 type=checkbox id=nav-24> <label class=md-nav__link for=nav-24> Peripherals <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z /></svg> </span> </label> <nav class=md-nav aria-label=Peripherals data-md-level=1> <label class=md-nav__title for=nav-24> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z /></svg> </span> Peripherals </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-24-1 type=checkbox id=nav-24-1> <label class=md-nav__link for=nav-24-1> Displays <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z /></svg> </span> </label> <nav class=md-nav aria-label=Displays data-md-level=2> <label class=md-nav__title for=nav-24-1> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z /></svg> </span> Displays </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Displays/ title=Displays class=md-nav__link> Displays </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../A4988-Stepper-Motor-Controller/ title="A4988 stepper motor controller" class=md-nav__link> A4988 stepper motor controller </a> </li> <li class=md-nav__item> <a href=../AM2301/ title="AM2301 temperature and humidity sensor" class=md-nav__link> AM2301 temperature and humidity sensor </a> </li> <li class=md-nav__item> <a href=../APDS-9960/ title="APDS 9960" class=md-nav__link> APDS 9960 </a> </li> <li class=md-nav__item> <a href=../AZ-7798/ title="AZ 7798" class=md-nav__link> AZ 7798 </a> </li> <li class=md-nav__item> <a href=../BH1750/ title=BH1750 class=md-nav__link> BH1750 </a> </li> <li class=md-nav__item> <a href=../BME280/ title=None class=md-nav__link> None </a> </li> <li class=md-nav__item> <a href=../BME680/ title=BME680 class=md-nav__link> BME680 </a> </li> <li class=md-nav__item> <a href=../BME280/ title="BMP280 pressure sensor" class=md-nav__link> BMP280 pressure sensor </a> </li> <li class=md-nav__item> <a href=../CC2530/ title=CC2530 class=md-nav__link> CC2530 </a> </li> <li class=md-nav__item> <a href=../Moisture-Sensor-and-Chirp%21-Sensor/ title="Chirp! moisture sensor" class=md-nav__link> Chirp! moisture sensor </a> </li> <li class=md-nav__item> <a href=../DHT11/ title=DHT11 class=md-nav__link> DHT11 </a> </li> <li class=md-nav__item> <a href=../DS18x20/ title=DS18x20 class=md-nav__link> DS18x20 </a> </li> <li class=md-nav__item> <a href=../DS3231/ title=DS3231 class=md-nav__link> DS3231 </a> </li> <li class=md-nav__item> <a href=../HM-10/ title="HM 10" class=md-nav__link> HM 10 </a> </li> <li class=md-nav__item> <a href=../HM-17/ title="HM 17" class=md-nav__link> HM 17 </a> </li> <li class=md-nav__item> <a href=../HC-SR04/ title="HC SR04" class=md-nav__link> HC SR04 </a> </li> <li class=md-nav__item> <a href=../Honeywell-HIH/ title="Honeywell HIH" class=md-nav__link> Honeywell HIH </a> </li> <li class=md-nav__item> <a href=../IR-Remote/ title="IR Remote" class=md-nav__link> IR Remote </a> </li> <li class=md-nav__item> <a href=../LM75AD/ title=LM75AD class=md-nav__link> LM75AD </a> </li> <li class=md-nav__item> <a href=../MCP230xx/ title=MCP230xx class=md-nav__link> MCP230xx </a> </li> <li class=md-nav__item> <a href=../MGC3130/ title=MGC3130 class=md-nav__link> MGC3130 </a> </li> <li class=md-nav__item> <a href=../MH-Z19B/ title="MH Z19B" class=md-nav__link> MH Z19B </a> </li> <li class=md-nav__item> <a href=../MLX90614/ title=MLX90614 class=md-nav__link> MLX90614 </a> </li> <li class=md-nav__item> <a href=../MPR121/ title="MPR121 I2C Proximity Capacitive Touch Sensor Controller" class=md-nav__link> MPR121 I<sup>2</sup>C Proximity Capacitive Touch Sensor Controller </a> </li> <li class=md-nav__item> <a href=../MPU-6050/ title="MPU 6050" class=md-nav__link> MPU 6050 </a> </li> <li class=md-nav__item> <a href=../NRF24L01/ title=NRF24L01 class=md-nav__link> NRF24L01 </a> </li> <li class=md-nav__item> <a href=../P1-Smart-Meter/ title="Kaifa MA105C Energy Meter" class=md-nav__link> Kaifa MA105C Energy Meter </a> </li> <li class=md-nav__item> <a href=../PAJ7620/ title=PAJ7620 class=md-nav__link> PAJ7620 </a> </li> <li class=md-nav__item> <a href=../PCA9685/ title=PCA9685 class=md-nav__link> PCA9685 </a> </li> <li class=md-nav__item> <a href=../PN532/ title=PN532 class=md-nav__link> PN532 </a> </li> <li class=md-nav__item> <a href=../PZEM-0XX/ title="PZEM 0XX" class=md-nav__link> PZEM 0XX </a> </li> <li class=md-nav__item> <a href=../RCWL-0516/ title="RCWL 0516" class=md-nav__link> RCWL 0516 </a> </li> <li class=md-nav__item> <a href=../RDM6300/ title=RDM6300 class=md-nav__link> RDM6300 </a> </li> <li class=md-nav__item> <a href=../SDS011/ title=SDS011 class=md-nav__link> SDS011 </a> </li> <li class=md-nav__item> <a href=../SHT30/ title=SHT30 class=md-nav__link> SHT30 </a> </li> <li class=md-nav__item> <a href=../TX2x/ title=TX2x class=md-nav__link> TX2x </a> </li> <li class=md-nav__item> <a href=../TSL2561/ title=TSL2561 class=md-nav__link> TSL2561 </a> </li> <li class=md-nav__item> <a href=../VEML6070/ title=VEML6070 class=md-nav__link> VEML6070 </a> </li> <li class=md-nav__item> <a href=../VL53L0x/ title=VL53L0x class=md-nav__link> VL53L0x </a> </li> <li class=md-nav__item> <a href=../WS2812B-RGB-Shield/ title="WS2812B RGB Shield" class=md-nav__link> WS2812B RGB Shield </a> </li> <li class=md-nav__item> <a href=../WS2812B-and-WS2813/ title="WS2812B and WS2813" class=md-nav__link> WS2812B and WS2813 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-25 type=checkbox id=nav-25> <label class=md-nav__link for=nav-25> Supported Devices <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z /></svg> </span> </label> <nav class=md-nav aria-label="Supported Devices" data-md-level=1> <label class=md-nav__title for=nav-25> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z /></svg> </span> Supported Devices </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Configuration-Procedure-for-New-Devices/ title="Configuring unknown devices" class=md-nav__link> Configuring unknown devices </a> </li> <li class=md-nav__item> <a href="https://templates.blakadder.com/ " target='_blank""' title="All Supported Devices" class=md-nav__link> All Supported Devices </a> </li> <li class=md-nav__item> <a href=../Supported-Modules/ title="Supported Modules" class=md-nav__link> Supported Modules </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-26 type=checkbox id=nav-26> <label class=md-nav__link for=nav-26> Help <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z /></svg> </span> </label> <nav class=md-nav aria-label=Help data-md-level=1> <label class=md-nav__title for=nav-26> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z /></svg> </span> Help </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../FAQ/ title=FAQ class=md-nav__link> FAQ </a> </li> <li class=md-nav__item> <a href=../Troubleshooting/ title=Troubleshooting class=md-nav__link> Troubleshooting </a> </li> <li class=md-nav__item> <a href=../Device-Recovery/ title="Device Recovery" class=md-nav__link> Device Recovery </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../Contributing/ title=Contributing class=md-nav__link> Contributing </a> </li> <li class=md-nav__item> <a href="//discord.gg/Ks2Kzd4  " target='_blank""' title="Discord Community" class=md-nav__link> Discord Community </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z /></svg> </span> Table of contents </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#temporarily-disable-deep-sleep-mode class=md-nav__link> Temporarily disable deep sleep mode </a> </li> <li class=md-nav__item> <a href=#executing-commands-before-entering-deepsleep class=md-nav__link> Executing commands before entering DeepSleep </a> </li> <li class=md-nav__item> <a href=#overcome-any-network-issue class=md-nav__link> Overcome any Network issue </a> </li> <li class=md-nav__item> <a href=#deep-sleep-algorithm-general-timing class=md-nav__link> Deep Sleep Algorithm General Timing </a> </li> <li class=md-nav__item> <a href=#wemos-d1-deep-sleep-side-effects class=md-nav__link> WEMOS D1 Deep Sleep Side-effects </a> </li> <li class=md-nav__item> <a href=#log-output-explanation class=md-nav__link> Log Output Explanation </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content> <article class="md-content__inner md-typeset"> <a href=https://github.com/tasmota/docs/blob/master/docs/DeepSleep.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18,2.9 17.35,2.9 16.96,3.29L15.12,5.12L18.87,8.87M3,17.25V21H6.75L17.81,9.93L14.06,6.18L3,17.25Z"/></svg> </a> <h1>DeepSleep</h1> <p>Deep sleep support for up to 1 day (i.e., 86,400 seconds) (e.g., if used with KNX) (<a href=../Commands/#deepsleeptime><code>DeepSleepTime</code></a>).</p> <p>The ESP8266 has a limitation of a maximum of ~71 minutes deep sleep. To overcome the limitation, a short wake-up is performed - the device will wake up every hour for &lt;0.3 seconds until the deep sleep time is reached. The remaining deep sleep time is decremented, and the device is then put back in deep sleep again. The remaining time is stored in RTC memory. As long as the device is powered (e.g., via the battery), this should work fine. Flash memory is not used because of how often this has to occur (every hour) and the time it takes for the flash to be ready takes much longer than the total time to write to the RTC.</p> <p><code>DeepSleepTime</code> sets the time that the device remains in deep sleep before it returns to full operating mode before returning to deep sleep again. <strong>This cannot be changed!</strong> For example, if you set <code>DeepSleepTime 3600</code>, the device will wake up every hour, exactly (e.g., 8:00am, 9:00am, ...). If you define <code>DeepSleepTime 86400</code> (i.e., 60*60*24), it will wake-up exactly at 0:00 UTC time - not your local time. If you define <code>DeepSleepTime 600</code>, it will wake-up every 10 minutes (e.g., 8:00, 8:10, 8:20, ...).</p> <p>To "reset" deep sleep, temporarily disconnect power and the RTC will be wiped on the next reboot. Alternatively, you can define a deep sleep input to temporarily disable deep sleep (described below).</p> <p>Please be aware that the minimum deep sleep time is 10 seconds. To wake the device, the RST pin must be connected to the D0/GPIO16 pin because the wake-up signal is sent through D0/GPIO16 to RST:</p> <p><img alt src=../_media/deepsleep_minimal.png></p> <p>It is recommended to leave GPIO16 configured as <code>None (0)</code> because GPIO16 cannot be used for anything else due to the hardwire to RST.</p> <p><img alt src=../_media/deepsleep_gpio16_none.png></p> <h3 id=temporarily-disable-deep-sleep-mode>Temporarily disable deep sleep mode<a class=headerlink href=#temporarily-disable-deep-sleep-mode title="Permanent link">~</a></h3> <p>There are a couple of different methods to temporarily disable deep sleep mode as outlined below.</p> <ul> <li>Use a GPIO and connect it GND. This can be performed through a switch like in the schematic below. Flipping the switch ON will prevent Tasmota to enter DeepSleep again after next wake-up until the switch is flipped back OFF.</li> </ul> <p><img alt src=../_media/deepsleep_switch.png></p> <p>You can define the <code>DeepSleep (182)</code> component as shown below:</p> <p><img alt src=../_media/deepsleep_deepsleep182.png></p> <p>The following GPIOs <strong>CANNOT</strong> be used for that purpose : - GPIO16 (because it is connected to RST), - GPIO15 (because of an existing on-board pull-down resistor), - GPIO0 (because pulling it down at wake up will enter serial bootload mode).</p> <p>All others GPIO should be acceptables.</p> <p>An interresting use-case is to disable DeepSleep when an external power (USB, PSU, solar panel...) is applied to the device using a transistor like:</p> <p><img alt src=../_media/deepsleep_transistor.png></p> <p>If the device is not (easily) accessible, the below methods can be used disable the DeepSleep loop without physically accessing it.</p> <ul> <li>Send a retained <code>DeepSleepTime 0</code> command to your device. As the message is retained in the MQTT broker, the device will receive it as soon as it connectes to the MQTT broker. If you are running hte <em>moquitto</em> broker, the following command line will do:<br> <code>mosquitto_pub -t "cmnd/myDeviceTopic/DeepsleepTime" -r -m "0"</code></li> </ul> <p>Or from another Tasmota device, you can use the console to send:<br> <code>publish2 cmnd/myDeviceTopic/DeepSleepTime 0</code></p> <blockquote> <p>Don't forget to remove the retained flag so the broker can "forget" this message with<br> <code>mosquitto_pub -t "cmnd/myDeviceTopic/DeepsleepTime" -r -n</code><br> or using a tool such as MQTT explorer.</p> </blockquote> <p>Once you have made your configuration change, you will need to re-enable the DeepSleep mode using the <code>DeepSleepTime</code> command.</p> <ul> <li>Configure a settable flag in your home automation hub (e.g., Node-Red, openHAB, Home Assistant). The flag should subscribe to the <code>INFO1</code> boot time message on the device topic, e.g., <code>tele/myDeviceTopic/INFO1</code>.</li> </ul> <p>The moment a message is received on this topic, the automation solution can publish a message to topic <code>cmnd/myDeviceTopic/DeepSleepTime</code> with a payload <code>0</code>. This will cause the device to disable deep sleep and allow maintenance such as firmware updates to be performed without having an unexpected deep sleep event. Send the <code>DeepSleepTime 0</code> command <strong><em>only once</em></strong>.</p> <p>Once the device maintenance is completed, place the device back into deep sleep mode using the original configuration.</p> <p>Be sure to change <code>myDeviceTopic</code> to the device topic.</p> <blockquote> <p><strong>If you're having issues after wakeup from sleep make sure bootloop detection is off <a href=../Commands/#setoption36><code>SetOption36 0</code></a> <a href=https://github.com/arendst/Tasmota/issues/6890#issuecomment-552181980>#6890</a></strong></p> </blockquote> <h3 id=executing-commands-before-entering-deepsleep>Executing commands before entering DeepSleep<a class=headerlink href=#executing-commands-before-entering-deepsleep title="Permanent link">~</a></h3> <p>If you want to execute some commands or a special script <strong>BEFORE</strong> the device goes into deep sleep you can use FUNC_SAVE_BEFORE_RESTART as a predefined hook to implement your own procedure. This requires you to code your own function and self-compile custom firmware.</p> <p>To use rules, use the <code>System#Save</code> trigger. This will be executed just before the device goes into deep sleep.</p> <h3 id=overcome-any-network-issue>Overcome any Network issue<a class=headerlink href=#overcome-any-network-issue title="Permanent link">~</a></h3> <p>If all requirements (Wifi, time synchronization via NTP, MQTT broker connection, and the Teleperiod) are not met, the device will stay awake while trying to attain the remaining requirements. On battery powered devices this behavior is undesirable because it will quickly deplete the battery. To avoid this when these requirements cannot be met, put the device back into deep sleep for an hour. Do this through a rule that will be triggered 30 seconds after reboot and sends the device into deepsleep for an hour.</p> <div class=codehilite><pre><span></span><code><span class=go>Rule1</span>
<span class=go>  ON Dimmer#Boot DO RuleTimer1 30 ENDON</span>
<span class=go>  ON Rules#Timer=1 DO DeepSleepTime 3600 ENDON</span>

<span class=go>Rule1 ON</span>
</code></pre></div> <h3 id=deep-sleep-algorithm-general-timing>Deep Sleep Algorithm General Timing<a class=headerlink href=#deep-sleep-algorithm-general-timing title="Permanent link">~</a></h3> <p>Let's assume you have set <code>DeepSleepTime 3600</code> (one hour) and <code>TelePeriod 300</code> (five minutes). The device will first wake at 8:00 am. The device will boot and connect Wi-Fi. Next, the correct time must be sync'ed from one of the NTP servers. Now the device has all prerequisites for going into deep sleep.</p> <p>Deep sleep is then triggered at the TELEPERIOD event. In this example, it will occur after five minutes. Telemetry will be collected and sent (e.g., via MQTT). Now, deep sleep can happen. First, <code>Offline</code> is published to the LWT topic on MQTT. It then calculates the new sleeping time to wake-up at 9:00 am (3600 seconds after the last wake-up). At 9:00 am this same sequence of events happens again.</p> <p>If you want to minimize the time that the device is in operation, decrease TELEPERIOD down to 10 seconds. This period of time is counted <strong>after</strong> MQTT is connected. Also, in this case, the device will wake up at 9:00 am even if the uptime was much smaller. If the device missed a wake-up it will try a start at the next event - in this case 10:00 am.</p> <h2 id=wemos-d1-deep-sleep-side-effects>WEMOS D1 Deep Sleep Side-effects<a class=headerlink href=#wemos-d1-deep-sleep-side-effects title="Permanent link">~</a></h2> <p>Not all GPIO behave the same during deep sleep. Some GPIO go HIGH, some LOW, some FOLLOW the relay but work only on FET transistors. As soon as current flows they go LOW. I use one GPIO to trigger a BC337 transistor to switch OFF all connected devices during deep sleep.</p> <p>Findings:</p> <table> <thead> <tr> <th>Pin</th> <th align=center>GPIO</th> <th>Behavior</th> </tr> </thead> <tbody> <tr> <td>D0</td> <td align=center>16</td> <td>Excluded due to use as wake-up pin</td> </tr> <tr> <td>D1</td> <td align=center>5</td> <td>KEEP STATE, go LOW if resistance to ground &lt; infinite</td> </tr> <tr> <td>D2</td> <td align=center>4</td> <td>KEEP STATE, go LOW if resistance to ground &lt; infinite</td> </tr> <tr> <td>D3</td> <td align=center>0</td> <td>HIGH</td> </tr> <tr> <td>D4</td> <td align=center>2</td> <td>HIGH</td> </tr> <tr> <td>D5</td> <td align=center>14</td> <td>HIGH, go LOW if resistance to ground &lt; infinite</td> </tr> <tr> <td>D6</td> <td align=center>12</td> <td>HIGH, go LOW if resistance to ground &lt; infinite</td> </tr> <tr> <td>D7</td> <td align=center>13</td> <td>HIGH, go LOW if resistance to ground &lt; infinite</td> </tr> <tr> <td>D8</td> <td align=center>15</td> <td>LOW</td> </tr> </tbody> </table> <h2 id=log-output-explanation>Log Output Explanation<a class=headerlink href=#log-output-explanation title="Permanent link">~</a></h2> <p><em>(logging level <code>4</code>)</em></p> <p>When MQTT connects at <code>13:08:38</code>, this sets the system to READY.</p> <div class=codehilite><pre><span></span><code><span class=mi>13</span><span class=o>:</span><span class=mi>08</span><span class=o>:</span><span class=mi>43</span> <span class=n>MQT</span><span class=o>:</span> <span class=n>tele</span><span class=sr>/tasmota/</span><span class=n>INFO3</span> <span class=o>=</span> <span class=o>{</span><span class=s2>&quot;RestartReason&quot;</span><span class=o>:</span><span class=s2>&quot;Deep-Sleep Wake&quot;</span><span class=o>}</span>
<span class=mi>13</span><span class=o>:</span><span class=mi>08</span><span class=o>:</span><span class=mi>44</span> <span class=n>APP</span><span class=o>:</span> <span class=n>Boot</span> <span class=n>Count</span> <span class=mi>3</span>
<span class=mi>13</span><span class=o>:</span><span class=mi>08</span><span class=o>:</span><span class=mi>44</span> <span class=n>CFG</span><span class=o>:</span> <span class=n>Saved</span> <span class=n>to</span> <span class=n>flash</span> <span class=n>at</span> <span class=n>F4</span><span class=o>,</span> <span class=n>Count</span> <span class=mi>96</span><span class=o>,</span> <span class=n>Bytes</span> <span class=mi>3824</span>
</code></pre></div> <p>In the context of DeepSleep, maintaining a device boot count is not relevant. When deep sleep is enabled, boot count will not be incremented. This avoids excessive flash writes which will deteriorate the flash memory chip and eventually cause the device to fail. Boot count incrementing can be enabled using <a href=../Commands/#setoption76><code>SetOption76</code></a>.</p> <p>In this example, TELEPERIOD is 10. Therefore when TELEPERIOD is reached, telemetry reporting occurs.</p> <div class=codehilite><pre><span></span><code><span class=mi>13</span><span class=o>:</span><span class=mi>08</span><span class=o>:</span><span class=mi>48</span> <span class=n>MQT</span><span class=o>:</span> <span class=n>tele</span><span class=sr>/tasmota/</span><span class=n>STATE</span> <span class=o>=</span> <span class=o>{</span><span class=s2>&quot;Time&quot;</span><span class=o>:</span><span class=s2>&quot;2019-09-04T13:08:48&quot;</span><span class=o>,</span><span class=s2>&quot;Epoch&quot;</span><span class=o>:</span><span class=mi>1567595328</span><span class=o>,</span><span class=s2>&quot;Uptime&quot;</span><span class=o>:</span><span class=s2>&quot;0T00:00:14&quot;</span><span class=o>,</span><span class=s2>&quot;UptimeSec&quot;</span><span class=o>:</span><span class=mi>14</span><span class=o>,</span><span class=s2>&quot;Heap&quot;</span><span class=o>:</span><span class=mi>24</span><span class=o>,</span><span class=s2>&quot;SleepMode&quot;</span><span class=o>:</span><span class=s2>&quot;Dynamic&quot;</span><span class=o>,</span><span class=s2>&quot;Sleep&quot;</span><span class=o>:</span><span class=mi>50</span><span class=o>,</span><span class=s2>&quot;LoadAvg&quot;</span><span class=o>:</span><span class=mi>20</span><span class=o>,</span><span class=s2>&quot;MqttCount&quot;</span><span class=o>:</span><span class=mi>1</span><span class=o>,</span><span class=s2>&quot;Wifi&quot;</span><span class=o>:{</span><span class=s2>&quot;AP&quot;</span><span class=o>:</span><span class=mi>1</span><span class=o>,</span><span class=s2>&quot;SSId&quot;</span><span class=o>:</span><span class=s2>&quot;MyWLAN&quot;</span><span class=o>,</span><span class=s2>&quot;BSSId&quot;</span><span class=o>:</span><span class=s2>&quot;AA:FF:AA:AA:AA:AA&quot;</span><span class=o>,</span><span class=s2>&quot;Channel&quot;</span><span class=o>:</span><span class=mi>11</span><span class=o>,</span><span class=s2>&quot;RSSI&quot;</span><span class=o>:</span><span class=mi>100</span><span class=o>,</span><span class=s2>&quot;LinkCount&quot;</span><span class=o>:</span><span class=mi>1</span><span class=o>,</span><span class=s2>&quot;Downtime&quot;</span><span class=o>:</span><span class=s2>&quot;0T00:00:08&quot;</span><span class=o>,</span><span class=s2>&quot;DeepSleep&quot;</span><span class=o>:</span><span class=mi>300</span><span class=o>,</span><span class=s2>&quot;Heap&quot;</span><span class=o>:</span><span class=mi>25160</span><span class=o>}}</span>
<span class=mi>13</span><span class=o>:</span><span class=mi>08</span><span class=o>:</span><span class=mi>48</span> <span class=n>MQT</span><span class=o>:</span> <span class=n>tele</span><span class=sr>/tasmota/</span><span class=n>SENSOR</span> <span class=o>=</span> <span class=o>{</span><span class=s2>&quot;Time&quot;</span><span class=o>:</span><span class=s2>&quot;2019-09-04T13:08:48&quot;</span><span class=o>,</span><span class=s2>&quot;Epoch&quot;</span><span class=o>:</span><span class=mi>1567595328</span><span class=o>,</span><span class=s2>&quot;ANALOG&quot;</span><span class=o>:{</span><span class=s2>&quot;A0&quot;</span><span class=o>:</span><span class=mi>8</span><span class=o>}}</span>
</code></pre></div> <p>DATETIME is set. Status and telemetry sent. Now start shutdown procedure.</p> <p>First, send MQTT offline. <code>13:08:48 MQT: state/sonoff/LWT = Offline</code></p> <p>Deep sleep is 300 seconds. Therefore +-30 sec is allowed as the deviation between the proposed time between wake-up and real time between wake-up. Reporting in 0.1sec. In this case wake-up was one second late. <code>13:08:48 Timeslip 0.1 sec:? -300 &lt; -10 &lt; 300</code></p> <p>If the error is in the range, this is tagged as a normal wake up where drift can we recalculated <code>13:08:48 Normal deepsleep? 1</code></p> <p>Recalculate a new drift that is a multiplier for the next wake-up in 1/10000. In this case, the multiplier is 1.0257 <code>13:08:48 % RTC new drift 10257</code></p> <p>And for information: New target wake-up time <code>13:08:48 Next wakeup 2019-09-04T13:10:00</code></p> <p>Based on run time and the error in the last loop, a new sleeping time will be calculated. This will be multiplied by the <code>deepsleep_slip</code> and, ideally, the device will wake up at the time above. <code>13:08:48 Sleeptime 285 sec, deepsleep_slip 10257</code></p> <p>The effectiveness of the compensation can be seen here. Instead of typically 160-200 seconds, most times it is better than 10 seconds in a one hour deep sleep cycle.</p> <p><img alt=TempComp src=https://raw.githubusercontent.com/stefanbode/stefanbode.github.io/master/images/deepsleep_comp.png></p> </article> </div> </div> </main> <footer class=md-footer> <div class=md-footer-nav> <nav class="md-footer-nav__inner md-grid" aria-label=Footer> <a href=../TasmotaSlave/ title=TasmotaSlave class="md-footer-nav__link md-footer-nav__link--prev" rel=prev> <div class="md-footer-nav__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z /></svg> </div> <div class=md-footer-nav__title> <div class=md-ellipsis> <span class=md-footer-nav__direction> Previous </span> TasmotaSlave </div> </div> </a> <a href=../PWM-dimmer-switch/ title="PWM Dimmer" class="md-footer-nav__link md-footer-nav__link--next" rel=next> <div class=md-footer-nav__title> <div class=md-ellipsis> <span class=md-footer-nav__direction> Next </span> PWM Dimmer </div> </div> <div class="md-footer-nav__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M4,11V13H16L10.5,18.5L11.92,19.92L19.84,12L11.92,4.08L10.5,5.5L16,11H4Z /></svg> </div> </a> </nav> </div> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-footer-social> <a href=https://discord.gg/Ks2Kzd4 target=_blank rel=noopener title=discord.gg class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M297.216 243.2c0 15.616-11.52 28.416-26.112 28.416-14.336 0-26.112-12.8-26.112-28.416s11.52-28.416 26.112-28.416c14.592 0 26.112 12.8 26.112 28.416zm-119.552-28.416c-14.592 0-26.112 12.8-26.112 28.416s11.776 28.416 26.112 28.416c14.592 0 26.112-12.8 26.112-28.416.256-15.616-11.52-28.416-26.112-28.416zM448 52.736V512c-64.494-56.994-43.868-38.128-118.784-107.776l13.568 47.36H52.48C23.552 451.584 0 428.032 0 398.848V52.736C0 23.552 23.552 0 52.48 0h343.04C424.448 0 448 23.552 448 52.736zm-72.96 242.688c0-82.432-36.864-149.248-36.864-149.248-36.864-27.648-71.936-26.88-71.936-26.88l-3.584 4.096c43.52 13.312 63.744 32.512 63.744 32.512-60.811-33.329-132.244-33.335-191.232-7.424-9.472 4.352-15.104 7.424-15.104 7.424s21.248-20.224 67.328-33.536l-2.56-3.072s-35.072-.768-71.936 26.88c0 0-36.864 66.816-36.864 149.248 0 0 21.504 37.12 78.08 38.912 0 0 9.472-11.52 17.152-21.248-32.512-9.728-44.8-30.208-44.8-30.208 3.766 2.636 9.976 6.053 10.496 6.4 43.21 24.198 104.588 32.126 159.744 8.96 8.96-3.328 18.944-8.192 29.44-15.104 0 0-12.8 20.992-46.336 30.464 7.68 9.728 16.896 20.736 16.896 20.736 56.576-1.792 78.336-38.912 78.336-38.912z"/></svg> </a> <a href=https://t.me/tasmota target=_blank rel=noopener title=t.me class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><path d="M248 8C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm121.8 169.9l-40.7 191.8c-3 13.6-11.1 16.9-22.4 10.5l-62-45.7-29.9 28.8c-3.3 3.3-6.1 6.1-12.5 6.1l4.4-63.1 114.9-103.8c5-4.4-1.1-6.9-7.7-2.5l-142 89.4-61.2-19.1c-13.3-4.2-13.6-13.3 2.8-19.7l239.1-92.2c11.1-4 20.8 2.7 17.2 19.5z"/></svg> </a> <a href=https://github.com/tasmota target=_blank rel=noopener title=github.com class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 480 512"><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg> </a> </div> </div> </div> </footer> </div> <script src=../assets/javascripts/vendor.23350dc5.min.js></script> <script src=../assets/javascripts/bundle.36a8f969.min.js></script><script id=__lang type=application/json>{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script> <script>
        app = initialize({
          base: "..",
          features: ["tabs"],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.3bc815f0.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script> </body> </html>