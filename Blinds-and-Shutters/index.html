<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Documentation (Wiki) for Tasmota"><link href=https://tasmota.github.io/docs/Blinds-and-Shutters/ rel=canonical><link href=../Scripting-Language/ rel=prev><link href=../TasmotaClient/ rel=next><link rel=icon href=../_media/favicon.ico><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.6.23"><title>Shutters and Blinds - Tasmota</title><link rel=stylesheet href=../assets/stylesheets/main.84d31ad4.min.css><link rel=stylesheet href=../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Barlow:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Barlow";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../assets/css/anchor-fix.css><script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-8J08F8X90S"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-8J08F8X90S",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-8J08F8X90S",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script><script>"undefined"!=typeof __md_analytics&&__md_analytics()</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=blue data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#shutters-and-blinds class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=.. title=Tasmota class="md-header__button md-logo" aria-label=Tasmota data-md-component=logo> <img src=../_media/logo.svg alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Tasmota </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Shutters and Blinds </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=blue data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=blue data-md-color-accent=deep-purple aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/arendst/tasmota title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg> </div> <div class=md-source__repository> arendst/tasmota </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=.. class=md-tabs__link> Home </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../Features/ class=md-tabs__link> Features </a> </li> <li class=md-tabs__item> <a href=../ESP32/ class=md-tabs__link> ESP32 </a> </li> <li class=md-tabs__item> <a href=../Integrations/ class=md-tabs__link> Smart Home Integrations </a> </li> <li class=md-tabs__item> <a href=../Supported-Peripherals/ class=md-tabs__link> Peripherals </a> </li> <li class=md-tabs__item> <a href=../Configuration-Procedure-for-New-Devices/ class=md-tabs__link> Supported Devices </a> </li> <li class=md-tabs__item> <a href=../FAQ/ class=md-tabs__link> Help </a> </li> <li class=md-tabs__item> <a href=http://tasmota.github.io/install class=md-tabs__link> Web Installer </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=.. title=Tasmota class="md-nav__button md-logo" aria-label=Tasmota data-md-component=logo> <img src=../_media/logo.svg alt=logo> </a> Tasmota </label> <div class=md-nav__source> <a href=https://github.com/arendst/tasmota title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg> </div> <div class=md-source__repository> arendst/tasmota </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_1> <label class=md-nav__link for=__nav_1 id=__nav_1_label tabindex=0> <span class=md-ellipsis> Home </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_1_label aria-expanded=false> <label class=md-nav__title for=__nav_1> <span class="md-nav__icon md-icon"></span> Home </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=.. class=md-nav__link> <span class=md-ellipsis> News </span> </a> </li> <li class=md-nav__item> <a href=../About/ class=md-nav__link> <span class=md-ellipsis> About </span> </a> </li> <li class=md-nav__item> <a href=../Getting-Started/ class=md-nav__link> <span class=md-ellipsis> Getting Started </span> </a> </li> <li class=md-nav__item> <a href=../Upgrading/ class=md-nav__link> <span class=md-ellipsis> Upgrading </span> </a> </li> <li class=md-nav__item> <a href=../MQTT/ class=md-nav__link> <span class=md-ellipsis> MQTT </span> </a> </li> <li class=md-nav__item> <a href=../Commands/ class=md-nav__link> <span class=md-ellipsis> Commands </span> </a> </li> <li class=md-nav__item> <a href=../Templates/ class=md-nav__link> <span class=md-ellipsis> Templates </span> </a> </li> <li class=md-nav__item> <a href=../Components/ class=md-nav__link> <span class=md-ellipsis> Components </span> </a> </li> <li class=md-nav__item> <a href=../Modules/ class=md-nav__link> <span class=md-ellipsis> Modules </span> </a> </li> <li class=md-nav__item> <a href=../Peripherals/ class=md-nav__link> <span class=md-ellipsis> Peripherals </span> </a> </li> <li class=md-nav__item> <a href=../WebUI/ class=md-nav__link> <span class=md-ellipsis> WebUI </span> </a> </li> <li class=md-nav__item> <a href=../Firmware-Builds/ class=md-nav__link> <span class=md-ellipsis> Firmware Builds </span> </a> </li> <li class=md-nav__item> <a href=../Compile-your-build/ class=md-nav__link> <span class=md-ellipsis> Compiling </span> </a> </li> <li class=md-nav__item> <a href=../Contributing/ class=md-nav__link> <span class=md-ellipsis> Contributing </span> </a> </li> <li class=md-nav__item> <a href=../Download/ class=md-nav__link> <span class=md-ellipsis> Download </span> </a> </li> <li class=md-nav__item> <a href=https://github.com/arendst/Tasmota/discussions/categories/show-and-tell class=md-nav__link> <span class=md-ellipsis> Project Showcase </span> </a> </li> <li class=md-nav__item> <a href=../For-Developers/ class=md-nav__link> <span class=md-ellipsis> For Developers </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2 checked> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex> <span class=md-ellipsis> Features </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=true> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Features </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Features/ class=md-nav__link> <span class=md-ellipsis> Introduction </span> </a> </li> <li class=md-nav__item> <a href=../ADC/ class=md-nav__link> <span class=md-ellipsis> Analog Pin </span> </a> </li> <li class=md-nav__item> <a href=../ArtNet/ class=md-nav__link> <span class=md-ellipsis> ArtNet DMX </span> </a> </li> <li class=md-nav__item> <a href=../Buttons-and-Switches/ class=md-nav__link> <span class=md-ellipsis> Buttons and Switches </span> </a> </li> <li class=md-nav__item> <a href=../DeepSleep/ class=md-nav__link> <span class=md-ellipsis> DeepSleep </span> </a> </li> <li class=md-nav__item> <a href=../Device-Groups/ class=md-nav__link> <span class=md-ellipsis> Device Groups </span> </a> </li> <li class=md-nav__item> <a href=../Universal-Display-Driver/ class=md-nav__link> <span class=md-ellipsis> Universal Display and Universal Touch drivers (uDisplay/uTouch) </span> </a> </li> <li class=md-nav__item> <a href=../Displays/ class=md-nav__link> <span class=md-ellipsis> Displays </span> </a> </li> <li class=md-nav__item> <a href=../Dynamic-Sleep/ class=md-nav__link> <span class=md-ellipsis> Dynamic Sleep </span> </a> </li> <li class=md-nav__item> <a href=../I2CDEVICES/ class=md-nav__link> <span class=md-ellipsis> I2C Devices </span> </a> </li> <li class=md-nav__item> <a href=../I2S-Audio/ class=md-nav__link> <span class=md-ellipsis> I2S Audio </span> </a> </li> <li class=md-nav__item> <a href=../IPv6/ class=md-nav__link> <span class=md-ellipsis> IPv6 </span> </a> </li> <li class=md-nav__item> <a href=../Lights/ class=md-nav__link> <span class=md-ellipsis> Lights </span> </a> </li> <li class=md-nav__item> <a href=../Matter/ class=md-nav__link> <span class=md-ellipsis> Matter </span> </a> </li> <li class=md-nav__item> <a href=../PIR-Motion-Sensors/ class=md-nav__link> <span class=md-ellipsis> PIR Motion Sensors </span> </a> </li> <li class=md-nav__item> <a href=../Power-Monitoring-Calibration/ class=md-nav__link> <span class=md-ellipsis> Power Monitoring Calibration </span> </a> </li> <li class=md-nav__item> <a href=../PWM-dimmer-switch/ class=md-nav__link> <span class=md-ellipsis> PWM Dimmer </span> </a> </li> <li class=md-nav__item> <a href=../Rules/ class=md-nav__link> <span class=md-ellipsis> Rules </span> </a> </li> <li class=md-nav__item> <a href=../Scripting-Language/ class=md-nav__link> <span class=md-ellipsis> Scripting Language </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> Shutters and Blinds </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Shutters and Blinds </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#commands class=md-nav__link> <span class=md-ellipsis> Commands </span> </a> </li> <li class=md-nav__item> <a href=#shutter-modes class=md-nav__link> <span class=md-ellipsis> Shutter Modes </span> </a> </li> <li class=md-nav__item> <a href=#operation class=md-nav__link> <span class=md-ellipsis> Operation </span> </a> </li> <li class=md-nav__item> <a href=#autosetup-only-shelly-plus-2pm-esp32-based class=md-nav__link> <span class=md-ellipsis> AutoSetup (Only Shelly plus 2PM, ESP32 based) </span> </a> </li> <li class=md-nav__item> <a href=#calibration class=md-nav__link> <span class=md-ellipsis> Calibration </span> </a> <nav class=md-nav aria-label=Calibration> <ul class=md-nav__list> <li class=md-nav__item> <a href=#motor-movement-delays class=md-nav__link> <span class=md-ellipsis> Motor Movement Delays </span> </a> </li> <li class=md-nav__item> <a href=#coarse-positioning-calibration-halfway-point-only class=md-nav__link> <span class=md-ellipsis> Coarse Positioning Calibration (Halfway point only) </span> </a> </li> <li class=md-nav__item> <a href=#fine-positioning-calibration-calibration-matrix class=md-nav__link> <span class=md-ellipsis> Fine Positioning Calibration (Calibration Matrix) </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#motor-stop-time class=md-nav__link> <span class=md-ellipsis> Motor Stop time </span> </a> </li> <li class=md-nav__item> <a href=#button-control class=md-nav__link> <span class=md-ellipsis> Button Control </span> </a> </li> <li class=md-nav__item> <a href=#remote-control class=md-nav__link> <span class=md-ellipsis> Remote Control </span> </a> </li> <li class=md-nav__item> <a href=#using-rules class=md-nav__link> <span class=md-ellipsis> Using Rules </span> </a> </li> <li class=md-nav__item> <a href=#specific-configuration class=md-nav__link> <span class=md-ellipsis> Specific Configuration </span> </a> <nav class=md-nav aria-label="Specific Configuration"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#pulse-motors class=md-nav__link> <span class=md-ellipsis> Pulse Motors </span> </a> </li> <li class=md-nav__item> <a href=#stepper-motors class=md-nav__link> <span class=md-ellipsis> Stepper Motors </span> </a> </li> <li class=md-nav__item> <a href=#servo-motors class=md-nav__link> <span class=md-ellipsis> Servo Motors </span> </a> </li> <li class=md-nav__item> <a href=#dc-motors class=md-nav__link> <span class=md-ellipsis> DC Motors </span> </a> </li> <li class=md-nav__item> <a href=#smooth-ramp-up-and-ramp-down-support class=md-nav__link> <span class=md-ellipsis> Smooth RAMP-UP and RAMP-DOWN Support </span> </a> </li> <li class=md-nav__item> <a href=#using-normal-motors class=md-nav__link> <span class=md-ellipsis> using normal Motors </span> </a> </li> <li class=md-nav__item> <a href=#using-stepper-motors class=md-nav__link> <span class=md-ellipsis> using Stepper Motors </span> </a> </li> <li class=md-nav__item> <a href=#using-sonoff-dual-r2 class=md-nav__link> <span class=md-ellipsis> using Sonoff Dual R2 </span> </a> </li> <li class=md-nav__item> <a href=#jarolift-shutter-support class=md-nav__link> <span class=md-ellipsis> Jarolift Shutter Support </span> </a> </li> <li class=md-nav__item> <a href=#venetian-blind-support class=md-nav__link> <span class=md-ellipsis> Venetian Blind Support </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_21> <label class=md-nav__link for=__nav_2_21 id=__nav_2_21_label tabindex=0> <span class=md-ellipsis> Protocol Bridging </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_21_label aria-expanded=false> <label class=md-nav__title for=__nav_2_21> <span class="md-nav__icon md-icon"></span> Protocol Bridging </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../TasmotaClient/ class=md-nav__link> <span class=md-ellipsis> Arduino MCU </span> </a> </li> <li class=md-nav__item> <a href=../Bluetooth/ class=md-nav__link> <span class=md-ellipsis> BLE Gateway </span> </a> </li> <li class=md-nav__item> <a href=../DALI/ class=md-nav__link> <span class=md-ellipsis> DALI </span> </a> </li> <li class=md-nav__item> <a href=../HDMI_CEC/ class=md-nav__link> <span class=md-ellipsis> HDMI CEC </span> </a> </li> <li class=md-nav__item> <a href=../Tasmota-IR/ class=md-nav__link> <span class=md-ellipsis> IR Communication </span> </a> </li> <li class=md-nav__item> <a href=../Projector/ class=md-nav__link> <span class=md-ellipsis> LCD/DLP Projector Control </span> </a> </li> <li class=md-nav__item> <a href=../LoRa-and-LoRaWan-Bridge/ class=md-nav__link> <span class=md-ellipsis> LoRa and LoRaWan Bridge </span> </a> </li> <li class=md-nav__item> <a href=../Modbus-Bridge/ class=md-nav__link> <span class=md-ellipsis> Modbus Bridge </span> </a> </li> <li class=md-nav__item> <a href=../OpenTherm/ class=md-nav__link> <span class=md-ellipsis> OpenTherm </span> </a> </li> <li class=md-nav__item> <a href=../RF-Protocol/ class=md-nav__link> <span class=md-ellipsis> RF Communication </span> </a> </li> <li class=md-nav__item> <a href=../Serial-to-TCP-Bridge/ class=md-nav__link> <span class=md-ellipsis> Serial to TCP Bridge </span> </a> </li> <li class=md-nav__item> <a href=../TWAI/ class=md-nav__link> <span class=md-ellipsis> TWAI </span> </a> </li> <li class=md-nav__item> <a href=../Telegram/ class=md-nav__link> <span class=md-ellipsis> Telegram </span> </a> </li> <li class=md-nav__item> <a href=../Zigbee/ class=md-nav__link> <span class=md-ellipsis> Zigbee </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../Smart-Meter-Interface/ class=md-nav__link> <span class=md-ellipsis> Smart Meter Interface </span> </a> </li> <li class=md-nav__item> <a href=../Thermostat/ class=md-nav__link> <span class=md-ellipsis> Thermostat </span> </a> </li> <li class=md-nav__item> <a href=../Timers/ class=md-nav__link> <span class=md-ellipsis> Timers </span> </a> </li> <li class=md-nav__item> <a href=../TLS/ class=md-nav__link> <span class=md-ellipsis> TLS Secured MQTT </span> </a> </li> <li class=md-nav__item> <a href=../TuyaMCU/ class=md-nav__link> <span class=md-ellipsis> TuyaMCU </span> </a> </li> <li class=md-nav__item> <a href=../UFS/ class=md-nav__link> <span class=md-ellipsis> Universal File System </span> </a> </li> <li class=md-nav__item> <a href=../Range-Extender/ class=md-nav__link> <span class=md-ellipsis> Wi-Fi Range Extender </span> </a> </li> <li class=md-nav__item> <a href=../Wireguard/ class=md-nav__link> <span class=md-ellipsis> Wireguard VPN </span> </a> </li> <li class=md-nav__item> <a href=../Tutorials/ class=md-nav__link> <span class=md-ellipsis> Projects and Tutorials </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex=0> <span class=md-ellipsis> ESP32 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> ESP32 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../ESP32/ class=md-nav__link> <span class=md-ellipsis> Tasmota32 Features </span> </a> </li> <li class=md-nav__item> <a href=../Berry/ class=md-nav__link> <span class=md-ellipsis> Berry </span> </a> </li> <li class=md-nav__item> <a href=../Bluetooth_ESP32/ class=md-nav__link> <span class=md-ellipsis> Bluetooth Low Energy </span> </a> </li> <li class=md-nav__item> <a href=../LVGL/ class=md-nav__link> <span class=md-ellipsis> LVGL </span> </a> </li> <li class=md-nav__item> <a href=../HASPmota/ class=md-nav__link> <span class=md-ellipsis> HASPmota </span> </a> </li> <li class=md-nav__item> <a href=../Matter/ class=md-nav__link> <span class=md-ellipsis> Matter </span> </a> </li> <li class=md-nav__item> <a href=../Tasmota-Extension/ class=md-nav__link> <span class=md-ellipsis> Tasmota Extension </span> </a> </li> <li class=md-nav__item> <a href=../Tasmota-Application/ class=md-nav__link> <span class=md-ellipsis> Tasmota Application Files </span> </a> </li> <li class=md-nav__item> <a href=../TFL/ class=md-nav__link> <span class=md-ellipsis> TensorFlow Lite </span> </a> </li> <li class=md-nav__item> <a href=../TouchPin/ class=md-nav__link> <span class=md-ellipsis> Touch GPIOs </span> </a> </li> <li class=md-nav__item> <a href=../Safeboot/ class=md-nav__link> <span class=md-ellipsis> Safeboot Partition Layout </span> </a> </li> <li class=md-nav__item> <a href=https://templates.blakadder.com/esp32 class=md-nav__link> <span class=md-ellipsis> Supported Devices </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex=0> <span class=md-ellipsis> Smart Home Integrations </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Smart Home Integrations </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Integrations/ class=md-nav__link> <span class=md-ellipsis> Introduction </span> </a> </li> <li class=md-nav__item> <a href=../Alexa/ class=md-nav__link> <span class=md-ellipsis> Alexa </span> </a> </li> <li class=md-nav__item> <a href=../AWS-IoT/ class=md-nav__link> <span class=md-ellipsis> AWS IoT </span> </a> </li> <li class=md-nav__item> <a href=../Domoticz/ class=md-nav__link> <span class=md-ellipsis> Domoticz </span> </a> </li> <li class=md-nav__item> <a href=../Home-Assistant/ class=md-nav__link> <span class=md-ellipsis> Home Assistant </span> </a> </li> <li class=md-nav__item> <a href=../Homebridge/ class=md-nav__link> <span class=md-ellipsis> Homebridge </span> </a> </li> <li class=md-nav__item> <a href=https://homey.app/en-us/app/com.paveld.tasmota/Tasmota-MQTT/ class=md-nav__link> <span class=md-ellipsis> Homey </span> </a> </li> <li class=md-nav__item> <a href=../HomeSeer/ class=md-nav__link> <span class=md-ellipsis> HomeSeer </span> </a> </li> <li class=md-nav__item> <a href=../IP-Symcon/ class=md-nav__link> <span class=md-ellipsis> IP Symcon </span> </a> </li> <li class=md-nav__item> <a href=../KNX/ class=md-nav__link> <span class=md-ellipsis> KNX </span> </a> </li> <li class=md-nav__item> <a href=../NodeRed/ class=md-nav__link> <span class=md-ellipsis> NodeRed </span> </a> </li> <li class=md-nav__item> <a href=../nymea/ class=md-nav__link> <span class=md-ellipsis> nymea </span> </a> </li> <li class=md-nav__item> <a href=../Octoprint/ class=md-nav__link> <span class=md-ellipsis> OctoPrint </span> </a> </li> <li class=md-nav__item> <a href=../openHAB/ class=md-nav__link> <span class=md-ellipsis> openHAB </span> </a> </li> <li class=md-nav__item> <a href=../otto/ class=md-nav__link> <span class=md-ellipsis> Otto </span> </a> </li> <li class=md-nav__item> <a href=https://github.com/arendst/Tasmota/issues/3769 class=md-nav__link> <span class=md-ellipsis> IOBroker </span> </a> </li> <li class=md-nav__item> <a href=https://github.com/tim-hellhake/tasmota-adapter class=md-nav__link> <span class=md-ellipsis> Mozilla WebThings Adapter </span> </a> </li> <li class=md-nav__item> <a href=https://github.com/hongtat/tasmota-connect class=md-nav__link> <span class=md-ellipsis> SmartThings </span> </a> </li> <li class=md-nav__item> <a href=https://github.com/Gifford47/tasmohab/blob/master/README.md class=md-nav__link> <span class=md-ellipsis> Tasmohab </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../Supported-Peripherals/ class=md-nav__link> <span class=md-ellipsis> Peripherals </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6 id=__nav_6_label tabindex=0> <span class=md-ellipsis> Supported Devices </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=false> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Supported Devices </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Configuration-Procedure-for-New-Devices/ class=md-nav__link> <span class=md-ellipsis> Configure Unknown Device </span> </a> </li> <li class=md-nav__item> <a href="https://templates.blakadder.com/ " target='_blank""' class=md-nav__link> <span class=md-ellipsis> All Supported Devices </span> </a> </li> <li class=md-nav__item> <a href=../Pinouts/ class=md-nav__link> <span class=md-ellipsis> Wi-Fi Module Pinouts </span> </a> </li> <li class=md-nav__item> <a href=../Supported-Modules/ class=md-nav__link> <span class=md-ellipsis> Supported Modules </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7> <label class=md-nav__link for=__nav_7 id=__nav_7_label tabindex=0> <span class=md-ellipsis> Help </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_7_label aria-expanded=false> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> Help </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../FAQ/ class=md-nav__link> <span class=md-ellipsis> FAQ </span> </a> </li> <li class=md-nav__item> <a href=../Troubleshooting/ class=md-nav__link> <span class=md-ellipsis> Troubleshooting </span> </a> </li> <li class=md-nav__item> <a href=../Device-Recovery/ class=md-nav__link> <span class=md-ellipsis> Device Recovery </span> </a> </li> <li class=md-nav__item> <a href="https://discord.gg/Ks2Kzd4 " target='_blank""' class=md-nav__link> <span class=md-ellipsis> Discord Support </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=http://tasmota.github.io/install class=md-nav__link> <span class=md-ellipsis> Web Installer </span> </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#commands class=md-nav__link> <span class=md-ellipsis> Commands </span> </a> </li> <li class=md-nav__item> <a href=#shutter-modes class=md-nav__link> <span class=md-ellipsis> Shutter Modes </span> </a> </li> <li class=md-nav__item> <a href=#operation class=md-nav__link> <span class=md-ellipsis> Operation </span> </a> </li> <li class=md-nav__item> <a href=#autosetup-only-shelly-plus-2pm-esp32-based class=md-nav__link> <span class=md-ellipsis> AutoSetup (Only Shelly plus 2PM, ESP32 based) </span> </a> </li> <li class=md-nav__item> <a href=#calibration class=md-nav__link> <span class=md-ellipsis> Calibration </span> </a> <nav class=md-nav aria-label=Calibration> <ul class=md-nav__list> <li class=md-nav__item> <a href=#motor-movement-delays class=md-nav__link> <span class=md-ellipsis> Motor Movement Delays </span> </a> </li> <li class=md-nav__item> <a href=#coarse-positioning-calibration-halfway-point-only class=md-nav__link> <span class=md-ellipsis> Coarse Positioning Calibration (Halfway point only) </span> </a> </li> <li class=md-nav__item> <a href=#fine-positioning-calibration-calibration-matrix class=md-nav__link> <span class=md-ellipsis> Fine Positioning Calibration (Calibration Matrix) </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#motor-stop-time class=md-nav__link> <span class=md-ellipsis> Motor Stop time </span> </a> </li> <li class=md-nav__item> <a href=#button-control class=md-nav__link> <span class=md-ellipsis> Button Control </span> </a> </li> <li class=md-nav__item> <a href=#remote-control class=md-nav__link> <span class=md-ellipsis> Remote Control </span> </a> </li> <li class=md-nav__item> <a href=#using-rules class=md-nav__link> <span class=md-ellipsis> Using Rules </span> </a> </li> <li class=md-nav__item> <a href=#specific-configuration class=md-nav__link> <span class=md-ellipsis> Specific Configuration </span> </a> <nav class=md-nav aria-label="Specific Configuration"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#pulse-motors class=md-nav__link> <span class=md-ellipsis> Pulse Motors </span> </a> </li> <li class=md-nav__item> <a href=#stepper-motors class=md-nav__link> <span class=md-ellipsis> Stepper Motors </span> </a> </li> <li class=md-nav__item> <a href=#servo-motors class=md-nav__link> <span class=md-ellipsis> Servo Motors </span> </a> </li> <li class=md-nav__item> <a href=#dc-motors class=md-nav__link> <span class=md-ellipsis> DC Motors </span> </a> </li> <li class=md-nav__item> <a href=#smooth-ramp-up-and-ramp-down-support class=md-nav__link> <span class=md-ellipsis> Smooth RAMP-UP and RAMP-DOWN Support </span> </a> </li> <li class=md-nav__item> <a href=#using-normal-motors class=md-nav__link> <span class=md-ellipsis> using normal Motors </span> </a> </li> <li class=md-nav__item> <a href=#using-stepper-motors class=md-nav__link> <span class=md-ellipsis> using Stepper Motors </span> </a> </li> <li class=md-nav__item> <a href=#using-sonoff-dual-r2 class=md-nav__link> <span class=md-ellipsis> using Sonoff Dual R2 </span> </a> </li> <li class=md-nav__item> <a href=#jarolift-shutter-support class=md-nav__link> <span class=md-ellipsis> Jarolift Shutter Support </span> </a> </li> <li class=md-nav__item> <a href=#venetian-blind-support class=md-nav__link> <span class=md-ellipsis> Venetian Blind Support </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/tasmota/docs/blob/master/docs/Blinds-and-Shutters.md title="Edit this page" class="md-content__button md-icon" rel=edit> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg> </a> <h1 id=shutters-and-blinds>Shutters and Blinds<a class=headerlink href=#shutters-and-blinds title="Permanent link">~</a></h1> <div class="admonition info"> <p class=admonition-title>Control blinds and roller shades connected to regular ON/OFF motors,stepper motors or position servos</p> </div> <p>Before starting you have to enable shutter support with <code>SetOption80 1</code></p> <p>There is a new enhanced ESP32 version you can enable with the following compiler option <code>#define USE_SHUTTER_ESP32</code>. Will be default in future versions for ESP32 after some testing. New features most likely only in ESP32 due to memory limitations in ESP8266. Current feature set: </p> <ul> <li>up to 16 shutters, </li> <li>up to 32 shutterbuttons, </li> <li>tilt definition with buttons. </li> <li>Configuration saved to filesystem.</li> <li>shuttersetup for Shelly plus 2PM to automatically measure open and close duration</li> </ul> <h2 id=commands>Commands<a class=headerlink href=#commands title="Permanent link">~</a></h2> <p>Complete list of commands is available at <a href=../Commands/#shutters>Blinds, Shutters and Roller Shades Commands</a>.</p> <h2 id=shutter-modes>Shutter Modes<a class=headerlink href=#shutter-modes title="Permanent link">~</a></h2> <p>There are five shutter modes which define how the relays operate. Additionally you can define <a href=../Commands/#pulsetime>PulseTime</a> on any relay to change the relay into a pulse relay where the pulse changes start/stop. At least for Shutter mode 1 an interlock is mandatory <a href=../Commands/#interlock>Interlock</a>. </p> <p>The examples below are for a <code>ShutterRelay1 1</code> configuration (using Relay1 and Relay2).</p> <p><strong>Shutter mode 1</strong> - Normal Operation </p> <p>Relay1: UP/OFF, Relay2: DOWN/OFF </p> <ul> <li><code>Interlock 1,2</code> (Interlocked relay pair)</li> <li><code>Interlock ON</code></li> </ul> <p><strong>Shutter mode 2</strong> - Circuit Safe (must be set manually)</p> <p>Relay1: ON/OFF, Relay2: UP/DOWN</p> <ul> <li><code>Interlock OFF</code></li> </ul> <p><strong>Shutter mode 3</strong> - Garage Motors (must be set manually) </p> <p>Relay1: OFF/DOWN PULSE, Relay2: OFF/UP PULSE</p> <p><strong>Shutter mode 4</strong> - Stepper Motors (autodetect with PWM and COUNTER) </p> <p>Relay1: ON/OFF, Relay2: UP/DOWN</p> <ul> <li>PWM: Stepper signal, COUNTER: Stepper position signal</li> <li>PWM and COUNTER defined</li> </ul> <p><strong>Shutter mode 5</strong> - Servo Motors (PWM position based servo) </p> <p>Relay1: ON/OFF, Relay2: UP/DOWN (optional not used)</p> <ul> <li>PWM: Stepper signal</li> <li><code>PWMfrequency 200</code> ( This is mandatory for most relay to get correct PWM duty cylces)</li> <li><code>SetOption15 0</code> (required to store value and make it reboot save)</li> </ul> <p><strong>Shutter mode 6</strong> - Servo Motors 360° (PWM speed based servo)</p> <p>Relay1: ON/OFF, Relay2: UP/DOWN (optional not used)</p> <ul> <li>PWM: Stepper signal</li> <li><code>PWMfrequency 200</code> ( This is mandatory for most relay to get correct PWM duty cylces)</li> <li><code>SetOption15 0</code> (required to store value and make it reboot save)</li> </ul> <p><a href=#motor-wiring-diagrams>Wiring diagrams</a> for Normal, Stepper motor, and Short Circuit-Safe configurations are available at the end of this page. Even if the shutter does not have two motors, three wires have to be connected.</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p><strong>After setting the options for shutter mode, the device should be rebooted.</strong> Otherwise, the sliders won't be available in the web UI, and the <code>ShutterOpenDuration&lt;x&gt;</code>and <code>ShutterCloseDuration&lt;x&gt;</code> commands will report "Shutter unknown". </p> </div> <p>Issue <code>Shuttermode</code> command and check in console which <strong>ShutterMode</strong> is displayed: Issue <code>Status 13</code> command and check in console how the shutter is defined</p> <p>If you define <code>Shuttermode 1</code> and there is NO interlock defined on the relay the driver go into ERROR state. To solve define INTERLOCK on the relay pair and set it to ON. Then define <code>ShutterRelay1</code> again.</p> <div class=highlight><pre><span></span><code>Shutter accuracy digits: 1
Shutter 0 (Relay:1): Init. Pos: 20000 [100 %], Open Vel.: 100 Close Vel.: 100 , Max Way: 20000, Opentime 10.0 [s], Closetime 10.0 [s], CoedffCalc: c0: 0, c1 200, c2: 200, c3: 0, c4: 0, binmask 3, is inverted 1, &lt;span style=&quot;font-weight:bold;color:lime&quot;&gt;ShutterMode 0&lt;/span&gt;, motordelay 0
</code></pre></div> <h2 id=operation>Operation<a class=headerlink href=#operation title="Permanent link">~</a></h2> <p>Turning a device relay on or off directly (i.e., using <code>Power</code>) will function to affect a shutter's movement. In momentary mode (i.e., stepper motor), the relays start or stop the motor. The driver takes care of the direction and proper update of the shutter position.</p> <p>The shutter reports its position and can also be sent to a dedicated position. <code>ShutterPosition 0</code> means the shutter is closed and <code>ShutterPosition 100</code> means the shutter is open. If you need the position values reversed (<code>0</code> = open, <code>100</code> = closed), define and <a href=#calibration>calibrate your shutter as documented below</a>. Then tell Tasmota to reverse the shutter position meaning via the <code>ShutterInvert&lt;x&gt; 1</code> command. All internal calculations are the same (the log output is the same). Only the interaction with the user and other systems changes. Now <code>ShutterPosition&lt;x&gt; 0</code> will open the shutter and <code>ShutterPosition&lt;x&gt; 100</code> will close the shutter. </p> <table> <thead> <tr> <th>Function</th> <th>ShutterInvert 0</th> <th>ShutterInvert 1</th> </tr> </thead> <tbody> <tr> <td>Relay 1</td> <td>open shutter</td> <td>open shutter</td> </tr> <tr> <td>Relay 2</td> <td>close shutter</td> <td>close shutter</td> </tr> <tr> <td>Webbutton UP</td> <td>open shutter</td> <td>open shutter</td> </tr> <tr> <td>Webbutton DOWN</td> <td>close shutter</td> <td>close shutter</td> </tr> <tr> <td>Slider OPEN</td> <td>open shutter</td> <td>open shutter</td> </tr> <tr> <td>Slider CLOSE</td> <td>close shutter</td> <td>close shutter</td> </tr> <tr> <td>ShutterOpen</td> <td>open shutter</td> <td>open shutter</td> </tr> <tr> <td>ShutterClose</td> <td>close shutter</td> <td>close shutter</td> </tr> <tr> <td>ShutterPosition 100</td> <td>open shutter</td> <td>close shutter</td> </tr> <tr> <td>ShutterPosition 0</td> <td>close shutter</td> <td>open shutter</td> </tr> <tr> <td>Reported position when open</td> <td>100</td> <td>0</td> </tr> <tr> <td>Reported position when close</td> <td>0</td> <td>100</td> </tr> </tbody> </table> <p>To set a value to all shutter you can use the index 0. For example <code>ShutterPosition0 30</code> will move all shutters to 30%. The index 0 also works with all configuration items.</p> <p>When <code>SetOption80 1</code> is invoked you have to define <code>Shutterrelay1 &lt;value&gt;</code> to get started If possible to avoid any injury on unexpected movement all RELAYS should start in OFF mode when the device reboots: <code>PowerOnState 0</code> <img alt src=https://user-images.githubusercontent.com/34340210/65997878-3517e180-e468-11e9-950e-bfe299771233.png></p> <p>A maximum of four shutters per device are supported on ESP8266. The newer ESP32 can support up to 16 Shutters with 32 Relays. Nevertheless it might be required to add a GPIO expension board to get enough connectors.</p> <p><img alt src=https://user-images.githubusercontent.com/34340210/65997879-3517e180-e468-11e9-9c44-9ad4a4a970cc.png> </p> <p>To enable additional shutters, <code>ShutterRelay&lt;x&gt; &lt;value&gt;</code> must be executed for each additional shutter. Additional shutter declarations must be sequentially numbered, and without gaps (i.e., second shutter is 2, next shutter 3 and finally shutter 4).</p> <p>Disabling a shutter in the middle of the defined set of shutters will disable all other higher numbered shutters. If the disabled shutter is restored, the higher numbered shutters previously declared will also be restored. When a shutter is added or removed, a list of the active shutters, with their parameters, is output to the log. If you intend to remove shutters, explicitly remove each one beginning with the highest numbered shutter.</p> <p>With four shutters, eight <code>Relay&lt;x&gt;</code> components are needed. If manual operation switches (<code>Switch&lt;x&gt;</code> or <code>Button&lt;x&gt;</code> pairs) are also used, additional input GPIO are required. The ESP82xx device may not have enough free GPIO to support all the shutter connections required. A GPIO expander such as a <a href=../PCF8574/ >PCF8574</a> or <a href=../MCP230xx/ >MCP230xx</a> can be used with additional effort.</p> <p>When using a switch for manual operation <code>Switch&lt;x&gt;</code> pairs should usually be set to <code>SwitchMode&lt;x&gt; 2</code> (inverse follow) for proper switch behavior.</p> <p>Any shutter positioning can be locked <code>ShutterLock&lt;x&gt; 1</code>. Once executed an ongoing movement is finished while further positioning commands like <code>ShutterOpen&lt;x&gt;</code>, <code>ShutterClose&lt;x&gt;</code>, <code>ShutterStop&lt;x&gt;</code>, <code>ShutterPosition&lt;x&gt;</code>, ... as well as web UI buttons, web UI sliders, and shutter buttons are disabled. This can be used to lock an outdoor blind in case of high wind or rain. You may also disable shutter positioning games by your children. Shutter positioning can be unlocked using <code>ShutterLock&lt;x&gt; 0</code>. Please be aware that the shutter can still be moved by direct relay control (i.e., <code>Power&lt;x&gt;</code>), or physical switches and buttons. Use the <code>ShutterButton&lt;x&gt;</code> command prior to <code>ShutterLock</code> to be able to lock buttons.</p> <h2 id=autosetup-only-shelly-plus-2pm-esp32-based>AutoSetup (Only Shelly plus 2PM, ESP32 based)<a class=headerlink href=#autosetup-only-shelly-plus-2pm-esp32-based title="Permanent link">~</a></h2> <p>The shelly plus has enough memory and a power measuring unit to setup the shutter in a convenient way. First you must callibrate your mechanical endstops of the shutter. Please do as descibed in the documentation of your shutter motors to ensure the shutter will stop at the endpoint correctly.</p> <p>Then close the shutter until endstop is reached (repeat: <code>backlog shuttersetopen;shutterclose</code> until closed) - <code>interlock 1,2</code> - <code>interlock on</code> - <code>shutterrelay1 1</code> - <code>shuttersetup</code> (shutter will start moving....)</p> <p>After setup is started the shutter will move to the upper endpoint and close again. If the shutter stops somewhere in the middle, try again. After setup you can use your shutter. Initial callibration for <code>ShutterSetHalfway</code> is 70. If you want to have it more accurate: <code>backlog shutterclose;ShutterSetHalfway 50</code> and follow instructions below.</p> <h2 id=calibration>Calibration<a class=headerlink href=#calibration title="Permanent link">~</a></h2> <p><a href="https://www.youtube.com/watch?v=Z-grrvnu2bU">Shutter calibration video tutorial</a> </p> <p><a href="https://docs.google.com/spreadsheets/d/1-okVzGfdltbx8kMcObw4I0B22m9ZCQL3JgifgwjbzTc/edit?usp=sharing">Shutter calibration Google Spreadsheet</a></p> <ul> <li>Start your shutter in a closed position preferably. Set internal position to closed with <code>ShutterSetClose&lt;x&gt;</code>. </li> <li>Set the time needed to open the shutter completely with <code>ShutterOpenDuration&lt;x&gt;</code>. </li> <li>If the shutter opens more than needed, move it to the desired position with <code>ShutterSetPosition&lt;x&gt;</code> then set the position to fully open (100) with <code>ShutterSetOpen&lt;x&gt;</code> and decrease the open time. </li> <li>Set the time needed to close the shutters with <code>ShutterCloseDuration&lt;x&gt;</code>. </li> <li>If the shutter does not close completely, open again and adjust close time.</li> <li>If it runs too long, move it back to desired closed position with <code>ShutterSetPosition&lt;x&gt;</code>, reset to 0 with <code>ShutterSetClose&lt;x&gt;</code> and decrease open time.</li> <li>Alternate between opening and closing the shutter until you find out the exact times needed to get the same positions multiple times</li> </ul> <p>After calibration is complete, you might want to enable an additional 1 second motor movement with <code>ShutterEnableEndStopTime&lt;x&gt; 1</code> when the shutter is asked to move to its end positions (0% and 100%). With this you can guarantee that end positions are still reached in case of inaccuracies. Take care to disable this with <code>ShutterEnableEndStopTime&lt;x&gt; 0</code> before further open or close duration measurements.</p> <h3 id=motor-movement-delays>Motor Movement Delays<a class=headerlink href=#motor-movement-delays title="Permanent link">~</a></h3> <p>Some motors need up to one second after power is turned on before they start moving. You can confirm if you are having this issue if opening and closing as a single action works properly but doing this in smaller steps result in a shift of the position. </p> <ol> <li><code>Shutterposition&lt;x&gt; 30</code><br> Measure the shutter position. This is the <code>reference_position</code></li> <li><code>Shutterposition&lt;x&gt; 80</code><br> Measure the shutter position. This is the <code>max_position</code></li> <li><code>Shutterposition&lt;x&gt; 30</code><br> Return the shutter to starting position. This must be the same position as measured in step #1 (<code>reference_position</code>). If not, <code>ShutterCloseDuration</code> must be adjusted. </li> <li><code>Shutterposition&lt;x&gt; 50</code> </li> <li><code>Shutterposition&lt;x&gt; 70</code> </li> <li><code>Shutterposition&lt;x&gt; 80</code> <br> If you do not reach <code>max_position</code> you have a motor delay problem. Measure the shutter position. This is the <code>real_max</code>. Use this value in the calculation below. </li> <li><code>ShutterMotorDelay&lt;x&gt; &lt;delay&gt;</code><br> Motor <code>&lt;delay&gt;</code> calculation - fine tune in 0.05 second increments (e.g. <code>0.65</code>) as required.<br> <code>&lt;delay&gt; = ((max_position-real_max) / 2) / (((100/80) * max_position) / ShutterOpenDuration)</code></li> </ol> <p>Close the shutter and repeat this procedure until the motor delay is set properly. </p> <p>Following defaults are pre-compiled into the code and can only be changed by compiling you own binary and use the <code>user_config.override</code> - In Failsafe-Mode the driver waits for 0.1sec to let the direction relay execute and be stable before switching on the power relay starting the movement. The time in [ms] can be changed by adding following line with a different value: <code>#define SHUTTER_RELAY_OPERATION_TIME 100 // wait for direction relay 0.1sec before power up main relay</code></p> <h3 id=coarse-positioning-calibration-halfway-point-only>Coarse Positioning Calibration (Halfway point only)<a class=headerlink href=#coarse-positioning-calibration-halfway-point-only title="Permanent link">~</a></h3> <p>Some shutters need some time from totally closed until they begin moving the bottom-most part and opening. This often results in a shutter that is less than 50% open when the shutter has been operating for 50% of the set time. This can be corrected by using <code>ShutterSetHalfway&lt;x&gt;</code>. Use this procedure to calibrate the half-open position (alternatively there is a more exact calibration sequence using matrix values available in the next section):</p> <ol> <li><code>ShutterClose&lt;x&gt;</code> (confirm that the shutter is completely closed)</li> <li><code>ShutterSetHalfway&lt;x&gt; 50</code> (reset to default)</li> <li>Move the shutter to actual 50% open position.</li> <li>Use <code>ShutterPosition&lt;x&gt;</code> to inquire the shutter's current position and record the value. This value is a <strong>percentage of the total opening</strong> (e.g., <code>63</code> = 63% of opening).</li> <li><code>ShutterClose&lt;x&gt;</code></li> <li><code>ShutterSetHalfway&lt;x&gt; 63</code> (using the value from step #4 above)</li> <li><code>Restart 1</code></li> </ol> <h3 id=fine-positioning-calibration-calibration-matrix>Fine Positioning Calibration (Calibration Matrix)<a class=headerlink href=#fine-positioning-calibration-calibration-matrix title="Permanent link">~</a></h3> <p>If you desire that the %-opening closely match what <code>ShutterPosition&lt;x&gt;</code> and web UI indicate, there is a granular calibration matrix available. Ensure that <code>ShutterClose&lt;x&gt;</code> and <code>ShutterOpen&lt;x&gt;</code> moves the shutter more or less to the limit positions and follow this procedure:</p> <ol> <li><code>ShutterSetHalfway&lt;x&gt; 50</code> (reset to default)</li> <li><code>ShutterCalibration&lt;x&gt; 30 50 70 90 100</code> (reset to default)</li> <li><code>ShutterClose&lt;x&gt;</code></li> <li>Move the shutter to each of the following opening percentages and measure the shutter's position for each. <ol> <li><code>ShutterPosition&lt;x&gt; 30</code> (e.g., measurement = <code>15</code>)</li> <li><code>ShutterPosition&lt;x&gt; 50</code> (e.g., measurement = <code>50</code>)</li> <li><code>ShutterPosition&lt;x&gt; 70</code> (e.g., measurement = <code>100</code>)</li> <li><code>ShutterPosition&lt;x&gt; 90</code> (e.g., measurement = <code>150</code>)</li> <li><code>ShutterPosition&lt;x&gt; 100</code> (e.g., measurement = <code>180</code>)</li> </ol> </li> <li>Finally, enter the position measurements as the calibration values: <code>ShutterCalibration&lt;x&gt; 15 50 100 150 180</code> </li> </ol> <p><code>ShutterCalibration&lt;x&gt;</code> takes position measurements (<strong>not</strong> the time it takes to move). During calibration you position the shutter to an indicated percentage (e.g., <code>30%</code>) of opening and measure the shutter position (e.g., <code>15</code>). Use the same unit of measure for all your measurements (e.g., centimeters, inches, steps, etc.). After calibration <code>ShutterPosition&lt;x&gt; 30</code> will move to <code>30%</code> opening. This will be 30% from <code>180</code> (full open) == <code>54</code>. Now the percentage match the percent in cm/inch/steps.</p> <p>Notice that there is no calibration for the 10% position. On many shutters, there is no movement during the initial phase (i.e., nearly 10% of total time). Therefore the opening could be <code>0</code>. This measurement would cause an execution DIV 0 exception. Therefore the first calibration point is 30%. In most cases this is not a large opening so the calibration will be near enough. Yes, until ~10%, the position will be a bit "off" but not enough for concern. </p> <h2 id=motor-stop-time>Motor Stop time<a class=headerlink href=#motor-stop-time title="Permanent link">~</a></h2> <p>When shutters change direction immediatly it can happen that there is a short circuit or at least high moments on the motors. Therfore the default time between a STOP and the next START of the shutter is 0.5s = 500ms. This allows in most cases the shutter to fully stop and then start from a static position. With Version 12.3 you can change the duration through <code>shuttermotorstop 500</code> or any other value in ms. The value is for all defined shutters the same.</p> <p>WARNING: If you control the relay DIRECT through buttons or switches and do not use shutterbuttons or a rule to decouple it, then the MOTOSTOPTIME cannot kick in. The Relay is ON before the shutterdriver can intercept.</p> <h2 id=button-control>Button Control<a class=headerlink href=#button-control title="Permanent link">~</a></h2> <p>When shutter is running in <code>ShutterMode 1</code> (normal two relay up/off down/off), you already have basic control over the shutter movement using switches or buttons in the module configuration to directly drive the shutter relays. For short circuit safe operation <code>ShutterMode 2</code> direct control of the relays will not give you a nice user interface since you have to 1st set the direction with one switch/button and 2nd switch on the power by the other switch/button. Because the button controll use multi-press events ensure that the "immediate action" is disabled: <code>SetOption13 0</code> (default)</p> <p>To have shutter mode independent button control over the shutter and not over its relays one can use the <code>ShutterButton&lt;x&gt;</code> command. It also introduces some more features, see below:</p> <p><code>ShutterButton&lt;x&gt; &lt;button&gt; &lt;func&gt; &lt;mqtt&gt;</code> </p> <p>This assigns a Tasmota button <code>&lt;button&gt;</code> to control your shutter <code>&lt;x&gt;</code> having functionality <code>&lt;func&gt;</code>. The Tasmota button <code>&lt;button&gt;</code> must already be configured in the module configuration. You can assign multiple buttons to a single shutter. Any button can only control one shutter (beside the <code>&lt;mqtt&gt;</code> broadcast feature, see description below). Any press of the button while the shutter is moving will immediately stop the shutter.</p> <p>One can remove all button control for shutter <code>&lt;x&gt;</code> by <code>ShutterButton&lt;x&gt; 0</code>. </p> <p>The assigned button can have one of the following functionalities:<br></p> <ul> <li> <p>Setup for an "up" button: <code>ShutterButton&lt;x&gt; &lt;button&gt; up &lt;mqtt&gt;</code> <br> Single press will move shutter to 100%, double press to 50% and triple press to 74%. Holding the button for more than the hold time (<a href=../Commands/#setoption32><code>SetOption32</code></a>) moves all shutters with same <code>&lt;grouptopic&gt;</code> to 100% when <code>&lt;mqtt&gt;</code> is equal to <code>1</code>. When <code>&lt;mqtt&gt;</code> is equal to <code>0</code> hold action of this button is same as single press.</p> </li> <li> <p>Setup for a "down" button: <code>ShutterButton&lt;x&gt; &lt;button&gt; down &lt;mqtt&gt;</code> <br> Single press will move shutter to 0%, double press to 50% and triple press to 24%. Holding the button for more than the hold time (SetOption32) moves all shutters with same <code>&lt;grouptopic&gt;</code> to 0% when <code>&lt;mqtt&gt;</code> is equal to <code>1</code>. When <code>&lt;mqtt&gt;</code> is equal to <code>0</code> hold action of this button is same as single press. </p> </li> <li> <p>Setup for an "updown" button: <code>ShutterButton&lt;x&gt; &lt;button&gt; updown &lt;mqtt&gt;</code> <br> Single press will move shutter to 100%, double press down to 0% and triple press to 50%. No hold action and no other shutter control by MQTT, <code>&lt;mqtt&gt;</code> is don't care here.</p> </li> <li> <p>Setup for a "toggle" button: <code>ShutterButton&lt;x&gt; &lt;button&gt; toggle &lt;mqtt&gt;</code> Single press will toggle shutter, double press will move it to 50%. Be aware that the toggle select direction based on the current position. If the position is between 0..50% the shutter move to 100%. If the position is 51%..100% it moves to 0%. No hold action and no other shutter control by MQTT, <code>&lt;mqtt&gt;</code> is don't care here.</p> </li> </ul> <p>More advanced control of the button press actions is given by the following <code>ShutterButton&lt;x&gt;</code> command syntax:</p> <p><code>ShutterButton&lt;x&gt; &lt;button&gt; &lt;p1&gt; &lt;p2&gt; &lt;p3&gt; &lt;ph&gt; &lt;m1&gt; &lt;m2&gt; &lt;m3&gt; &lt;mh&gt; &lt;mi&gt;</code> </p> <p><code>&lt;button&gt;</code> ESP8266:<code>1..4</code>,ESP32:<code>1..32</code> : Button number, <code>0/-</code>: disable buttons for this shutter<br><code>&lt;p1&gt;</code> <code>0..100</code>: single press position, <code>t</code>: toggle, <code>-</code>: disable, <code>--0..100</code> or <code>++0..100</code> single press increment position<br><code>&lt;p2&gt;</code> <code>0..100</code>: double press position, <code>t</code>: toggle, <code>-</code>: disable, <code>--0..100</code> or <code>++0..100</code> double press increment position<br><code>&lt;p3&gt;</code> <code>0..100</code>: triple press position, <code>t</code>: toggle, <code>-</code>: disable, <code>--0..100</code> or <code>++0..100</code> tripple press increment position<br><code>&lt;ph&gt;</code> <code>0..100</code>: hold press position, shutter stop after releasing the hold button if no group send <code>&lt;mh&gt;</code> is defined. If<code>&lt;mh&gt;</code> is 1 the release of the botton will NOT stop any shutter, <code>t</code>: toggle, <code>-</code>: disable<br><code>&lt;m1&gt;</code> <code>1</code>: enable single press position MQTT broadcast, <code>0/-</code>: disable<br><code>&lt;m2&gt;</code> <code>1</code>: enable double press position MQTT broadcast, <code>0/-</code>: disable<br><code>&lt;m3&gt;</code> <code>1</code>: enable triple press position MQTT broadcast, <code>0/-</code>: disable<br><code>&lt;mh&gt;</code> <code>1</code>: enable hold press position MQTT broadcast, <code>0/-</code>: disable<br><code>&lt;mi&gt;</code> <code>1</code>: enable MQTT broadcast to all shutter indices, <code>0/-</code>: disable</p> <p>Parameters are optional. When missing, all subsequent parameters are set to <code>disable</code>.</p> <p>ESP32 only: <code>&lt;p0..h&gt;</code> can be optional extended with a dedicated position of the tilt if a venetian blind is configured and supported. The position of the tilt can be added after the normal position with a <code>/</code> as seperator. This is optional. Example: <code>shutterbutton1 1 100/-90 50/0 75/-90 100 - - 1 1</code>. Tilt and position also support increment or decrement position from current state with <code>--</code>oder <code>++</code>.</p> <p>By a button single press the shutter is set to position <code>&lt;p1&gt;</code>. Double press will drive the shutter to position <code>&lt;p2&gt;</code> and triple press to position <code>&lt;p3&gt;</code>. Holding the button for more than the <code>SetOption32</code> time sets the shutter position to <code>&lt;ph&gt;</code> max if button is hold until position. If the hold button is released during the shutter moves the shutter will stop. Any button action <code>&lt;p1&gt;</code> to <code>&lt;ph&gt;</code> can be disabled by setting the parameter to <code>-</code>. Independent from configuration <code>&lt;p1&gt;</code> to <code>&lt;ph&gt;</code> any press of the button while the shutter is moving will immediately stop the shutter.</p> <p>Ensure that you set a value higher than 5 for <code>SetOption32</code> (0.6 seconds is the minimum possible time). Lower values will not trigger the hold action for <code>ShutterButton</code>, and the shutter will not move.</p> <p>Global steering of all your shutters at home is supported by additional MQTT broadcast. By any button action a corresponding MQTT command can be initiated to the <code>&lt;grouptopic&gt;</code> of the device. For single press this can be enabled by <code>&lt;m1&gt;</code> equal to <code>1</code>, disabling is indicated by <code>-</code>. Double to hold MQTT configurations are given by <code>&lt;m2&gt;</code> to <code>&lt;mh&gt;</code>, correspondingly. When <code>&lt;mi&gt;</code> is equal to <code>-</code> only <code>cmnd/&lt;grouptopic&gt;/Shutterposition&lt;x&gt; &lt;p1..h&gt;</code> is fired. When <code>&lt;mi&gt;</code> is equal to <code>1</code>, <code>&lt;x&gt;</code>=<code>1..4</code> is used to control any shutter number of a Tasmota device having same <code>&lt;grouptopic&gt;</code>.</p> <div class=highlight><pre><span></span><code>ShutterButton&lt;x&gt; &lt;button&gt; 100 50 74 100 0 0 0 1 1` is same as `ShutterButton&lt;x&gt; &lt;button&gt; up 1
ShutterButton&lt;x&gt; &lt;button&gt; 0 50 24 0 0 0 0 1 1` is same as `ShutterButton&lt;x&gt; &lt;button&gt; down 1
ShutterButton&lt;x&gt; &lt;button&gt; 100 0 50 - 0 0 0 0 0` is same as `ShutterButton&lt;x&gt; &lt;button&gt; updown 0
ShutterButton&lt;x&gt; &lt;button&gt; t 50 - - 0 0 0 0 0` is same as `ShutterButton&lt;x&gt; &lt;button&gt; toggle 0
</code></pre></div> <p>Module WiFi setup, restart, upgrade and reset according to <a href=../Buttons-and-Switches/ >Buttons and Switches</a> are supported "child and fool proof" only when no button restriction (<a href=../Commands/#setoption1><code>SetOption1</code></a>) is given and when all configured shutter buttons of that shutter are pressed 5x, 6x, 7x times or hold long simultaneously.</p> <h2 id=remote-control>Remote Control<a class=headerlink href=#remote-control title="Permanent link">~</a></h2> <p>Use any other Tasmota device with buttons or switches to control remotely a shutter using rules. Similar behavior as direct button control can be achieved by applying <code>ShutterStopClose, ShutterStopOpen, ShutterStopToggle, ShutterStopPosition</code> commands. They stop shutter movement if it is in motion and otherwise execute close, open, toggle or position commands.</p> <p>Run this rule on another Tasmota device with a switch configured.</p> <div class=highlight><pre><span></span><code>rule1 on switch1#state=2 do publish cmnd/%shutter-topic%/ShutterStopToggle endon
</code></pre></div> <h2 id=using-rules>Using Rules<a class=headerlink href=#using-rules title="Permanent link">~</a></h2> <p>Shutters can be used in rules to react on sensor data. Durign shutter operations data from all shutters is send every second to inform about current position, target, direction and the tilt (if supported). As usual with rules the compare operator can be used. Examples:</p> <div class=highlight><pre><span></span><code>rule1 on shutter1#direction=0 do &lt;echo shutter1 stopped&gt; endon
rule1 on shutter2#position do var1 = %value% endon
rule1 on shutter#moving do &lt;echo at least one shutter start moving&gt; endon
rule1 on shutter#moved do &lt;echo on shutter just stopped moving&gt; endon
</code></pre></div> <p>Additionally all commands are send as rules and can be used to trigger an action</p> <div class=highlight><pre><span></span><code>rule1 on shutterposition1=0 do &lt;echo shutter 1 is closing&gt; endon
</code></pre></div> <h2 id=specific-configuration>Specific Configuration<a class=headerlink href=#specific-configuration title="Permanent link">~</a></h2> <div class="admonition note"> <p class=admonition-title>Note</p> <p>The PWM remains on even after the end position has been reached. The motor then permanently tries to hold the position and could thereby trigger noises or a slight "twitching". If this is not desired, you can switch off the PWM after reaching the end position with <code>#define SHUTTER_CLEAR_PWM_ONSTOP</code>. </p> </div> <h3 id=pulse-motors>Pulse Motors<a class=headerlink href=#pulse-motors title="Permanent link">~</a></h3> <p>There are shutters that have two or three relays but only need a pulse to start or stop. Depending on the current situation a pulse will stop the shutter or send it into a specific direction. To use these kinds of shutters a <a href=../Commands/#pulsetime><code>PulseTime</code></a> must be defined on each relay. The minimum setting that seems to make it work consistently is <code>2</code>. A setting of <code>1</code> does not work. If the shutter moves too fast and does not react to a stop command, increase the setting to <code>3</code> or <code>4</code>. If there is a dedicated relay for STOP and the other relays are only for OPEN and CLOSE you can enable this configuration e.g. on shutter one through: <code>shutterStopRelay1 1</code>. In this case a pulse will send to RELAY3 for stop and RELAY1 is for OPEN and RELAY2 for CLOSE only. </p> <h3 id=stepper-motors>Stepper Motors<a class=headerlink href=#stepper-motors title="Permanent link">~</a></h3> <p>Stepper motors can also be used to operate shutters and blinds. Additionally you can operate sliding doors with this configuration. Currently ESP32 12.0.2 does not support shutter with stepper motors. ESP8266 and ESP32 12.0.3+ supports up to 4 shutters. </p> <h3 id=servo-motors>Servo Motors<a class=headerlink href=#servo-motors title="Permanent link">~</a></h3> <p>Servos are small devices with typical 180° or 360" rotation movement. The position will be drived by the PWM duty cycle time. This will all automatically calculated</p> <p>If you miss low angles (i.e 2°) you should be able to get this by changing the minimum <code>ShutterPWMRange</code>. If this does not help you can customize <code>PwmFrequency</code>. Normally for PWM servos, there is no calibration required, but you have the option to do a calibration. Check the documentation for shuttercallibration. Maybe <code>ShutterSetHalfway</code> is already enough. Otherwise you can do a fine granular calibration.</p> <p>If you change the shutteropenduration/closeduration the servo will operate slower, but now the servo also achieves small angle changes.</p> <p>Servo controlled by PWM pulses. The angle to which the servo should be set is regulated by the pulse width. The servo has no direction of rotation (clockwise or counterclockwise), but only the rotation angle of the output shaft.</p> <p>Servo controlled by PWM pulses. The angle to which the servo should be set is regulated by the pulse width. The servo has no direction of rotation (clockwise or counterclockwise), but only the rotation angle of the output shaft.</p> <p>To operate a servo requires signal uses:</p> <ul> <li><code>EN</code> (enable) turn on / off servo.</li> <li><code>PLS</code> (pulse) for controls rotation angl.</li> <li><code>DIR</code> (direction) only shows the direction of rotation, but does not control it.</li> </ul> <h4 id=more-information>More information:<a class=headerlink href=#more-information title="Permanent link">~</a></h4> <ul> <li><a href=https://en.wikipedia.org/wiki/Servo_control>Wikipedia</a></li> <li><a href=https://github.com/arendst/Tasmota/discussions/10387>How to Mod a Servo to Get Closed Loop Feedback</a></li> <li><a href=https://hackaday.io/project/17079-mocoder-magnetic-encoder>as5600 + Servo motor</a></li> </ul> <h4 id=example-configuration>Example configuration<a class=headerlink href=#example-configuration title="Permanent link">~</a></h4> <p><code>EN</code> and <code>DIR</code> are on <code>Relay1</code> and <code>Relay2</code> respectively. Remember to use a <strong>non-inverse relay</strong> for the enable signal. The <code>PLS</code> signal is assigned as a <code>PWM&lt;x&gt;</code> component where <code>&lt;x&gt;</code> matches the number of the shutter (e.g., <code>PWM1</code> for <code>Shutter1</code>).</p> <p>The PWM frequency must be set with the <code>PWMfrequency 200</code> command. The frequency setting is a global setting all PWM components on the device. This means that all shutters on the device will operate at the same speed.</p> <p>Using the <code>ShutterMotorDelay</code> command to provide a slow increase / decrease in speed. This causes the driver to ramp the speed up and down during the defined duration. The change of the ShutterMotorDelay does NOT change the distance the shutter makes. This is very convinent to trim the accelerate and decelerate rate without changeing the distance.</p> <p><code>ShutterOpenDuration</code> and <code>ShutterCloseDuration</code> define the open / close time. By changing the times you adjust the speed of the servo output shaft. <code>ShutterOpenDuration</code> and <code>ShutterCloseDuration</code> can be different.</p> <p>Using the <code>ShutterPwmRange</code> command to set the pulse width range. The calculation of parameters for <code>ShutterPwmRange</code> is obtained by dividing by 5 the minimum and maximum values of the pulse width range.</p> <h4 id=note>Note!<a class=headerlink href=#note title="Permanent link">~</a></h4> <p>Even within the same servo model, there may be manufacturing tolerances that result in a different operating range of pulse lengths. For accurate operation, each specific servo must be calibrated: through experiments, it is necessary to select the correct range that is specific to it.</p> <p>For example the pulse width range for different servos:</p> <ul> <li>Servo MG90 (180°): pulse width range 544 - 2400microseconds, <code>ShutterPwmRange</code> 109, 480</li> <li>Servo TD-8130MG (180°): pulse width range 500 - 2500microseconds, <code>ShutterPwmRange</code> 100, 500</li> </ul> <h4 id=servo-datasheet>Servo datasheet:<a class=headerlink href=#servo-datasheet title="Permanent link">~</a></h4> <ul> <li><a href=https://raw.githubusercontent.com/TrDA-hab/Projects/master/Servo%2BESP8266/MG90S-Datasheet.pdf>Servo MG90</a></li> <li><a href=https://raw.githubusercontent.com/TrDA-hab/Projects/master/Servo%2BESP8266/TD-8130MG.jpg>Servo TD-8130MG</a></li> <li><a href=https://raw.githubusercontent.com/TrDA-hab/Projects/master/Servo%2BESP8266/DS5160ssg.jpg>Servo DS5160ssg</a></li> </ul> <h4 id=how-to-use-it>How to use it:<a class=headerlink href=#how-to-use-it title="Permanent link">~</a></h4> <table> <thead> <tr> <th style="text-align: center;">Wemos Pin</th> <th style="text-align: center;">GPIO</th> <th style="text-align: center;">Component</th> <th style="text-align: center;">Servo Signal</th> </tr> </thead> <tbody> <tr> <td style="text-align: center;">D3</td> <td style="text-align: center;">0</td> <td style="text-align: center;">Relay1</td> <td style="text-align: center;">EN</td> </tr> <tr> <td style="text-align: center;">D4</td> <td style="text-align: center;">2</td> <td style="text-align: center;">PWM1</td> <td style="text-align: center;">PLS</td> </tr> <tr> <td style="text-align: center;">D5</td> <td style="text-align: center;">14</td> <td style="text-align: center;">Relay2</td> <td style="text-align: center;">DIR</td> </tr> </tbody> </table> <p><strong>Important: Please do the first start after configure without any load on the servo. If the shutterposition and servo position are not in sync the servo will change to the start position without speed and acceleration control like later in normal operation.</strong></p> <ul> <li>Run commands in the console to run the "Shutter" mode (you must first configure the GPIO!):<br> <code>SetOption80 1</code> // enable Shutters support.<br> <code>shutterrelay1 1</code> // Define that RELAY1 is for ON/OFF and PWM1 drive position<br> <code>Shuttermode 5</code> // enable Shutter mode for servo.<br> <code>PWMfrequency 200</code> // this is a global variable for all Servos.<br> <code>SetOption15 0</code> // to control the storage of values. </li> <li>Run commands in the console to configure the motor operation:<br> <code>ShutterPwmRange1 100, 500</code> //this is a global variable for all Servos.<br> <code>ShutterOpenDuration1 0.5</code> // define the open time, in seconds.<br> <code>ShutterCloseDuration1 0.5</code> // define the close time, in seconds.<br> <code>ShutterMotorDelay1 0.2</code> // servo does not like abrupt start / stop.<br> <code>Restart 1</code> </li> <li>Run commands in the consolee to test the motor operation:<br> <code>ShutterOpen1</code> // to open the SERVO#1.<br> <code>ShutterStop1</code> // to stop the SERVO#1.<br> <code>ShutterClose1</code> // to close the SERVO#1. </li> <li>Perform the <a href=https://tasmota.github.io/docs/Blinds-and-Shutters/#calibration>shutter calibration</a> (optional).</li> </ul> <h4 id=motor-wiring-diagrams>Motor Wiring Diagrams<a class=headerlink href=#motor-wiring-diagrams title="Permanent link">~</a></h4> <h5 id=one-shutter>One Shutter<a class=headerlink href=#one-shutter title="Permanent link">~</a></h5> <p><img alt=511 src=https://raw.githubusercontent.com/TrDA-hab/Projects/master/Servo%2BESP8266/511.jpg></p> <ul> <li>Diagram v512: Minimum configuration for one servo, power on continuously. <img alt=512 src=https://raw.githubusercontent.com/TrDA-hab/Projects/master/Servo%2BESP8266/512.jpg></li> </ul> <h5 id=dual-shutter>Dual Shutter<a class=headerlink href=#dual-shutter title="Permanent link">~</a></h5> <p><img alt=521 src=https://raw.githubusercontent.com/TrDA-hab/Projects/master/Servo%2BESP8266/521.jpg></p> <ul> <li>Diagram v522: Optimal configuration for two servos, power is supplied through the relay. <img alt=522 src=https://raw.githubusercontent.com/TrDA-hab/Projects/master/Servo%2BESP8266/522.jpg></li> <li>Diagram v532: Maximum configuration for two servos, power is supplied via the relay only if the servo is running. Current control for each servo drive via INA219. <img alt=532 src=https://raw.githubusercontent.com/TrDA-hab/Projects/master/Servo%2BESP8266/532.jpg></li> </ul> <h4 id=additional-information>Additional Information:<a class=headerlink href=#additional-information title="Permanent link">~</a></h4> <p><img alt src=https://raw.githubusercontent.com/TrDA-hab/Projects/master/Servo%2BESP8266/Servo-2%20v8.jpg> <img alt src=https://raw.githubusercontent.com/TrDA-hab/Projects/master/Servo%2BESP8266/Servo1%20v12.jpg> <img alt src=https://raw.githubusercontent.com/TrDA-hab/Projects/master/Servo%2BESP8266/20210106_171232.jpg> <img alt src=https://raw.githubusercontent.com/TrDA-hab/Projects/master/Servo%2BESP8266/20210106_171217.jpg></p> <h3 id=dc-motors>DC Motors<a class=headerlink href=#dc-motors title="Permanent link">~</a></h3> <p><a href=https://github.com/arendst/Tasmota/discussions/10387>More info</a></p> <h3 id=smooth-ramp-up-and-ramp-down-support>Smooth RAMP-UP and RAMP-DOWN Support<a class=headerlink href=#smooth-ramp-up-and-ramp-down-support title="Permanent link">~</a></h3> <p>Servos and Steppers also have a velocity control. With <code>ShutterMotorDelay&lt;x&gt; 1.5</code> you can define a 1.5second soft start/stop before the device reaches it final moving speed. Usefull for moving heavy items like doors.</p> <h3 id=using-normal-motors>using normal Motors<a class=headerlink href=#using-normal-motors title="Permanent link">~</a></h3> <h4 id=short-circuit-safe-wire-configuration-with-a-pcf-as-digital-io-avoid-electrical-shortage-also-on-wrong-configuration>Short Circuit safe wire configuration with a PCF as digital I/O. Avoid electrical shortage also on wrong configuration.<a class=headerlink href=#short-circuit-safe-wire-configuration-with-a-pcf-as-digital-io-avoid-electrical-shortage-also-on-wrong-configuration title="Permanent link">~</a></h4> <p><img alt=ShortCicuitSafe src=https://user-images.githubusercontent.com/34340210/65997877-3517e180-e468-11e9-9b8c-2f0787f977f6.png></p> <!-- outdated log output
#### Sample Log Output
Typical log output (log level `3`) when starting from `ShutterOpen1`. The first command is `ShutterClose1`. After closing, open it to 50% with `ShutterPosition1 50`  
<div class="highlight"><pre><span></span><code>13:56:56.073 RSL: RESULT = {&quot;ShutterClose1&quot;:0}
13:56:59.763 CMD: shutteropen
13:56:59.779 RSL: RESULT = {&quot;POWER2&quot;:&quot;OFF&quot;}
13:56:59.781 RSL: POWER2 = OFF
13:56:59.787 RSL: RESULT = {&quot;POWER1&quot;:&quot;ON&quot;}
13:56:59.788 RSL: POWER1 = ON
13:56:59.790 RSL: RESULT = {&quot;ShutterOpen1&quot;:100}
13:56:59.817 RSL: RESULT = {&quot;Shutter1&quot;:{&quot;Position&quot;:0,&quot;Direction&quot;:1,&quot;Target&quot;:100}}
13:57:00.429 RSL: RESULT = {&quot;Shutter1&quot;:{&quot;Position&quot;:7,&quot;Direction&quot;:1,&quot;Target&quot;:100}}
13:57:01.451 RSL: RESULT = {&quot;Shutter1&quot;:{&quot;Position&quot;:17,&quot;Direction&quot;:1,&quot;Target&quot;:100}}
13:57:02.427 RSL: RESULT = {&quot;Shutter1&quot;:{&quot;Position&quot;:27,&quot;Direction&quot;:1,&quot;Target&quot;:100}}
13:57:03.409 RSL: RESULT = {&quot;Shutter1&quot;:{&quot;Position&quot;:36,&quot;Direction&quot;:1,&quot;Target&quot;:100}}
13:57:04.432 RSL: RESULT = {&quot;Shutter1&quot;:{&quot;Position&quot;:47,&quot;Direction&quot;:1,&quot;Target&quot;:100}}
13:57:05.455 RSL: RESULT = {&quot;Shutter1&quot;:{&quot;Position&quot;:57,&quot;Direction&quot;:1,&quot;Target&quot;:100}}
13:57:06.429 RSL: RESULT = {&quot;Shutter1&quot;:{&quot;Position&quot;:67,&quot;Direction&quot;:1,&quot;Target&quot;:100}}
13:57:07.449 RSL: RESULT = {&quot;Shutter1&quot;:{&quot;Position&quot;:77,&quot;Direction&quot;:1,&quot;Target&quot;:100}}
13:57:08.420 RSL: RESULT = {&quot;Shutter1&quot;:{&quot;Position&quot;:86,&quot;Direction&quot;:1,&quot;Target&quot;:100}}
13:57:09.445 RSL: RESULT = {&quot;Shutter1&quot;:{&quot;Position&quot;:97,&quot;Direction&quot;:1,&quot;Target&quot;:100}}
13:57:09.802 RSL: RESULT = {&quot;POWER1&quot;:&quot;OFF&quot;}
13:57:09.804 RSL: POWER1 = OFF
13:57:10.308 RSL: SHUTTER1 = 100
13:57:10.309 RSL: RESULT = {&quot;Shutter1&quot;:{&quot;Position&quot;:100,&quot;Direction&quot;:0,&quot;Target&quot;:100}}
13:57:16.174 CMD: shutterposition 50
13:57:16.190 RSL: RESULT = {&quot;POWER2&quot;:&quot;ON&quot;}
13:57:16.192 RSL: POWER2 = ON
13:57:16.198 RSL: RESULT = {&quot;POWER1&quot;:&quot;ON&quot;}
13:57:16.199 RSL: POWER1 = ON
13:57:16.201 RSL: RESULT = {&quot;ShutterPosition1&quot;:50}
13:57:16.229 RSL: RESULT = {&quot;Shutter1&quot;:{&quot;Position&quot;:100,&quot;Direction&quot;:-1,&quot;Target&quot;:50}}
13:57:16.433 RSL: RESULT = {&quot;Shutter1&quot;:{&quot;Position&quot;:98,&quot;Direction&quot;:-1,&quot;Target&quot;:50}}
13:57:17.422 RSL: RESULT = {&quot;Shutter1&quot;:{&quot;Position&quot;:89,&quot;Direction&quot;:-1,&quot;Target&quot;:50}}
13:57:18.445 RSL: RESULT = {&quot;Shutter1&quot;:{&quot;Position&quot;:78,&quot;Direction&quot;:-1,&quot;Target&quot;:50}}
13:57:19.413 RSL: RESULT = {&quot;Shutter1&quot;:{&quot;Position&quot;:69,&quot;Direction&quot;:-1,&quot;Target&quot;:50}}
13:57:20.436 RSL: RESULT = {&quot;Shutter1&quot;:{&quot;Position&quot;:58,&quot;Direction&quot;:-1,&quot;Target&quot;:50}}
13:57:21.265 RSL: RESULT = {&quot;POWER1&quot;:&quot;OFF&quot;}
13:57:21.267 RSL: POWER1 = OFF
13:57:21.273 RSL: RESULT = {&quot;POWER2&quot;:&quot;OFF&quot;}
13:57:21.274 RSL: POWER2 = OFF
13:57:21.778 RSL: SHUTTER1 = 50
13:57:21.780 RSL: RESULT = {&quot;Shutter1&quot;:{&quot;Position&quot;:50,&quot;Direction&quot;:0,&quot;Target&quot;:50}}
</code></pre></div>
--> <h3 id=using-stepper-motors>using Stepper Motors<a class=headerlink href=#using-stepper-motors title="Permanent link">~</a></h3> <p>Stepper motors can be used to operate shutters and blinds. The configuration is very similar to the Circuit Safe (Shuttermode 1) configuration. To operate a stepper motor requires driver module such as the A4988 and uses EN (enable), DIR (direction), STP (Stepper) for controls. If everything is defined correctly Shuttermode 4 will be reported at boot time. ESP8266 only supports one shutter with steppermotors. ESP32 up to 4.</p> <p>Tasmota supports a maximum of four shutters with one stepper motor per shutter simultaneously. In very rare conditions where two or more shutters simultaneously move the last mm it can happen than one shutter moves to far. </p> <ul> <li>Stepper drivers configuration tutorials: <ul> <li><a href=https://lastminuteengineers.com/a4988-stepper-motor-driver-arduino-tutorial/ >A4988</a></li> <li><a href=https://lastminuteengineers.com/drv8825-stepper-motor-driver-arduino-tutorial/ >DRV8825</a></li> <li><a href=https://wiki.fysetc.com/TMC2208/ >TMC2208</a> </li> </ul> </li> <li>Modifying a 28BYJ-48 12V stepper motor from unipolar to bipolar <a href=https://coeleveld.com/wp-content/uploads/2016/10/Modifying-a-28BYJ-48-step-motor-from-unipolar-to-bipolar.pdf>tutorial</a> </li> <li><a href=#bill-of-materials>Bill of Materials</a> </li> </ul> <h4 id=example-configuration_1>Example configuration<a class=headerlink href=#example-configuration_1 title="Permanent link">~</a></h4> <p><code>EN</code> and <code>DIR</code> are on <code>Relay1i</code> and <code>Relay2</code> respectively. Please be aware to use the <strong>inverse</strong> relay for the enable signal. </p> <p>The <code>STP</code> signal is assigned as a <code>PWM&lt;x&gt;</code> component where <code>&lt;x&gt;</code> matches the number of the shutter (e.g., <code>PWM1</code> for <code>Shutter1</code>). The shutter feature adjusts the PWM frequency to operate the motor for proper shutter operation. The stepper motor frequency setting is a global setting all PWM components on the device. This means that all shutters on the device will operate at the same speed. Therefore no PWM devices other than shutters can be connected to the same Tasmota device. To get in the UI the light sliders hidden you must set <code>setoption15 0</code></p> <p>The frequency of the PWM can be changed from 1000Hz to any value up to 10,000Hz. The command <code>ShutterFrequency</code> globally changes this. Be aware that most 12V operated motors cannot work faster than 2,000Hz. 5,000Hz.10,000Hz is possible by increasing the supplied voltage to 24V and use <code>ShutterMotorDelay</code> to allow a slow speed up/speed down. The maximum voltage of the A4988 is 36V. The TMC2208 is much more silent than the others but also significant slower and does not like high frequencies. For example, the speed at 24V is half o A4988</p> <p>Finally a GPIO <strong>must</strong> be assigned as <code>Counter1</code>. This counter is used to keep track of the steps and send the stepper to the correct position. The <code>Counter1</code> GPIO must be connected to the <code>PWM1</code> GPIO. Otherwise the stepper and your shutter will run continually or freeze up randomly.</p> <p>Only <strong>bipolar</strong> stepper motors may be used (see above). </p> <p>You must properly configure the stepper motor driver (see above).</p> <p><code>ShutterOpenDuration</code> and <code>ShutterCloseDuration</code> can be different. Shutter with Stepper motors always match positions exact. There is no need to vary <code>ShutterOpenDuration</code> and <code>ShutterCloseDuration</code>. Anyhow, if you decrease <code>ShutterCloseDuration</code> the Shutter will close with a higher speed on a virtual higher <code>ShutterFrequency</code> if possible. Same vice versa.</p> <p>You can define a soft start/stop by defining a <code>ShutterMotorDelay</code>. This causes the driver to ramp the speed up and down during the defined duration. The change of the <code>ShutterMotorDelay</code> does NOT change the distance the shutter makes. This is very convenient to trim the accelerate and decelerate rate without changing the distance.</p> <table> <thead> <tr> <th style="text-align: center;">Wemos Pin</th> <th style="text-align: center;">GPIO</th> <th style="text-align: center;">Component</th> <th style="text-align: center;">Stepper Signal</th> </tr> </thead> <tbody> <tr> <td style="text-align: center;">D1</td> <td style="text-align: center;">5</td> <td style="text-align: center;">Relay1i</td> <td style="text-align: center;">EN</td> </tr> <tr> <td style="text-align: center;">D2</td> <td style="text-align: center;">4</td> <td style="text-align: center;">Relay2</td> <td style="text-align: center;">DIR</td> </tr> <tr> <td style="text-align: center;">D3</td> <td style="text-align: center;">0</td> <td style="text-align: center;">PWM1</td> <td style="text-align: center;">STP</td> </tr> <tr> <td style="text-align: center;">D4</td> <td style="text-align: center;">2</td> <td style="text-align: center;">Counter1</td> <td style="text-align: center;">STP</td> </tr> </tbody> </table> <p><strong>a) Set ShutterMode 4</strong><br> <code>Backlog PulseTime1 0; PulseTime2 0</code> // for relay Relay1i and Relay2<br> <code>Interlock OFF</code> // this is a global variable for all Relays or at least the RELAYS NOT in the Interlock group <code>setoption15 0</code> // remove any light sliders from the UI PWM1 and COUNTER1 defined</p> <p><strong>b) Enable Shutters</strong><br> <code>SetOption80 1</code> // this is a global variable for all Shutters </p> <p><strong>c) Configure Shutter 1 and test ShutterMode 1 is working</strong><br> <code>ShutterRelay1 1</code> // for relay Relay1i and Relay2</p> <p><strong>d) Set the stepper motor speed (optional setting)</strong><br> <code>ShutterFrequency 1500</code> // this is a global variable for all steppers (1000rpm by default)</p> <p><strong>e) Set at least a small ramp-up/ramp down period 1.0 second (optional)</strong><br> <code>ShutterMotorDelay1 1.0</code> // Stepper do not like infinite momentum. Ramp up/down speed allow much higher frequencies.</p> <p><strong>f) Restart Tasmota</strong><br> <code>Restart 1</code></p> <p><strong>g) Test the shutter</strong><br> <code>ShutterOpen1</code> <br> <code>ShutterStop1</code> // to stop the STEPPER1<br> <code>ShutterClose1</code><br> <code>ShutterInvert1</code> // to change the direction of rotation of the STEPPER1 </p> <p><strong>h) Perform the <a href=./#calibration>shutter calibration</a></strong> </p> <h4 id=configuration-for-additional-shutters>Configuration for additional shutters<a class=headerlink href=#configuration-for-additional-shutters title="Permanent link">~</a></h4> <p>You must first set up the first shutter and only then the next. </p> <table> <thead> <tr> <th style="text-align: center;">Wemos Pin</th> <th style="text-align: center;">GPIO</th> <th style="text-align: center;">Component</th> <th style="text-align: center;">Stepper Signal</th> </tr> </thead> <tbody> <tr> <td style="text-align: center;">D5</td> <td style="text-align: center;">14</td> <td style="text-align: center;">Relay3i</td> <td style="text-align: center;">EN</td> </tr> <tr> <td style="text-align: center;">D6</td> <td style="text-align: center;">12</td> <td style="text-align: center;">Relay4</td> <td style="text-align: center;">DIR</td> </tr> <tr> <td style="text-align: center;">D7</td> <td style="text-align: center;">13</td> <td style="text-align: center;">PWM2</td> <td style="text-align: center;">STP</td> </tr> <tr> <td style="text-align: center;">D8</td> <td style="text-align: center;">15</td> <td style="text-align: center;">Counter2</td> <td style="text-align: center;">STP</td> </tr> </tbody> </table> <p><strong>a) Set ShutterMode 4</strong><br> <code>Backlog PulseTime3 0; PulseTime4 0</code> // for relay Relay3i and Relay4<br> PWM2 and COUNTER2 defined</p> <p><strong>c) Configure Shutter 2 and test ShutterMode 1 is working</strong><br> <code>ShutterRelay2 3</code> // for relay Relay3i and Relay4</p> <p><strong>b) Restart Tasmota</strong><br> <code>Restart 1</code></p> <p><strong>d) Test the shutter</strong><br> <code>ShutterOpen2</code><br> <code>ShutterStop2</code> // to stop the STEPPER2<br> <code>ShutterClose2</code><br> <code>ShutterInvert2</code> // to change the direction of rotation of the STEPPER2 </p> <p><strong>e) Perform the <a href=./#calibration>shutter calibration</a></strong> </p> <h4 id=motor-wiring-diagrams_1>Motor Wiring Diagrams<a class=headerlink href=#motor-wiring-diagrams_1 title="Permanent link">~</a></h4> <h4 id=one-shutter_1>One Shutter<a class=headerlink href=#one-shutter_1 title="Permanent link">~</a></h4> <p><img alt=411 src=https://raw.githubusercontent.com/TrDA-hab/blinds/master/images/A4988%20v411.jpg> - Diagram v412: simple universal setup. For example, the control of horizontal curtain or vertical shutters, blinds adjuster or window opener, pet feeders, opening of a water tap for watering the lawn, rotating table for subject photography, opening the ventilation flap, PTZ camera, 3D Scanner Table, linear Actuator.<br> <img alt=412 src=https://raw.githubusercontent.com/TrDA-hab/blinds/master/images/A4988%20v412.jpg> - Diagram v414: parallel setup is to run two parallel steppers motors from the same controller. For example, to control a large and heavy hanging screen for an LCD projector, or two curtains at once on one large window.<br> <img alt=414 src=https://raw.githubusercontent.com/TrDA-hab/blinds/master/images/A4988%20v414.jpg> - Diagram v416: minimum setup size. For example, for small curtains located in a limited space.<br> <img alt=416 src=https://raw.githubusercontent.com/TrDA-hab/blinds/master/images/A4988%20v416.jpg></p> <h4 id=2-shutters>2 Shutters<a class=headerlink href=#2-shutters title="Permanent link">~</a></h4> <p><img alt=421 src=https://raw.githubusercontent.com/TrDA-hab/blinds/master/images/A4988%20v421.jpg> - Diagram v422: parallel setup is to run two shutters and independent control of two stepper motors from one controller. For example, to control two independent curtains.<br> <img alt=422 src=https://raw.githubusercontent.com/TrDA-hab/blinds/master/images/A4988%20v422.jpg> - Diagram v424: big parallel setup is to run two shutters and independent control of two pairs of stepper motors from one controller. For example, to control four curtains on one very large window.<br> <img alt=424 src=https://raw.githubusercontent.com/TrDA-hab/blinds/master/images/A4988%20v424.jpg></p> <h4 id=bill-of-materials>Bill of Materials<a class=headerlink href=#bill-of-materials title="Permanent link">~</a></h4> <ul> <li>ESP8266 Boards: </li> <li><a href=https://www.aliexpress.com/item/32529101036.html>Wemos D1 mini</a> </li> <li><a href=https://www.aliexpress.com/item/32266751149.html>NodeMCU</a> </li> <li><a href=https://www.aliexpress.com/item/32973088687.html>ESP-01S</a> </li> <li>Stepper motors (NEMA 17): </li> <li><a href=https://www.aliexpress.com/item/32572890101.html>Standard</a> </li> <li><a href=https://www.aliexpress.com/item/32586860419.html>5:1 Planetary Gearbox</a> </li> <li>Stepper motors (28BYJ-48): </li> <li><a href=https://www.aliexpress.com/item/32849028097.html>Standard</a> </li> <li>Stepper Drivers: </li> <li><a href=https://www.aliexpress.com/item/1609523735.html>A4988</a> </li> <li><a href=https://www.aliexpress.com/item/1609523735.html>DRV8825</a> </li> <li><a href=https://www.aliexpress.com/item/32851067375.html>TMC 2208</a> </li> <li>Stepper Motor Control Development Boards: </li> <li><a href=https://aliexpress.com/item/32908836265.html>x1 board</a> </li> <li><a href=https://aliexpress.com/item/32870732179.html>x2 board</a> </li> <li>DC-DC Step Down Power Supply Module: </li> <li><a href=https://www.aliexpress.com/item/33038302152.html>MP1584EN</a> </li> <li><a href=https://www.aliexpress.com/item/32719726240.html>LM2596</a> </li> <li><a href=https://www.aliexpress.com/item/1859072209.html>XL4015</a> </li> <li>Power Supplies (AC-DC): </li> <li><a href=https://www.aliexpress.com/item/32588476889.html>DC 12V 2.5A</a> </li> <li><a href=https://www.aliexpress.com/item/32854720283.html>DC 12V 4A</a> </li> <li><a href=https://www.aliexpress.com/item/32854269135.html>DC 24v 4A</a> </li> <li>Aluminum Capacitors: </li> <li><a href=https://www.aliexpress.com/item/32814611460.html>35V 100UF</a> </li> <li><a href=https://www.aliexpress.com/item/32887486570.html>35V 10UF</a> </li> <li>Motor Testing PWM Signal Generator: </li> <li><a href=https://www.aliexpress.com/item/32856654440.html>1 type</a> </li> <li><a href=https://www.aliexpress.com/item/32818889845.html>2 type</a> </li> </ul> <h3 id=using-sonoff-dual-r2>using Sonoff Dual R2<a class=headerlink href=#using-sonoff-dual-r2 title="Permanent link">~</a></h3> <p>If using a Sonoff Dual R2, use the following Template: <div class=highlight><pre><span></span><code>{&quot;NAME&quot;:&quot;Sonoff Dual R2&quot;,&quot;GPIO&quot;:[17,255,0,255,0,22,18,0,21,56,0,0,0],&quot;FLAG&quot;:0,&quot;BASE&quot;:39}
</code></pre></div></p> <h4 id=checklist>Checklist<a class=headerlink href=#checklist title="Permanent link">~</a></h4> <ul> <li>Ensure that the first relay opens the shutter</li> <li>Ensure that the second relay closes the shutter</li> <li>Set <code>ShutterRelay&lt;x&gt;</code></li> <li>Set <code>ShutterOpenDuration&lt;x&gt;</code></li> <li>Set <code>ShutterCloseDuration&lt;x&gt;</code></li> <li>Set <code>ShutterSetHalfway&lt;x&gt;</code> (optional)</li> <li>Set <code>ShutterInvert&lt;x&gt;</code>(optional)</li> <li>Set <code>ShutterInvertWebButtons&lt;x&gt;</code>(optional) (eg. useful for horizontal awnings)</li> <li>If the shutter uses a pulse motor instead of a motors with one wire for each direction (i.e., duration based), define <code>PulseTime&lt;x&gt; 2</code> on both relays. The driver's behavior will change to a pulse motor that needs pulses to start and stop. </li> </ul> <h4 id=rules>Rules<a class=headerlink href=#rules title="Permanent link">~</a></h4> <p>Tasmota rule triggers: </p> <ul> <li><code>Shutter&lt;x&gt;#Position</code> is triggered at start, during and at the end of movement reporting actual position (<code>%value%</code>=0-100)</li> <li><code>Shutter&lt;x&gt;#Direction</code> is triggered at start, during and at the end of movement reporting actual direction (<code>%value%</code>: <code>-1</code>=close direction, <code>0</code>=no movement, <code>1</code>=open direction)</li> <li><code>Shutter&lt;x&gt;#Target</code> is triggered at start, during and at the end of movement reporting current target (<code>%value%</code>0-100)</li> <li><code>Shutter#Moving</code> is triggered during movement and just before moving (shutter independently). If VAR&#60;x&gt; is set to 99 then this trigger will be executed BEFORE the shutter starts. You can start the shutter after rule execution by setting VAR&#60;x&gt; to 0 or wait 10seconds before the timeout kicks in. After the movement with shutter#moved the <code>VAR</code> must be set back to 99 and the initial rule must be enabled again. The initial rule has to be defined to run ONCE. EXAMPLE: power3 on and wait 2sec before start. After movement: power off <div class=highlight><pre><span></span><code>rule1 on shutter#moving=1 do backlog power3 on;delay 20;var1 0 endon
rule1 5
rule2 on shutter#moved do backlog power3 off;var1 99;rule1 5 endon
rule2 1
</code></pre></div></li> <li><code>Shutter#Moved</code> is triggered at end of movement (shutter independently)</li> <li><code>Shutter&lt;x&gt;#Button&lt;button&gt;=0</code> is triggered when <code>button</code> is hold</li> <li><code>Shutter&lt;x&gt;#Button&lt;button&gt;=&lt;n&gt;</code> is triggered when <code>button</code> is pressed <code>n</code> times</li> <li><code>Shutter&lt;x&gt;#Button0=0</code> is triggered when all buttons of that shutter are hold simultaneously</li> <li><code>Shutter&lt;x&gt;#Button0=&lt;n&gt;</code> is triggered when all buttons of that shutter are pressed simultaneously <code>n</code> times</li> </ul> <div class="admonition example"> <p class=admonition-title>Examples</p> </div> <ul> <li>Publish a message with the position of the shutter: <code>Rule1 ON Shutter1#Position DO Publish status/%topic%/level {"%value%"} ENDON</code></li> <li>Open/Close or set a specific position for a shutter. This example drives the second shutter to the same position as the first shutter:<br> <code>Rule1 ON Shutter1#Position DO ShutterPosition2 %value%" ENDON</code></li> </ul> <h3 id=jarolift-shutter-support>Jarolift Shutter Support<a class=headerlink href=#jarolift-shutter-support title="Permanent link">~</a></h3> <p>Jarolift shutters operates by the 3 commands up/stop/down. Compile with the KeeLoq Option and provide the extracted master keys to communicate. Please see KeeLoq description how to do that. After this create a rule to allow the shutter to control the Jarolift devices. Shutter must be in ShutterMode 0.</p> <p><code>Rule1 On Power1#state=0 DO KeeloqSendButton 4 endon On Power2#state=0 DO KeeloqSendButton 4 endon on Power1#state=1 DO KeeloqSendButton 8 endon on Power2#State=1 DO KeeloqSendButton 2 endon</code></p> <h3 id=venetian-blind-support>Venetian Blind Support<a class=headerlink href=#venetian-blind-support title="Permanent link">~</a></h3> <p>All time based shutters (not stepper, pwm) can be enhanced with Venetian Blind functionality. The configuration need following parameters: angle of blinds during opening phase, angle of blinds during closing phase. This are the max and the min values of the venetian blinds (e.g. opening at 0° - closing at 90°). Additionally the runtime is required from min to max. This is typically 1-2sec. The resolution of the time is 0.05sec. Duration in [sec] must be multiplied by 20. e.g. 1.2sec =&gt; 1.2 x 20 = 24. To open and close the tilt you must define the angle for CLOSE and the angle for OPEN of the tilt (be careful about the correct order, refer to the following example)</p> <p>Example: - Angle of the slats when the blind is opening: 0° - Angle of the slats when the blind is closing: 90° - Time needed to flip in 1/20 seconds (1 second = 20): 40 - Desired angle of the slats when set to CLOSE : 90° - Desired angle of the slats when set to OPEN : 0°</p> <p><code>ShutterTiltConfig1 0 90 40 90 0</code></p> <p>Tilt configuration can be set for every shutter independently. The tilt can be set with one of the following commands: <code>shuttertilt1 open</code> set tilt to defined open angle <code>shuttertilt1 close</code> set tilt to defined close angle <code>shuttertilt1 20</code> set tilt to 20° angle</p> <p>If the shutter is moved from one position to another position the tilt will be restored AFTER the movement. If the shutter is fully opened or fully closed the tilt will be reset. This means there is no tilt restore at the endpoints. If you want to restore the tilt at the endpoint you have two options to do that: - use a backlog command e.g. <code>backlog shutterclose1; shuttertilt1 open</code> - use <code>shutterposition1 0,90</code> with an optional position of the tilt as a second parameter</p> <p>Similar to shutterchange to make relative movements there is also a <code>shuttertiltchange</code> with the same behavior. </p> <p>If the shutter is operated with wall buttons or the web interface and stopped during a tilte change before the shutter starts moving the NEW tilt position is stored. Now any additional position movements will restore this new tilt position. This makes is possible with small ON/OFF to change the tilt and with long ON/OFF to change the position and retain the tilt after movement.</p> <p>Similar to shutterposition there is a minimum runtime of the motor required that TASMOTA can control. This is 0.2sec. Because the tiltmovement from one position into the other takes often about 1sec it is very common that you cannot make small tilt changes of 10° or sometimes even 20". </p> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://discord.gg/Ks2Kzd4 target=_blank rel=noopener title=discord.gg class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 576 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M492.5 69.8c-.2-.3-.4-.6-.8-.7-38.1-17.5-78.4-30-119.7-37.1-.4-.1-.8 0-1.1.1s-.6.4-.8.8c-5.5 9.9-10.5 20.2-14.9 30.6-44.6-6.8-89.9-6.8-134.4 0-4.5-10.5-9.5-20.7-15.1-30.6-.2-.3-.5-.6-.8-.8s-.7-.2-1.1-.2C162.5 39 122.2 51.5 84.1 69c-.3.1-.6.4-.8.7C7.1 183.5-13.8 294.6-3.6 404.2c0 .3.1.5.2.8s.3.4.5.6c44.4 32.9 94 58 146.8 74.2.4.1.8.1 1.1 0s.7-.4.9-.7c11.3-15.4 21.4-31.8 30-48.8.1-.2.2-.5.2-.8s0-.5-.1-.8-.2-.5-.4-.6-.4-.3-.7-.4c-15.8-6.1-31.2-13.4-45.9-21.9-.3-.2-.5-.4-.7-.6s-.3-.6-.3-.9 0-.6.2-.9.3-.5.6-.7c3.1-2.3 6.2-4.7 9.1-7.1.3-.2.6-.4.9-.4s.7 0 1 .1c96.2 43.9 200.4 43.9 295.5 0 .3-.1.7-.2 1-.2s.7.2.9.4c2.9 2.4 6 4.9 9.1 7.2.2.2.4.4.6.7s.2.6.2.9-.1.6-.3.9-.4.5-.6.6c-14.7 8.6-30 15.9-45.9 21.8-.2.1-.5.2-.7.4s-.3.4-.4.7-.1.5-.1.8.1.5.2.8c8.8 17 18.8 33.3 30 48.8.2.3.6.6.9.7s.8.1 1.1 0c52.9-16.2 102.6-41.3 147.1-74.2.2-.2.4-.4.5-.6s.2-.5.2-.8c12.3-126.8-20.5-236.9-86.9-334.5zm-302 267.7c-29 0-52.8-26.6-52.8-59.2s23.4-59.2 52.8-59.2c29.7 0 53.3 26.8 52.8 59.2 0 32.7-23.4 59.2-52.8 59.2m195.4 0c-29 0-52.8-26.6-52.8-59.2s23.4-59.2 52.8-59.2c29.7 0 53.3 26.8 52.8 59.2 0 32.7-23.2 59.2-52.8 59.2"/></svg> </a> <a href=https://t.me/tasmota target=_blank rel=noopener title=t.me class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M256 8a248 248 0 1 0 0 496 248 248 0 1 0 0-496m115 168.7c-3.7 39.2-19.9 134.4-28.1 178.3-3.5 18.6-10.3 24.8-16.9 25.4-14.4 1.3-25.3-9.5-39.3-18.7-21.8-14.3-34.2-23.2-55.3-37.2-24.5-16.1-8.6-25 5.3-39.5 3.7-3.8 67.1-61.5 68.3-66.7.2-.7.3-3.1-1.2-4.4s-3.6-.8-5.1-.5c-2.2.5-37.1 23.5-104.6 69.1-9.9 6.8-18.9 10.1-26.9 9.9-8.9-.2-25.9-5-38.6-9.1-15.5-5-27.9-7.7-26.8-16.3.6-4.5 6.7-9 18.4-13.7 72.3-31.5 120.5-52.3 144.6-62.3 68.9-28.6 83.2-33.6 92.5-33.8 2.1 0 6.6.5 9.6 2.9 2 1.7 3.2 4.1 3.5 6.7.5 3.2.6 6.5.4 9.8z"/></svg> </a> <a href=https://github.com/tasmota target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M202.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1M496 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2m-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3m-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "..", "features": ["navigation.instant", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "navigation.tracking", "content.action.edit", "content.code.copy"], "search": "../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script> <script src=../assets/javascripts/bundle.f55a23d4.min.js></script> <script src=https://unpkg.com/tablesort@5.3.0/dist/tablesort.min.js></script> <script src=../extra_javascript/tablesort.js></script> </body> </html>